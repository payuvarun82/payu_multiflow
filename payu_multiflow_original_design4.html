<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PayU UAT Payment Integration Hub</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script id="checkoutPlusScript" src="https://jssdk-uat.payu.in/bolt/bolt.min.js"></script>
    <style>
        :root {
            --bg-primary: #f5f7fb;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f8fafc;
            --text-primary: #1a202c;
            --text-secondary: #4a5568;
            --text-tertiary: #718096;
            --accent-primary: #667eea;
            --accent-secondary: #764ba2;
            --border-color: #e2e8f0;
            --shadow-light: 0 4px 6px rgba(0, 0, 0, 0.05);
            --shadow-medium: 0 8px 25px rgba(0, 0, 0, 0.1);
            --shadow-heavy: 0 20px 40px rgba(0, 0, 0, 0.15);
            --gradient-primary: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            --success-color: #48bb78;
            --warning-color: #ed8936;
            --error-color: #f56565;
            --info-bg: #e6fffa;
            --debug-bg: #f7fafc;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-primary);
            padding: 20px;
            color: var(--text-primary);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: var(--bg-secondary);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: var(--shadow-heavy);
        }
        
        .header {
            background: var(--gradient-primary);
            padding: 2rem 2rem 1.5rem 2rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .header-logo {
            background: white;
            display: inline-block;
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 1;
        }
        
        .header-logo svg {
            height: 50px;
            width: auto;
            display: block;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            animation: shimmer 3s infinite;
        }
        
        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: white;
            position: relative;
            z-index: 1;
        }
        
        .header p {
            font-size: 1.2rem;
            color: rgba(255, 255, 255, 0.9);
            position: relative;
            z-index: 1;
        }
        
        /* Landing Section */
        .landing-section {
            padding: 2rem 3rem 3rem 3rem;
            text-align: center;
        }
        
        .landing-section h2 {
            font-size: 2rem;
            color: var(--accent-primary);
            margin-bottom: 1rem;
        }
        
        .landing-section p {
            color: var(--text-secondary);
            margin-bottom: 2rem;
            font-size: 1.1rem;
        }
        
        .flow-selector {
            max-width: 600px;
            margin: 0 auto;
        }
        
        .flow-selector label {
            display: block;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text-secondary);
            font-size: 1.1rem;
        }
        
        .flow-selector select {
            width: 100%;
            padding: 1rem;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            font-size: 1.1rem;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .flow-selector select:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .flow-selector button {
            margin-top: 2rem;
            background: var(--gradient-primary);
            color: white;
            border: none;
            padding: 1rem 3rem;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .flow-selector button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }
        
        .flow-selector button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Flow Sections */
        .flow-content {
            display: none;
        }
        
        .flow-content.active {
            display: block;
        }
        
        .back-button {
            margin: 2rem 3rem 0;
            padding: 0.75rem 1.5rem;
            background: var(--text-tertiary);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .back-button:hover {
            background: var(--text-secondary);
            transform: translateY(-2px);
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
            padding: 3rem;
        }
        
        .section {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 15px;
            padding: 2rem;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .section:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-medium);
        }
        
        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: var(--accent-primary);
            border-bottom: 2px solid var(--accent-primary);
            padding-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
            position: relative;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-secondary);
        }
        
        .required {
            color: var(--error-color);
            font-weight: bold;
        }
        
        .optional {
            color: var(--text-tertiary);
            font-weight: normal;
            font-size: 0.875rem;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            background: var(--bg-tertiary);
            transition: all 0.3s ease;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--accent-primary);
            background: var(--bg-secondary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .error {
            border-color: var(--error-color) !important;
        }
        
        .error-message {
            color: var(--error-color);
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }
        
        .alert {
            padding: 1rem;
            margin-bottom: 1.5rem;
            border-radius: 8px;
            border-left: 4px solid;
        }
        
        .alert-info {
            background: var(--info-bg);
            border-color: var(--accent-primary);
            color: var(--text-secondary);
        }
        
        .alert-warning {
            background: #fff3cd;
            border-color: #ffc107;
            color: #856404;
        }
        
        .payment-methods {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .payment-method {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .payment-method:hover {
            border-color: var(--accent-primary);
            background: var(--bg-tertiary);
        }
        
        .payment-method input[type="checkbox"] {
            width: auto;
            margin: 0;
        }
        
        /* Checkbox and Radio Labels */
        .checkbox-label, .radio-label {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            padding: 0.75rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .checkbox-label:hover, .radio-label:hover {
            border-color: var(--accent-primary);
            background: var(--bg-tertiary);
        }
        
        .checkbox-label input[type="checkbox"],
        .radio-label input[type="radio"] {
            width: auto;
            margin-top: 0.25rem;
            cursor: pointer;
        }
        
        .radio-label span {
            flex: 1;
        }
        
        .radio-label small {
            display: block;
            color: var(--text-tertiary);
            font-size: 0.85rem;
            margin-top: 0.25rem;
        }
        
        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-top: 0.5rem;
        }
        
        /* Split Row Styles */
        .split-row {
            display: grid;
            grid-template-columns: 2fr 2fr 1.5fr 1.5fr 42px;
            gap: 1rem;
            align-items: end;
            padding: 1rem;
            background: var(--bg-tertiary);
            border-radius: 8px;
            margin-bottom: 1rem;
            border: 2px solid var(--border-color);
        }
        
        .split-row .form-group {
            margin-bottom: 0;
        }
        
        .remove-split-btn {
            padding: 0;
            width: 42px;
            height: 42px;
            background: var(--error-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.3rem;
            font-weight: bold;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
        }
        
        .remove-split-btn:hover {
            background: #e53e3e;
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.4);
        }
        
        .remove-split-btn:active {
            transform: scale(0.95) rotate(90deg);
        }
        
        /* Payment Type Selection */
        .payment-type-selection {
            margin-bottom: 2rem;
        }
        
        .payment-type-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .payment-type-btn {
            padding: 1rem;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            background: var(--bg-tertiary);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .payment-type-btn:hover {
            border-color: var(--accent-primary);
            background: var(--bg-secondary);
        }
        
        .payment-type-btn.active {
            border-color: var(--accent-primary);
            background: rgba(102, 126, 234, 0.1);
        }
        
        .payment-type-btn h3 {
            color: var(--accent-primary);
            margin-bottom: 0.5rem;
        }
        
        .payment-type-btn p {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        /* Subscription Fields */
        .subscription-section {
            display: none;
            margin-top: 1.5rem;
            padding: 1.5rem;
            background: var(--bg-tertiary);
            border-radius: 10px;
            border: 1px solid var(--border-color);
        }
        
        .subscription-section.active {
            display: block;
        }
        
        .subscription-section h3 {
            color: var(--accent-primary);
            margin-bottom: 1rem;
        }
        
        /* UDF Field Switching */
        .udf-section {
            transition: all 0.3s ease;
        }
        
        .udf-section.hidden {
            display: none;
        }
        
        /* Custom Key Toggle */
        .custom-key-toggle {
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: var(--bg-tertiary);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        
        .custom-key-toggle label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }
        
        .custom-key-toggle input[type="checkbox"] {
            width: auto;
            margin: 0;
        }
        
        .custom-key-fields {
            display: none;
            margin-top: 1rem;
        }
        
        .custom-key-fields.active {
            display: block;
        }
        
        .button {
            background: var(--gradient-primary);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }
        
        .button:active {
            transform: translateY(0);
        }
        
        .debug-button {
            background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
        }
        
        .pay-button-wrapper {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
            grid-column: 1 / -1;
        }
        
        .debug-section {
            margin-top: 2rem;
            padding: 2rem;
            background: var(--debug-bg);
            border: 1px solid var(--border-color);
            border-radius: 15px;
            display: none;
            animation: slideDown 0.3s ease-out;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .debug-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: var(--accent-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .debug-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1.5rem;
            display: block;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .debug-table thead,
        .debug-table tbody,
        .debug-table tr {
            display: table;
            width: 100%;
            table-layout: fixed;
        }
        
        .debug-table th,
        .debug-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        
        .debug-table th {
            background: var(--bg-tertiary);
            font-weight: 600;
            color: var(--text-secondary);
        }
        
        .debug-table tr:hover {
            background: var(--bg-tertiary);
        }
        
        .hash-string-display {
            font-family: 'Courier New', monospace;
            background: var(--bg-tertiary);
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            word-break: break-all;
            font-size: 0.875rem;
            color: var(--text-secondary);
            max-height: 200px;
            overflow-y: auto;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .hash-output {
            background: var(--gradient-primary);
            color: white;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            font-weight: 600;
            margin-top: 1rem;
            word-break: break-all;
            overflow-wrap: break-word;
        }
        
        /* CURL Section */
        .curl-section {
            margin-top: 2rem;
            padding: 2rem;
            background: var(--text-primary);
            color: white;
            border-radius: 15px;
            display: none;
        }
        
        .curl-section h3 {
            color: var(--accent-primary);
            margin-bottom: 1rem;
        }
        
        .curl-content {
            font-family: 'Courier New', monospace;
            background: rgba(0, 0, 0, 0.3);
            padding: 1rem;
            border-radius: 8px;
            white-space: pre-wrap;
            word-break: break-all;
            font-size: 0.875rem;
            max-height: 300px;
            overflow-y: auto;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .copy-button {
            background: var(--success-color);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 1rem;
            font-size: 0.875rem;
        }
        
        .copy-button:hover {
            background: #38a169;
        }
        
        /* Tablet Responsiveness */
        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 2rem;
                padding: 2rem;
            }
            
            .pay-button-wrapper {
                flex-direction: column;
                align-items: stretch;
                gap: 0.75rem;
            }
            
            .pay-button-wrapper .button {
                width: 100%;
                margin: 0;
            }
            
            .flow-selector {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }
        }
        
        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .container {
                padding: 0.5rem;
            }
            
            .header {
                padding: 1.5rem 1rem 1rem 1rem;
            }
            
            .header h1 {
                font-size: 1.75rem;
            }
            
            .header p {
                font-size: 0.9rem;
            }
            
            .landing-section {
                padding: 1.5rem 1rem 2rem 1rem;
            }
            
            .flow-content {
                padding: 1rem 0.5rem;
            }
            
            .section {
                padding: 1rem;
                margin-bottom: 1rem;
            }
            
            .section-title {
                font-size: 1.25rem;
                margin-bottom: 1rem;
            }
            
            .payment-methods {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }
            
            .payment-method {
                padding: 0.75rem;
            }
            
            .form-row {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .form-group label {
                font-size: 0.9rem;
            }
            
            .form-group input,
            .form-group select,
            .form-group textarea {
                font-size: 1rem;
                padding: 0.75rem;
            }
            
            .payment-type-buttons {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }
            
            .flow-selector {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .flow-card {
                padding: 1.25rem;
            }
            
            .flow-card h3 {
                font-size: 1.1rem;
            }
            
            .alert {
                padding: 0.875rem;
                font-size: 0.9rem;
            }
            
            /* Back button */
            .back-button {
                margin-bottom: 1rem;
                padding: 0.75rem 1rem;
                font-size: 0.9rem;
            }
            
            /* Debug and CURL sections */
            .debug-section,
            .curl-section {
                padding: 1rem;
                margin-top: 1rem;
            }
            
            .debug-title,
            .curl-title {
                font-size: 1.1rem;
            }
            
            .debug-table {
                font-size: 0.8rem;
                display: block;
                overflow-x: auto;
            }
            
            .debug-table th,
            .debug-table td {
                padding: 0.5rem;
                font-size: 0.75rem;
                min-width: 100px;
            }
            
            .hash-string-display,
            .hash-output {
                font-size: 0.7rem;
                padding: 0.75rem;
                max-height: 150px;
            }
            
            .curl-content {
                font-size: 0.7rem;
                padding: 0.75rem;
                max-height: 200px;
            }
            
            pre {
                font-size: 0.75rem;
                padding: 0.75rem;
                overflow-x: auto;
            }
            
            /* Split rows and SKU items */
            .split-row {
                padding: 1rem;
                margin-bottom: 0.875rem;
            }
            
            /* Buttons */
            .button {
                padding: 0.875rem 1.25rem;
                font-size: 0.95rem;
                width: 100%;
            }
            
            .debug-button {
                font-size: 0.875rem;
            }
            
            /* Scenario cards */
            .scenario-card {
                padding: 0.875rem !important;
            }
            
            /* Custom key fields */
            .custom-key-fields {
                padding: 1rem;
            }
            
            /* Cart summary */
            #bo-cart-summary {
                grid-template-columns: 1fr !important;
            }
            
            /* JSON Preview copy button */
            button[onclick="copyBankOfferJson()"],
            .copy-button {
                position: relative !important;
                top: auto !important;
                right: auto !important;
                margin-top: 0.5rem;
                width: 100%;
            }
        }
        
        /* Small Mobile Devices */
        @media (max-width: 480px) {
            .header-logo {
                padding: 0.5rem 1rem;
                margin-bottom: 1rem;
            }
            
            .header-logo svg {
                height: 35px;
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
            
            .header p {
                font-size: 0.85rem;
            }
            
            .landing-section {
                padding: 1.25rem 1rem 1.5rem 1rem;
            }
            
            .section {
                padding: 0.875rem;
            }
            
            .section-title {
                font-size: 1.1rem;
            }
            
            .debug-table th,
            .debug-table td {
                padding: 0.4rem;
                font-size: 0.7rem;
                min-width: 80px;
            }
            
            .hash-string-display,
            .hash-output,
            .curl-content {
                font-size: 0.65rem;
                padding: 0.5rem;
            }
            
            .form-group input,
            .form-group select,
            .form-group textarea {
                font-size: 0.95rem;
                padding: 0.625rem;
            }
            
            .button {
                padding: 0.75rem 1rem;
                font-size: 0.9rem;
            }
            
            .flow-card {
                padding: 1rem;
            }
            
            .alert {
                padding: 0.75rem;
                font-size: 0.85rem;
            }
            
            pre {
                font-size: 0.7rem;
                padding: 0.625rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-logo">
                <svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 514.56 280.44">
                    <defs>
                        <style>
                            .cls-1 {
                                fill: #414042;
                            }
                            .cls-1, .cls-2 {
                                stroke-width: 0px;
                            }
                            .cls-2 {
                                fill: #00ad7d;
                            }
                        </style>
                    </defs>
                    <path class="cls-1" d="M0,97.77h25.72v12.86c2.93-4.46,7.37-8.1,13.3-10.92,5.93-2.82,12.3-4.23,19.11-4.23,8.1,0,15.56,2.06,22.37,6.17,6.81,4.11,12.27,9.98,16.38,17.62,4.11,7.64,6.16,16.56,6.16,26.78s-2.06,19.29-6.16,26.86c-4.11,7.58-9.6,13.36-16.47,17.35-6.87,3.99-14.3,5.99-22.28,5.99-6.93,0-13.36-1.38-19.29-4.14-5.93-2.76-10.31-6.37-13.12-10.83v99.18H0V97.77ZM69.67,165.94c4.76-5.17,7.13-11.8,7.13-19.9s-2.38-14.94-7.13-20.17c-4.76-5.22-10.89-7.84-18.41-7.84s-13.68,2.61-18.5,7.84c-4.82,5.23-7.22,11.95-7.22,20.17s2.41,14.74,7.22,19.9c4.81,5.17,10.98,7.75,18.5,7.75s13.65-2.58,18.41-7.75ZM134.67,190.25c-6.87-3.99-12.36-9.78-16.47-17.35-4.11-7.58-6.17-16.53-6.17-26.86s2.05-19.14,6.17-26.78c4.11-7.63,9.57-13.5,16.38-17.62,6.81-4.11,14.27-6.17,22.37-6.17,6.81,0,13.18,1.41,19.11,4.23,5.93,2.82,10.36,6.46,13.3,10.92v-12.33h25.72v95.13h-25.72v-12.15c-2.82,4.46-7.2,8.07-13.12,10.83-5.93,2.76-12.36,4.14-19.29,4.14-7.99,0-15.41-2-22.28-5.99ZM182.41,165.94c4.76-5.17,7.14-11.8,7.14-19.9s-2.38-14.94-7.14-20.17c-4.76-5.22-10.89-7.84-18.41-7.84s-13.68,2.61-18.5,7.84c-4.82,5.23-7.22,11.95-7.22,20.17s2.41,14.74,7.22,19.9c4.81,5.17,10.98,7.75,18.5,7.75s13.65-2.58,18.41-7.75ZM272.69,196.24c-14.56,0-25.31-3.7-32.24-11.1-6.93-7.4-10.39-17.73-10.39-31v-56.37h26.07v53.73c0,7.4,1.94,12.98,5.81,16.73,3.88,3.76,9.22,5.64,16.03,5.64,6.22,0,11.6-2.05,16.12-6.17,4.52-4.11,6.78-9.69,6.78-16.73v-53.2h25.72v182.68h-25.72v-96.71c-6.11,8.34-15.5,12.51-28.19,12.51ZM348.44,252.44l142.86-43.16V75.57l-164.71-41.93v40.87h-25.72V0l213.68,56.19v171.75l-166.12,51.62v-27.13Z"/>
                    <path class="cls-2" d="M362.18,97.77h26.07v53.73c0,15.03,7.1,22.55,21.32,22.55s21.32-7.51,21.32-22.55v-53.73h26.07v56.37c0,13.15-4.05,23.46-12.15,30.91-8.1,7.46-19.85,11.19-35.23,11.19s-27.13-3.76-35.23-11.27c-8.1-7.52-12.16-17.79-12.16-30.83v-56.37Z"/>
                </svg>
            </div>
            <h1>PayU UAT Payment Integration Hub</h1>
            <p>Complete Payment Testing Utility for Multiple Checkout Solutions On UAT</p>
        </div>
        
        <!-- Landing Section -->
        <div class="landing-section" id="landingSection">
            <h2>Select Payment Flow</h2>
            <p>Choose the payment integration flow you want to test</p>
            
            <div class="flow-selector">
                <label for="flowSelect">Payment Flow:</label>
                <select id="flowSelect">
                    <option value="">-- Select a flow --</option>
                    <option value="crossborder">Cross Border Payment</option>
                    <option value="nonseamless">Non-Seamless Checkout (PreBuilt)</option>
                    <option value="subscription">Non-Seamless Subscription (Recurring)</option>
                    <option value="tpv">TPV Payment (Third Party Verification)</option>
                    <option value="upiotm">UPI OTM (One Time Mandate)</option>
                    <option value="preauth">PreAuth Card Flow</option>
                    <option value="checkoutplus">Checkout Plus</option>
                    <option value="split">Split Payment (Amount/Percentage Based)</option>
                    <option value="bankoffer">Bank Offers (Instant Discount/Cashback)</option>
                </select>
                <button onclick="loadSelectedFlow()">Continue</button>
            </div>
        </div>
        
        <!-- Cross Border Flow -->
        <div class="flow-content" id="crossborderFlow">
            <button class="back-button" onclick="backToLanding()">Back to Flow Selection</button>
            
            <div class="main-content">
                <!-- Configuration Settings -->
                <div class="section">
                    <h2 class="section-title">Configuration Settings</h2>
                    
                    <div class="alert alert-info">
                        <strong>Cross-Border Payment Alert:</strong> Ensure your PayU account is enabled for international transactions and comply with RBI guidelines for cross-border payments.
                    </div>
                    
                    <!-- Payment Type Selection -->
                    <div class="payment-type-selection">
                        <label>Payment Type <span class="required">*</span></label>
                        <div class="payment-type-buttons">
                            <div class="payment-type-btn active" onclick="selectPaymentType('onetime', 'crossborder')" id="cb-onetime-btn">
                                <h3>One-Time Payment</h3>
                                <p>Single transaction payment</p>
                            </div>
                            <div class="payment-type-btn" onclick="selectPaymentType('subscription', 'crossborder')" id="cb-subscription-btn">
                                <h3>Subscription Payment</h3>
                                <p>Recurring payment setup</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Subscription Configuration -->
                    <div class="subscription-section" id="cb-subscription-config">
                        <h3>Subscription Configuration</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="cb_billing_cycle">Billing Cycle <span class="required">*</span></label>
                                <select id="cb_billing_cycle" name="billing_cycle">
                                    <option value="MONTHLY">Monthly</option>
                                    <option value="YEARLY">Yearly</option>
                                    <option value="WEEKLY">Weekly</option>
                                    <option value="ADHOC">Ad-hoc</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="cb_billing_interval">Billing Interval <span class="required">*</span></label>
                                <input type="number" id="cb_billing_interval" name="billing_interval" value="1" min="1">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="cb_payment_start_date">Payment Start Date <span class="required">*</span></label>
                                <input type="date" id="cb_payment_start_date" name="payment_start_date" onchange="validateSubscriptionStartDate('crossborder')">
                                <small style="color: var(--text-tertiary); display: block; margin-top: 0.25rem;">Select current or future date only</small>
                            </div>
                            <div class="form-group">
                                <label for="cb_payment_end_date">Payment End Date <span class="required">*</span></label>
                                <input type="date" id="cb_payment_end_date" name="payment_end_date" required>
                            </div>
                        </div>
                        <div class="alert alert-info">
                            <strong>Note:</strong> For subscription payments, you may need to select 'Net Banking' if required by your bank.
                        </div>
                    </div>
                    
                    <!-- Custom Key/Salt Toggle -->
                    <div class="custom-key-toggle">
                        <label>
                            <input type="checkbox" id="cb_use_custom_keys" onchange="toggleCustomKeys('crossborder')">
                            Use Custom Merchant Key & Salt (for testing with your own credentials)
                        </label>
                        <div class="custom-key-fields" id="cb-custom-key-fields">
                            <div class="form-group">
                                <label for="cb_custom_key">Custom Merchant Key <span class="required">*</span></label>
                                <input type="text" id="cb_custom_key" name="custom_key" placeholder="Enter your PayU Merchant Key">
                            </div>
                            <div class="form-group">
                                <label for="cb_custom_salt">Custom Merchant Salt <span class="required">*</span></label>
                                <div style="position: relative;">
                                    <input type="password" id="cb_custom_salt" name="custom_salt" placeholder="Enter your PayU Merchant Salt" style="padding-right: 40px;">
                                    <button type="button" onclick="toggleSaltVisibility('crossborder')" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: 12px; color: #666;" title="Show/Hide Salt">Show</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Enforce Payment Methods <span class="optional">(Optional)</span></label>
                        <div class="payment-methods">
                            <div class="payment-method">
                                <input type="checkbox" id="cb_cc" name="cb_paymethod" value="CC">
                                <label for="cb_cc">Credit Cards</label>
                            </div>
                            <div class="payment-method">
                                <input type="checkbox" id="cb_dc" name="cb_paymethod" value="DC">
                                <label for="cb_dc">Debit Cards</label>
                            </div>
                            <div class="payment-method">
                                <input type="checkbox" id="cb_nb" name="cb_paymethod" value="NB">
                                <label for="cb_nb">Net Banking</label>
                            </div>
                            <div class="payment-method">
                                <input type="checkbox" id="cb_upi" name="cb_paymethod" value="UPI">
                                <label for="cb_upi">UPI</label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Payment Details -->
                <div class="section">
                    <h2 class="section-title">Payment Details</h2>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="cb_amount">Amount <span class="required">*</span></label>
                            <input type="number" id="cb_amount" name="amount" step="0.01" placeholder="100.00" required>
                        </div>
                        <div class="form-group">
                            <label for="cb_productinfo">Product Info <span class="required">*</span></label>
                            <input type="text" id="cb_productinfo" name="productinfo" placeholder="Product or service description" required>
                        </div>
                    </div>
                    
                    <h3 style="color: var(--accent-primary); margin: 2rem 0 1rem 0;">Customer Details</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="cb_firstname">First Name <span class="required">*</span></label>
                            <input type="text" id="cb_firstname" name="firstname" placeholder="John" required>
                        </div>
                        <div class="form-group">
                            <label for="cb_lastname">Last Name <span class="required">*</span></label>
                            <input type="text" id="cb_lastname" name="lastname" placeholder="Doe" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="cb_email">Email <span class="required">*</span></label>
                            <input type="email" id="cb_email" name="email" placeholder="john.doe@example.com" required>
                            <div id="cb-email-error" class="error-message" style="display: none;"></div>
                        </div>
                        <div class="form-group">
                            <label for="cb_phone">Phone (10 digits) <span class="required">*</span></label>
                            <input type="text" id="cb_phone" name="phone" placeholder="9876543210" required maxlength="10" pattern="[0-9]{10}">
                            <div id="cb-phone-error" class="error-message" style="display: none;"></div>
                        </div>
                    </div>
                    
                    <h3 style="color: var(--accent-primary); margin: 2rem 0 1rem 0;">Billing Address</h3>
                    <div class="alert alert-info">
                        <strong>PACB Requirement:</strong> Billing address is mandatory for cross-border payments.
                    </div>
                    
                    <div class="form-group">
                        <label for="cb_address1">Address Line 1 <span class="required">*</span></label>
                        <input type="text" id="cb_address1" name="address1" placeholder="Street address" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="cb_address2">Address Line 2 <span class="optional">(Optional)</span></label>
                        <input type="text" id="cb_address2" name="address2" placeholder="Apartment, suite, etc.">
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="cb_city">City <span class="required">*</span></label>
                            <input type="text" id="cb_city" name="city" placeholder="Mumbai" required>
                        </div>
                        <div class="form-group">
                            <label for="cb_state">State <span class="required">*</span></label>
                            <input type="text" id="cb_state" name="state" placeholder="Maharashtra" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="cb_country">Country <span class="required">*</span></label>
                            <input type="text" id="cb_country" name="country" placeholder="India" required>
                        </div>
                        <div class="form-group">
                            <label for="cb_zipcode">ZIP Code <span class="required">*</span></label>
                            <input type="text" id="cb_zipcode" name="zipcode" placeholder="400001" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="cb_buyer_type">Buyer Type <span class="optional">(Optional)</span></label>
                        <select id="cb_buyer_type" name="buyer_type_business">
                            <option value="">Select buyer type</option>
                            <option value="0" selected>Individual</option>
                            <option value="1">Business</option>
                        </select>
                    </div>
                </div>
                
                <!-- UDF Parameters - One-time Payment -->
                <div class="section udf-section" id="cb-onetime-udf-section">
                    <h2 class="section-title">UDF Parameters (User Defined Fields)</h2>
                    
                    <div class="alert alert-info">
                        <strong>UDF Information:</strong> These fields provide additional transaction details required for compliance and processing.
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="cb_udf1_input">UDF1 - PAN Number <span class="optional">(Optional)</span></label>
                            <input type="text" id="cb_udf1_input" name="udf1_input" placeholder="AAAPZ1234C">
                        </div>
                        <div class="form-group">
                            <label for="cb_udf2_input">UDF2 - Additional Info <span class="optional">(Optional)</span></label>
                            <input type="text" id="cb_udf2_input" name="udf2_input" placeholder="Any additional information">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="cb_udf3_input">UDF3 - Buyer's DOB <span class="optional">(Recommended)</span></label>
                            <input type="text" id="cb_udf3_input" name="udf3_input" placeholder="YYYY-MM-DD">
                        </div>
                        <div class="form-group">
                            <label for="cb_udf4_input">UDF4 - Seller Name <span class="optional">(Optional)</span></label>
                            <input type="text" id="cb_udf4_input" name="udf4_input" placeholder="Required for PA2PA PACB">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="cb_udf5_input">UDF5 - Invoice ID <span class="required">*</span></label>
                        <input type="text" id="cb_udf5_input" name="udf5_input" placeholder="Required for PACB" required>
                    </div>
                </div>
                
                <!-- UDF Parameters - Subscription Payment -->
                <div class="section udf-section hidden" id="cb-subscription-udf-section">
                    <h2 class="section-title">UDF Parameters (Subscription)</h2>
                    
                    <div class="alert alert-info">
                        <strong>Subscription UDF Requirements:</strong> These fields are specifically required for subscription payments.
                        <br><br>
                        <strong>Conditional Validation:</strong>
                        <ul style="margin: 0.5rem 0 0 1.5rem;">
                            <li>If <strong>UPI</strong> payment method is enforced: <strong>UDF3 is mandatory</strong></li>
                            <li>If <strong>other payment methods</strong> (not UPI) are enforced: <strong>UDF5 is mandatory</strong></li>
                            <li>If <strong>no payment method</strong> is enforced: Use Udf update API with respect to the paymode.</li>
                        </ul>
                    </div>
                    
                    <div class="form-group">
                        <label for="cb_sub_udf1_input">UDF1 - PAN & DOB <span class="optional">(Required if AD bank requests)</span></label>
                        <input type="text" id="cb_sub_udf1_input" name="sub_udf1_input" placeholder="AAAPZ1234C||22/08/1972">
                        <small style="color: var(--text-tertiary);">Format: PAN||DOB (DD/MM/YYYY)</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="cb_sub_udf2_input">UDF2 - Additional Info <span class="optional">(Optional)</span></label>
                        <input type="text" id="cb_sub_udf2_input" name="sub_udf2_input" placeholder="Any additional information">
                    </div>
                    
                    <div class="form-group">
                        <label for="cb_sub_udf3_input">UDF3 - Invoice ID & Merchant Name <span class="optional">(Required if UPI enforced)</span></label>
                        <input type="text" id="cb_sub_udf3_input" name="sub_udf3_input" placeholder="INV-123_1231||MerchantName">
                        <small style="color: var(--text-tertiary);">Format: InvoiceID||MerchantName (Mandatory when UPI is enforced)</small>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="cb_sub_udf4_input">UDF4 - Additional Field <span class="optional">(Optional)</span></label>
                            <input type="text" id="cb_sub_udf4_input" name="sub_udf4_input" placeholder="Additional field">
                        </div>
                        <div class="form-group">
                            <label for="cb_sub_udf5_input">UDF5 - Additional Field <span class="optional">(Required if non-UPI payment enforced)</span></label>
                            <input type="text" id="cb_sub_udf5_input" name="sub_udf5_input" placeholder="Additional field">
                        </div>
                    </div>
                </div>
                
                <!-- Redirect URLs -->
                <div class="section">
                    <h2 class="section-title">Redirect URLs</h2>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="cb_surl">Success URL <span class="required">*</span></label>
                            <input type="url" id="cb_surl" name="surl" value="https://test.payu.in/admin/test_response" required>
                        </div>
                        <div class="form-group">
                            <label for="cb_furl">Failure URL <span class="required">*</span></label>
                            <input type="url" id="cb_furl" name="furl" value="https://test.payu.in/admin/test_response" required>
                        </div>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="pay-button-wrapper">
                    <button type="button" class="button debug-button" onclick="showDebugInfo('crossborder')">Show Debug Info</button>
                    <button type="button" class="button debug-button" onclick="showCurlCommand('crossborder')">Generate CURL</button>
                    <button type="button" class="button" onclick="submitPayment('crossborder')">Pay Now</button>
                </div>
            </div>
            
            <!-- Debug Section -->
            <div class="debug-section" id="cb-debugSection">
                <h3 class="debug-title">Debug Information</h3>
                <div id="cb-debugContent"></div>
            </div>
            
            <!-- CURL Section -->
            <div class="curl-section" id="cb-curlSection">
                <h3>CURL Command</h3>
                <button class="copy-button" onclick="copyCurlToClipboard('crossborder')">Copy to Clipboard</button>
                <div class="curl-content" id="cb-curlContent"></div>
            </div>
        </div>
        
        <!-- Non-Seamless Checkout Flow -->
        <div class="flow-content" id="nonseamlessFlow">
            <button class="back-button" onclick="backToLanding()">Back to Flow Selection</button>
            
            <div class="main-content">
                <!-- Configuration Settings -->
                <div class="section">
                    <h2 class="section-title">Configuration Settings</h2>
                    
                    <div class="alert alert-info">
                        <strong>PreBuilt Checkout:</strong> PayU's standard checkout page with built-in payment UI.
                    </div>
                    
                    <!-- Custom Key/Salt Toggle -->
                    <div class="custom-key-toggle">
                        <label>
                            <input type="checkbox" id="ns_use_custom_keys" onchange="toggleCustomKeys('nonseamless')">
                            Use Custom Merchant Key & Salt (for testing with your own credentials)
                        </label>
                        <div class="custom-key-fields" id="ns-custom-key-fields">
                            <div class="form-group">
                                <label for="ns_custom_key">Custom Merchant Key <span class="required">*</span></label>
                                <input type="text" id="ns_custom_key" name="custom_key" placeholder="Enter your PayU Merchant Key">
                            </div>
                            <div class="form-group">
                                <label for="ns_custom_salt">Custom Merchant Salt <span class="required">*</span></label>
                                <div style="position: relative;">
                                    <input type="password" id="ns_custom_salt" name="custom_salt" placeholder="Enter your PayU Merchant Salt" style="padding-right: 40px;">
                                    <button type="button" onclick="toggleSaltVisibility('nonseamless')" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: 12px; color: #666;" title="Show/Hide Salt">Show</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Enforce Payment Methods <span class="optional">(Optional)</span></label>
                        <div class="payment-methods">
                            <div class="payment-method">
                                <input type="checkbox" id="ns_cc" name="ns_paymethod" value="CC">
                                <label for="ns_cc">Credit Cards</label>
                            </div>
                            <div class="payment-method">
                                <input type="checkbox" id="ns_dc" name="ns_paymethod" value="DC">
                                <label for="ns_dc">Debit Cards</label>
                            </div>
                            <div class="payment-method">
                                <input type="checkbox" id="ns_nb" name="ns_paymethod" value="NB">
                                <label for="ns_nb">Net Banking</label>
                            </div>
                            <div class="payment-method">
                                <input type="checkbox" id="ns_upi" name="ns_paymethod" value="UPI">
                                <label for="ns_upi">UPI</label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Payment Details -->
                <div class="section">
                    <h2 class="section-title">Payment Details</h2>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="ns_amount">Amount <span class="required">*</span></label>
                            <input type="number" id="ns_amount" name="amount" step="0.01" placeholder="100.00" required>
                        </div>
                        <div class="form-group">
                            <label for="ns_productinfo">Product Info <span class="required">*</span></label>
                            <input type="text" id="ns_productinfo" name="productinfo" placeholder="Product or service description" required>
                        </div>
                    </div>
                    
                    <h3 style="color: var(--accent-primary); margin: 2rem 0 1rem 0;">Customer Details</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="ns_firstname">First Name <span class="required">*</span></label>
                            <input type="text" id="ns_firstname" name="firstname" placeholder="John" required>
                        </div>
                        <div class="form-group">
                            <label for="ns_lastname">Last Name <span class="optional">(Optional)</span></label>
                            <input type="text" id="ns_lastname" name="lastname" placeholder="Doe">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="ns_email">Email <span class="required">*</span></label>
                            <input type="email" id="ns_email" name="email" placeholder="john.doe@example.com" required>
                            <div id="ns-email-error" class="error-message" style="display: none;"></div>
                        </div>
                        <div class="form-group">
                            <label for="ns_phone">Phone (10 digits) <span class="required">*</span></label>
                            <input type="text" id="ns_phone" name="phone" placeholder="9876543210" required maxlength="10" pattern="[0-9]{10}">
                            <div id="ns-phone-error" class="error-message" style="display: none;"></div>
                        </div>
                    </div>
                    
                    <h3 style="color: var(--accent-primary); margin: 2rem 0 1rem 0;">Address Details <span class="optional">(Optional)</span></h3>
                    
                    <div class="form-group">
                        <label for="ns_address1">Address Line 1 <span class="optional">(Optional)</span></label>
                        <input type="text" id="ns_address1" name="address1" placeholder="Street address">
                    </div>
                    
                    <div class="form-group">
                        <label for="ns_address2">Address Line 2 <span class="optional">(Optional)</span></label>
                        <input type="text" id="ns_address2" name="address2" placeholder="Apartment, suite, etc.">
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="ns_city">City <span class="optional">(Optional)</span></label>
                            <input type="text" id="ns_city" name="city" placeholder="Mumbai">
                        </div>
                        <div class="form-group">
                            <label for="ns_state">State <span class="optional">(Optional)</span></label>
                            <input type="text" id="ns_state" name="state" placeholder="Maharashtra">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="ns_country">Country <span class="optional">(Optional)</span></label>
                            <input type="text" id="ns_country" name="country" placeholder="India">
                        </div>
                        <div class="form-group">
                            <label for="ns_zipcode">ZIP Code <span class="optional">(Optional)</span></label>
                            <input type="text" id="ns_zipcode" name="zipcode" placeholder="400001">
                        </div>
                    </div>
                </div>
                
                <!-- UDF Parameters -->
                <div class="section">
                    <h2 class="section-title">UDF Parameters (Optional)</h2>
                    
                    <div class="alert alert-info">
                        <strong>UDF Information:</strong> User Defined Fields for custom data - all optional.
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="ns_udf1">UDF1 <span class="optional">(Optional)</span></label>
                            <input type="text" id="ns_udf1" name="udf1" placeholder="User defined field 1">
                        </div>
                        <div class="form-group">
                            <label for="ns_udf2">UDF2 <span class="optional">(Optional)</span></label>
                            <input type="text" id="ns_udf2" name="udf2" placeholder="User defined field 2">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="ns_udf3">UDF3 <span class="optional">(Optional)</span></label>
                            <input type="text" id="ns_udf3" name="udf3" placeholder="User defined field 3">
                        </div>
                        <div class="form-group">
                            <label for="ns_udf4">UDF4 <span class="optional">(Optional)</span></label>
                            <input type="text" id="ns_udf4" name="udf4" placeholder="User defined field 4">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="ns_udf5">UDF5 <span class="optional">(Optional)</span></label>
                        <input type="text" id="ns_udf5" name="udf5" placeholder="User defined field 5">
                    </div>
                </div>
                
                <!-- Redirect URLs -->
                <div class="section">
                    <h2 class="section-title">Redirect URLs</h2>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="ns_surl">Success URL <span class="required">*</span></label>
                            <input type="url" id="ns_surl" name="surl" value="https://test.payu.in/admin/test_response" required>
                        </div>
                        <div class="form-group">
                            <label for="ns_furl">Failure URL <span class="required">*</span></label>
                            <input type="url" id="ns_furl" name="furl" value="https://test.payu.in/admin/test_response" required>
                        </div>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="pay-button-wrapper">
                    <button type="button" class="button debug-button" onclick="showDebugInfo('nonseamless')">Show Debug Info</button>
                    <button type="button" class="button debug-button" onclick="showCurlCommand('nonseamless')">Generate CURL</button>
                    <button type="button" class="button" onclick="submitPayment('nonseamless')">Pay Now</button>
                </div>
            </div>
            
            <!-- Debug Section -->
            <div class="debug-section" id="ns-debugSection">
                <h3 class="debug-title">Debug Information</h3>
                <div id="ns-debugContent"></div>
            </div>
            
            <!-- CURL Section -->
            <div class="curl-section" id="ns-curlSection">
                <h3>CURL Command</h3>
                <button class="copy-button" onclick="copyCurlToClipboard('nonseamless')">Copy to Clipboard</button>
                <div class="curl-content" id="ns-curlContent"></div>
            </div>
        </div>
        
        <!-- Subscription Flow -->
        <div class="flow-content" id="subscriptionFlow">
            <button class="back-button" onclick="backToLanding()">Back to Flow Selection</button>
            
            <div class="main-content">
                <!-- Configuration Settings -->
                <div class="section">
                    <h2 class="section-title">Configuration Settings</h2>
                    
                    <div class="alert alert-info">
                        <strong>Subscription/Recurring Payment:</strong> This flow is for setting up recurring payments with customer consent.
                    </div>
                    
                    <!-- Subscription Configuration -->
                    <div class="form-group">
                        <h3 style="color: var(--accent-primary); margin-bottom: 1rem;">Subscription Configuration</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="sub_billing_cycle">Billing Cycle <span class="required">*</span></label>
                                <select id="sub_billing_cycle" name="billing_cycle">
                                    <option value="MONTHLY">Monthly</option>
                                    <option value="YEARLY">Yearly</option>
                                    <option value="WEEKLY">Weekly</option>
                                    <option value="ADHOC">Ad-hoc</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="sub_billing_interval">Billing Interval <span class="required">*</span></label>
                                <input type="number" id="sub_billing_interval" name="billing_interval" value="1" min="1">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="sub_payment_start_date">Payment Start Date <span class="required">*</span></label>
                                <input type="date" id="sub_payment_start_date" name="payment_start_date" onchange="validateSubscriptionStartDate('subscription')">
                                <small style="color: var(--text-tertiary); display: block; margin-top: 0.25rem;">Select current or future date only</small>
                            </div>
                            <div class="form-group">
                                <label for="sub_payment_end_date">Payment End Date <span class="required">*</span></label>
                                <input type="date" id="sub_payment_end_date" name="payment_end_date" required>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Custom Key/Salt Toggle -->
                    <div class="custom-key-toggle">
                        <label>
                            <input type="checkbox" id="sub_use_custom_keys" onchange="toggleCustomKeys('subscription')">
                            Use Custom Merchant Key & Salt (for testing with your own credentials)
                        </label>
                        <div class="custom-key-fields" id="sub-custom-key-fields">
                            <div class="form-group">
                                <label for="sub_custom_key">Custom Merchant Key <span class="required">*</span></label>
                                <input type="text" id="sub_custom_key" name="custom_key" placeholder="Enter your PayU Merchant Key">
                            </div>
                            <div class="form-group">
                                <label for="sub_custom_salt">Custom Merchant Salt <span class="required">*</span></label>
                                <div style="position: relative;">
                                    <input type="password" id="sub_custom_salt" name="custom_salt" placeholder="Enter your PayU Merchant Salt" style="padding-right: 40px;">
                                    <button type="button" onclick="toggleSaltVisibility('subscription')" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: 12px; color: #666;" title="Show/Hide Salt">Show</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Enforce Payment Methods <span class="optional">(Optional)</span></label>
                        <div class="payment-methods">
                            <div class="payment-method">
                                <input type="checkbox" id="sub_cc" name="sub_paymethod" value="CC">
                                <label for="sub_cc">Credit Cards</label>
                            </div>
                            <div class="payment-method">
                                <input type="checkbox" id="sub_dc" name="sub_paymethod" value="DC">
                                <label for="sub_dc">Debit Cards</label>
                            </div>
                            <div class="payment-method">
                                <input type="checkbox" id="sub_nb" name="sub_paymethod" value="NB">
                                <label for="sub_nb">Net Banking (eNACH)</label>
                            </div>
                            <div class="payment-method">
                                <input type="checkbox" id="sub_upi" name="sub_paymethod" value="UPI">
                                <label for="sub_upi">UPI</label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Payment Details -->
                <div class="section">
                    <h2 class="section-title">Payment Details</h2>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="sub_amount">Amount <span class="required">*</span></label>
                            <input type="number" id="sub_amount" name="amount" step="0.01" placeholder="100.00" required>
                        </div>
                        <div class="form-group">
                            <label for="sub_productinfo">Product Info <span class="required">*</span></label>
                            <input type="text" id="sub_productinfo" name="productinfo" placeholder="Product or service description" required>
                        </div>
                    </div>
                    
                    <h3 style="color: var(--accent-primary); margin: 2rem 0 1rem 0;">Customer Details</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="sub_firstname">First Name <span class="required">*</span></label>
                            <input type="text" id="sub_firstname" name="firstname" placeholder="John" required>
                        </div>
                        <div class="form-group">
                            <label for="sub_lastname">Last Name <span class="optional">(Optional)</span></label>
                            <input type="text" id="sub_lastname" name="lastname" placeholder="Doe">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="sub_email">Email <span class="required">*</span></label>
                            <input type="email" id="sub_email" name="email" placeholder="john.doe@example.com" required>
                            <div id="sub-email-error" class="error-message" style="display: none;"></div>
                        </div>
                        <div class="form-group">
                            <label for="sub_phone">Phone (10 digits) <span class="required">*</span></label>
                            <input type="text" id="sub_phone" name="phone" placeholder="9876543210" required maxlength="10" pattern="[0-9]{10}">
                            <div id="sub-phone-error" class="error-message" style="display: none;"></div>
                        </div>
                    </div>
                    
                    <h3 style="color: var(--accent-primary); margin: 2rem 0 1rem 0;">Address Details <span class="optional">(Optional)</span></h3>
                    
                    <div class="form-group">
                        <label for="sub_address1">Address Line 1 <span class="optional">(Optional)</span></label>
                        <input type="text" id="sub_address1" name="address1" placeholder="Street address">
                    </div>
                    
                    <div class="form-group">
                        <label for="sub_address2">Address Line 2 <span class="optional">(Optional)</span></label>
                        <input type="text" id="sub_address2" name="address2" placeholder="Apartment, suite, etc.">
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="sub_city">City <span class="optional">(Optional)</span></label>
                            <input type="text" id="sub_city" name="city" placeholder="Mumbai">
                        </div>
                        <div class="form-group">
                            <label for="sub_state">State <span class="optional">(Optional)</span></label>
                            <input type="text" id="sub_state" name="state" placeholder="Maharashtra">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="sub_country">Country <span class="optional">(Optional)</span></label>
                            <input type="text" id="sub_country" name="country" placeholder="India">
                        </div>
                        <div class="form-group">
                            <label for="sub_zipcode">ZIP Code <span class="optional">(Optional)</span></label>
                            <input type="text" id="sub_zipcode" name="zipcode" placeholder="400001">
                        </div>
                    </div>
                </div>
                
                <!-- UDF Parameters -->
                <div class="section">
                    <h2 class="section-title">UDF Parameters</h2>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="sub_udf1">UDF1 <span class="optional">(Optional)</span></label>
                            <input type="text" id="sub_udf1" name="udf1" placeholder="">
                        </div>
                        <div class="form-group">
                            <label for="sub_udf2">UDF2 <span class="optional">(Optional)</span></label>
                            <input type="text" id="sub_udf2" name="udf2" placeholder="">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="sub_udf3">UDF3 <span class="optional">(Optional)</span></label>
                            <input type="text" id="sub_udf3" name="udf3" placeholder="">
                        </div>
                        <div class="form-group">
                            <label for="sub_udf4">UDF4 <span class="optional">(Optional)</span></label>
                            <input type="text" id="sub_udf4" name="udf4" placeholder="">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="sub_udf5">UDF5 <span class="optional">(Optional)</span></label>
                        <input type="text" id="sub_udf5" name="udf5" placeholder="">
                    </div>
                </div>
                
                <!-- Redirect URLs -->
                <div class="section">
                    <h2 class="section-title">Redirect URLs</h2>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="sub_surl">Success URL <span class="required">*</span></label>
                            <input type="url" id="sub_surl" name="surl" value="https://test.payu.in/admin/test_response" required>
                        </div>
                        <div class="form-group">
                            <label for="sub_furl">Failure URL <span class="required">*</span></label>
                            <input type="url" id="sub_furl" name="furl" value="https://test.payu.in/admin/test_response" required>
                        </div>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="pay-button-wrapper">
                    <button type="button" class="button debug-button" onclick="showDebugInfo('subscription')">Show Debug Info</button>
                    <button type="button" class="button debug-button" onclick="showCurlCommand('subscription')">Generate CURL</button>
                    <button type="button" class="button" onclick="submitPayment('subscription')">Pay Now</button>
                </div>
            </div>
            
            <!-- Debug Section -->
            <div class="debug-section" id="sub-debugSection">
                <h3 class="debug-title">Debug Information</h3>
                <div id="sub-debugContent"></div>
            </div>
            
            <!-- CURL Section -->
            <div class="curl-section" id="sub-curlSection">
                <h3>CURL Command</h3>
                <button class="copy-button" onclick="copyCurlToClipboard('subscription')">Copy to Clipboard</button>
                <div class="curl-content" id="sub-curlContent"></div>
            </div>
        </div>
    </div>
    
    <!-- Hidden Forms -->
    <form id="cb_payu_form" method="post" action="https://test.payu.in/_payment" style="display: none;">
        <input type="hidden" id="cb_key" name="key">
        <input type="hidden" id="cb_txnid" name="txnid">
        <input type="hidden" id="cb_amount_hidden" name="amount">
        <input type="hidden" id="cb_productinfo_hidden" name="productinfo">
        <input type="hidden" id="cb_firstname_hidden" name="firstname">
        <input type="hidden" id="cb_lastname_hidden" name="lastname">
        <input type="hidden" id="cb_email_hidden" name="email">
        <input type="hidden" id="cb_phone_hidden" name="phone">
        <input type="hidden" id="cb_address1_hidden" name="address1">
        <input type="hidden" id="cb_address2_hidden" name="address2">
        <input type="hidden" id="cb_city_hidden" name="city">
        <input type="hidden" id="cb_state_hidden" name="state">
        <input type="hidden" id="cb_country_hidden" name="country">
        <input type="hidden" id="cb_zipcode_hidden" name="zipcode">
        <input type="hidden" id="cb_udf1" name="udf1">
        <input type="hidden" id="cb_udf2" name="udf2">
        <input type="hidden" id="cb_udf3" name="udf3">
        <input type="hidden" id="cb_udf4" name="udf4">
        <input type="hidden" id="cb_udf5" name="udf5">
        <input type="hidden" id="cb_surl_hidden" name="surl">
        <input type="hidden" id="cb_furl_hidden" name="furl">
        <input type="hidden" id="cb_hash" name="hash">
        <input type="hidden" id="cb_enforce_paymethod" name="enforce_paymethod">
        <input type="hidden" id="cb_si" name="si">
        <input type="hidden" id="cb_api_version" name="api_version">
        <input type="hidden" id="cb_si_details" name="si_details">
    </form>
    
    <form id="ns_payu_form" method="post" action="https://test.payu.in/_payment" style="display: none;">
        <input type="hidden" id="ns_key" name="key">
        <input type="hidden" id="ns_txnid" name="txnid">
        <input type="hidden" id="ns_amount_hidden" name="amount">
        <input type="hidden" id="ns_productinfo_hidden" name="productinfo">
        <input type="hidden" id="ns_firstname_hidden" name="firstname">
        <input type="hidden" id="ns_lastname_hidden" name="lastname">
        <input type="hidden" id="ns_email_hidden" name="email">
        <input type="hidden" id="ns_phone_hidden" name="phone">
        <input type="hidden" id="ns_address1_hidden" name="address1">
        <input type="hidden" id="ns_address2_hidden" name="address2">
        <input type="hidden" id="ns_city_hidden" name="city">
        <input type="hidden" id="ns_state_hidden" name="state">
        <input type="hidden" id="ns_country_hidden" name="country">
        <input type="hidden" id="ns_zipcode_hidden" name="zipcode">
        <input type="hidden" id="ns_udf1_hidden" name="udf1">
        <input type="hidden" id="ns_udf2_hidden" name="udf2">
        <input type="hidden" id="ns_udf3_hidden" name="udf3">
        <input type="hidden" id="ns_udf4_hidden" name="udf4">
        <input type="hidden" id="ns_udf5_hidden" name="udf5">
        <input type="hidden" id="ns_surl_hidden" name="surl">
        <input type="hidden" id="ns_furl_hidden" name="furl">
        <input type="hidden" id="ns_hash" name="hash">
        <input type="hidden" id="ns_enforce_paymethod" name="enforce_paymethod">
    </form>
    
    <form id="sub_payu_form" method="post" action="https://test.payu.in/_payment" style="display: none;">
        <input type="hidden" id="sub_key" name="key">
        <input type="hidden" id="sub_txnid" name="txnid">
        <input type="hidden" id="sub_amount_hidden" name="amount">
        <input type="hidden" id="sub_productinfo_hidden" name="productinfo">
        <input type="hidden" id="sub_firstname_hidden" name="firstname">
        <input type="hidden" id="sub_lastname_hidden" name="lastname">
        <input type="hidden" id="sub_email_hidden" name="email">
        <input type="hidden" id="sub_phone_hidden" name="phone">
        <input type="hidden" id="sub_address1_hidden" name="address1">
        <input type="hidden" id="sub_address2_hidden" name="address2">
        <input type="hidden" id="sub_city_hidden" name="city">
        <input type="hidden" id="sub_state_hidden" name="state">
        <input type="hidden" id="sub_country_hidden" name="country">
        <input type="hidden" id="sub_zipcode_hidden" name="zipcode">
        <input type="hidden" id="sub_udf1_hidden" name="udf1">
        <input type="hidden" id="sub_udf2_hidden" name="udf2">
        <input type="hidden" id="sub_udf3_hidden" name="udf3">
        <input type="hidden" id="sub_udf4_hidden" name="udf4">
        <input type="hidden" id="sub_udf5_hidden" name="udf5">
        <input type="hidden" id="sub_surl_hidden" name="surl">
        <input type="hidden" id="sub_furl_hidden" name="furl">
        <input type="hidden" id="sub_hash" name="hash">
        <input type="hidden" id="sub_enforce_paymethod" name="enforce_paymethod">
        <input type="hidden" id="sub_si" name="si">
        <input type="hidden" id="sub_api_version" name="api_version">
        <input type="hidden" id="sub_si_details" name="si_details">
    </form>
    
    <!-- TPV Flow (One Time) -->
    <div class="flow-content" id="tpvFlow">
        <button class="back-button" onclick="backToLanding()">Back to Flow Selection</button>
        
        <div class="main-content">
            <!-- Configuration Settings -->
            <div class="section">
                <h2 class="section-title">Configuration Settings</h2>
                
                <!-- Payment Type Selection -->
                <div class="alert alert-info">
                    <strong>TPV Payment:</strong> Third Party Verification for Net Banking and UPI transactions with beneficiary account validation.
                </div>
                
                <!-- Custom Key/Salt Toggle -->
                <div class="custom-key-toggle">
                    <label>
                        <input type="checkbox" id="tpv_use_custom_keys" onchange="toggleCustomKeys('tpv')">
                        Use Custom Merchant Key & Salt (for testing with your own credentials)
                    </label>
                    <div class="custom-key-fields" id="tpv-custom-key-fields">
                        <div class="form-group">
                            <label for="tpv_custom_key">Custom Merchant Key <span class="required">*</span></label>
                            <input type="text" id="tpv_custom_key" name="custom_key" placeholder="Enter your PayU Merchant Key">
                        </div>
                        <div class="form-group">
                            <label for="tpv_custom_salt">Custom Merchant Salt <span class="required">*</span></label>
                            <div style="position: relative;">
                                <input type="password" id="tpv_custom_salt" name="custom_salt" placeholder="Enter your PayU Merchant Salt" style="padding-right: 40px;">
                                <button type="button" onclick="toggleSaltVisibility('tpv')" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: 12px; color: #666;" title="Show/Hide Salt">Show</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Enforce Payment Methods <span class="optional">(Optional)</span></label>
                    <div class="payment-methods">
                        <div class="payment-method">
                            <input type="checkbox" id="tpv_upi" name="tpv_paymethod" value="UPI">
                            <label for="tpv_upi">UPI</label>
                        </div>
                        <div class="payment-method">
                            <input type="checkbox" id="tpv_nb" name="tpv_paymethod" value="NB">
                            <label for="tpv_nb">Net Banking</label>
                        </div>
                    </div>
                </div>
            </div>
                <!-- Payment Details -->
                <div class="section">
                    <h2 class="section-title">Payment Details</h2>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="tpv_amount">Amount <span class="required">*</span></label>
                            <input type="number" id="tpv_amount" name="amount" step="0.01" placeholder="100.00" required>
                        </div>
                        <div class="form-group">
                            <label for="tpv_productinfo">Product Info <span class="required">*</span></label>
                            <input type="text" id="tpv_productinfo" name="productinfo" placeholder="Product or service description" required>
                        </div>
                    </div>
                    
                    <h3 style="color: var(--accent-primary); margin: 2rem 0 1rem 0;">Customer Details</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="tpv_firstname">First Name <span class="required">*</span></label>
                            <input type="text" id="tpv_firstname" name="firstname" placeholder="John" required>
                        </div>
                        <div class="form-group">
                            <label for="tpv_email">Email <span class="required">*</span></label>
                            <input type="email" id="tpv_email" name="email" placeholder="john@example.com" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="tpv_phone">Phone (10 digits) <span class="required">*</span></label>
                        <input type="tel" id="tpv_phone" name="phone" placeholder="9999999999" 
                               maxlength="10" pattern="[0-9]{10}" required 
                               oninput="validatePhone('tpv')">
                    </div>
                </div>
        
                <!-- Beneficiary Details (TPV Specific) -->
                <div class="section">
                    <h2 class="section-title">Beneficiary Details (TPV Validation)</h2>
                    <div class="alert alert-warning">
                        <strong>Note:</strong> You can add up to 4 beneficiary accounts. Multiple accounts should be separated by pipe (|) symbol in the same order.
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="tpv_beneficiary_account">Beneficiary Account Number(s) <span class="required">*</span></label>
                            <input type="text" id="tpv_beneficiary_account" name="beneficiary_account" 
                                   value="919013353419388" 
                                   placeholder="919013353419388" required>
                            <small style="color: var(--text-tertiary);">For multiple accounts, separate with pipe (|) - Max 4 accounts</small>
                        </div>
                        <div class="form-group">
                            <label for="tpv_ifsc_code">IFSC Code(s) <span class="required">*</span></label>
                            <input type="text" id="tpv_ifsc_code" name="ifsc_code" 
                                   value="UTIB9992478" 
                                   placeholder="UTIB9992478" required>
                            <small style="color: var(--text-tertiary);">For multiple IFSCs, separate with pipe (|) in same order</small>
                        </div>
                    </div>
                </div>
            
                <!-- UDF Parameters -->
                <div class="section udf-section">
                    <h2 class="section-title">UDF Parameters (User Defined Fields)</h2>
                    <div class="alert alert-info">
                        <strong>UDF Information:</strong> All UDF fields are optional for TPV transactions. Use these fields to pass additional transaction-specific data.
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="tpv_udf1">UDF1 <span class="optional">(Optional)</span></label>
                            <input type="text" id="tpv_udf1" name="udf1" placeholder="User defined field 1">
                        </div>
                        <div class="form-group">
                            <label for="tpv_udf2">UDF2 <span class="optional">(Optional)</span></label>
                            <input type="text" id="tpv_udf2" name="udf2" placeholder="User defined field 2">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="tpv_udf3">UDF3 <span class="optional">(Optional)</span></label>
                            <input type="text" id="tpv_udf3" name="udf3" placeholder="User defined field 3">
                        </div>
                        <div class="form-group">
                            <label for="tpv_udf4">UDF4 <span class="optional">(Optional)</span></label>
                            <input type="text" id="tpv_udf4" name="udf4" placeholder="User defined field 4">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="tpv_udf5">UDF5 <span class="optional">(Optional)</span></label>
                        <input type="text" id="tpv_udf5" name="udf5" placeholder="User defined field 5">
                    </div>
                </div>
            </div>
            
            <!-- Redirect URLs -->
            <div class="section">
                <h2 class="section-title">Redirect URLs</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label for="tpv_surl">Success URL <span class="required">*</span></label>
                        <input type="url" id="tpv_surl" name="surl" value="https://test.payu.in/admin/test_response" required>
                    </div>
                    <div class="form-group">
                        <label for="tpv_furl">Failure URL <span class="required">*</span></label>
                        <input type="url" id="tpv_furl" name="furl" value="https://test.payu.in/admin/test_response" required>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="pay-button-wrapper">
                <button type="button" class="button debug-button" onclick="showDebugInfo('tpv')">Show Debug Info</button>
                <button type="button" class="button debug-button" onclick="showCurlCommand('tpv')">Generate CURL</button>
                <button type="button" class="button" onclick="submitPayment('tpv')">Pay Now</button>
            </div>
        </div>
        
        <!-- Debug Section -->
        <div class="debug-section" id="tpv-debugSection">
            <h3 class="debug-title">Debug Information</h3>
            <div id="tpv-debugContent"></div>
        </div>
        
        <!-- CURL Section -->
        <div class="curl-section" id="tpv-curlSection">
            <h3>CURL Command</h3>
            <button class="copy-button" onclick="copyCurlToClipboard('tpv')">Copy to Clipboard</button>
            <div class="curl-content" id="tpv-curlContent"></div>
        </div>
    </div>
    
    <!-- UPI OTM Flow -->
    <div class="flow-content" id="upiotmFlow">
        <button class="back-button" onclick="backToLanding()">Back to Flow Selection</button>
        
        <div class="main-content">
            <!-- Configuration Settings -->
            <div class="section">
                <h2 class="section-title">Configuration Settings</h2>
                
                <div class="alert alert-info">
                    <strong>UPI One Time Mandate:</strong> Create a one-time pre-authorization for UPI payments. The mandate is valid for the specified date range (max 14 days).
                </div>
                
                <!-- Mandate Date Configuration -->
                <div class="form-group">
                    <h3 style="color: var(--accent-primary); margin-bottom: 1rem;">Mandate Date Configuration</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="upi_payment_start_date">Payment Start Date <span class="required">*</span></label>
                            <input type="date" id="upi_payment_start_date" name="payment_start_date" onchange="validateUpiOtmDates()" required>
                        </div>
                        <div class="form-group">
                            <label for="upi_payment_end_date">Payment End Date <span class="required">*</span></label>
                            <input type="date" id="upi_payment_end_date" name="payment_end_date" onchange="validateUpiOtmDates()" required>
                            <small style="color: var(--text-tertiary);">Max 14 days from start date</small>
                        </div>
                    </div>
                </div>
                
                <!-- Custom Key/Salt Toggle -->
                <div class="custom-key-toggle">
                    <label>
                        <input type="checkbox" id="upi_use_custom_keys" onchange="toggleCustomKeys('upiotm')">
                        Use Custom Merchant Key & Salt (for testing with your own credentials)
                    </label>
                    <div class="custom-key-fields" id="upi-custom-key-fields">
                        <div class="form-group">
                            <label for="upi_custom_key">Custom Merchant Key <span class="required">*</span></label>
                            <input type="text" id="upi_custom_key" name="custom_key" placeholder="Enter your PayU Merchant Key">
                        </div>
                        <div class="form-group">
                            <label for="upi_custom_salt">Custom Merchant Salt <span class="required">*</span></label>
                            <div style="position: relative;">
                                <input type="password" id="upi_custom_salt" name="custom_salt" placeholder="Enter your PayU Merchant Salt" style="padding-right: 40px;">
                                <button type="button" onclick="toggleSaltVisibility('upiotm')" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: 12px; color: #666;" title="Show/Hide Salt">Show</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Payment Details -->
            <div class="section">
                <h2 class="section-title">Payment Details</h2>
                
                <div class="alert alert-info" style="margin-bottom: 1.5rem;">
                    <strong>Amount Condition:</strong> For Success Amount &gt;= Rs. 17,000
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="upi_amount">Amount <span class="required">*</span></label>
                        <input type="number" id="upi_amount" name="amount" step="0.01" placeholder="100.00" value="17000" required>
                    </div>
                    <div class="form-group">
                        <label for="upi_productinfo">Product Info <span class="required">*</span></label>
                        <input type="text" id="upi_productinfo" name="productinfo" placeholder="Product or service description" required>
                    </div>
                </div>
                
                <h3 style="color: var(--accent-primary); margin: 2rem 0 1rem 0;">Customer Details</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="upi_firstname">First Name <span class="required">*</span></label>
                        <input type="text" id="upi_firstname" name="firstname" placeholder="John" required>
                    </div>
                    <div class="form-group">
                        <label for="upi_lastname">Last Name <span class="optional">(Optional)</span></label>
                        <input type="text" id="upi_lastname" name="lastname" placeholder="Doe">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="upi_email">Email <span class="required">*</span></label>
                        <input type="email" id="upi_email" name="email" placeholder="john.doe@example.com" required>
                        <div id="upi-email-error" class="error-message" style="display: none;"></div>
                    </div>
                    <div class="form-group">
                        <label for="upi_phone">Phone (10 digits) <span class="required">*</span></label>
                        <input type="text" id="upi_phone" name="phone" placeholder="9876543210" required maxlength="10" pattern="[0-9]{10}" oninput="validatePhone('upiotm')">
                        <div id="upi-phone-error" class="error-message" style="display: none;"></div>
                    </div>
                </div>
                
                <h3 style="color: var(--accent-primary); margin: 2rem 0 1rem 0;">Address Details <span class="optional">(Optional)</span></h3>
                
                <div class="form-group">
                    <label for="upi_address1">Address Line 1 <span class="optional">(Optional)</span></label>
                    <input type="text" id="upi_address1" name="address1" placeholder="Street address">
                </div>
                
                <div class="form-group">
                    <label for="upi_address2">Address Line 2 <span class="optional">(Optional)</span></label>
                    <input type="text" id="upi_address2" name="address2" placeholder="Apartment, suite, etc.">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="upi_city">City <span class="optional">(Optional)</span></label>
                        <input type="text" id="upi_city" name="city" placeholder="Mumbai">
                    </div>
                    <div class="form-group">
                        <label for="upi_state">State <span class="optional">(Optional)</span></label>
                        <input type="text" id="upi_state" name="state" placeholder="Maharashtra">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="upi_country">Country <span class="optional">(Optional)</span></label>
                        <input type="text" id="upi_country" name="country" placeholder="India">
                    </div>
                    <div class="form-group">
                        <label for="upi_zipcode">ZIP Code <span class="optional">(Optional)</span></label>
                        <input type="text" id="upi_zipcode" name="zipcode" placeholder="400001">
                    </div>
                </div>
            </div>
            
            <!-- UDF Parameters -->
            <div class="section">
                <h2 class="section-title">UDF Parameters</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="upi_udf1">UDF1 <span class="optional">(Optional)</span></label>
                        <input type="text" id="upi_udf1" name="udf1" placeholder="">
                    </div>
                    <div class="form-group">
                        <label for="upi_udf2">UDF2 <span class="optional">(Optional)</span></label>
                        <input type="text" id="upi_udf2" name="udf2" placeholder="">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="upi_udf3">UDF3 <span class="optional">(Optional)</span></label>
                        <input type="text" id="upi_udf3" name="udf3" placeholder="">
                    </div>
                    <div class="form-group">
                        <label for="upi_udf4">UDF4 <span class="optional">(Optional)</span></label>
                        <input type="text" id="upi_udf4" name="udf4" placeholder="">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="upi_udf5">UDF5 <span class="optional">(Optional)</span></label>
                    <input type="text" id="upi_udf5" name="udf5" placeholder="">
                </div>
            </div>
            
            <!-- Redirect URLs -->
            <div class="section">
                <h2 class="section-title">Redirect URLs</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="upi_surl">Success URL <span class="required">*</span></label>
                        <input type="url" id="upi_surl" name="surl" value="https://test.payu.in/admin/test_response" required>
                    </div>
                    <div class="form-group">
                        <label for="upi_furl">Failure URL <span class="required">*</span></label>
                        <input type="url" id="upi_furl" name="furl" value="https://test.payu.in/admin/test_response" required>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="pay-button-wrapper">
                <button type="button" class="button debug-button" onclick="showDebugInfo('upiotm')">Show Debug Info</button>
                <button type="button" class="button debug-button" onclick="showCurlCommand('upiotm')">Generate CURL</button>
                <button type="button" class="button" onclick="submitPayment('upiotm')">Pay Now</button>
            </div>
        </div>
        
        <!-- Debug Section -->
        <div class="debug-section" id="upi-debugSection">
            <h3 class="debug-title">Debug Information</h3>
            <div id="upi-debugContent"></div>
        </div>
        
        <!-- CURL Section -->
        <div class="curl-section" id="upi-curlSection">
            <h3>CURL Command</h3>
            <button class="copy-button" onclick="copyCurlToClipboard('upiotm')">Copy to Clipboard</button>
            <div class="curl-content" id="upi-curlContent"></div>
        </div>
    </div>
    
    <!-- PreAuth Card Flow -->
    <div class="flow-content" id="preauthFlow">
        <button class="back-button" onclick="backToLanding()">Back to Flow Selection</button>
        
        <div class="main-content">
            <!-- Configuration Settings -->
            <div class="section">
                <h2 class="section-title">Configuration Settings</h2>
                
                <div class="alert alert-info">
                    <strong>Pre-Authorization Payment:</strong> Amount will be blocked on customer's card but not captured immediately. Only Credit and Debit Cards are supported for this flow.
                </div>
                
                <!-- Custom Key/Salt Toggle -->
                <div class="custom-key-toggle">
                    <label>
                        <input type="checkbox" id="preauth_use_custom_keys" onchange="toggleCustomKeys('preauth')">
                        Use Custom Merchant Key & Salt (for testing with your own credentials)
                    </label>
                    <div class="custom-key-fields" id="preauth-custom-key-fields">
                        <div class="form-group">
                            <label for="preauth_custom_key">Custom Merchant Key <span class="required">*</span></label>
                            <input type="text" id="preauth_custom_key" name="custom_key" placeholder="Enter your PayU Merchant Key">
                        </div>
                        <div class="form-group">
                            <label for="preauth_custom_salt">Custom Merchant Salt <span class="required">*</span></label>
                            <div style="position: relative;">
                                <input type="password" id="preauth_custom_salt" name="custom_salt" placeholder="Enter your PayU Merchant Salt" style="padding-right: 40px;">
                                <button type="button" onclick="toggleSaltVisibility('preauth')" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: 12px; color: #666;" title="Show/Hide Salt">Show</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Enforce Payment Methods <span class="required">*</span></label>
                    <div class="payment-methods">
                        <div class="payment-method">
                            <input type="checkbox" id="preauth_cc" name="preauth_paymethod" value="CC" checked>
                            <label for="preauth_cc">Credit Cards</label>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Payment Details -->
            <div class="section">
                <h2 class="section-title">Payment Details</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="preauth_amount">Amount <span class="required">*</span></label>
                        <input type="number" id="preauth_amount" name="amount" step="0.01" placeholder="100.00" required>
                    </div>
                    <div class="form-group">
                        <label for="preauth_productinfo">Product Info <span class="required">*</span></label>
                        <input type="text" id="preauth_productinfo" name="productinfo" placeholder="Product or service description" required>
                    </div>
                </div>
                
                <h3 style="color: var(--accent-primary); margin: 2rem 0 1rem 0;">Customer Details</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="preauth_firstname">First Name <span class="required">*</span></label>
                        <input type="text" id="preauth_firstname" name="firstname" placeholder="John" required>
                    </div>
                    <div class="form-group">
                        <label for="preauth_lastname">Last Name <span class="optional">(Optional)</span></label>
                        <input type="text" id="preauth_lastname" name="lastname" placeholder="Doe">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="preauth_email">Email <span class="required">*</span></label>
                        <input type="email" id="preauth_email" name="email" placeholder="john.doe@example.com" required>
                        <div id="preauth-email-error" class="error-message" style="display: none;"></div>
                    </div>
                    <div class="form-group">
                        <label for="preauth_phone">Phone (10 digits) <span class="required">*</span></label>
                        <input type="text" id="preauth_phone" name="phone" placeholder="9876543210" required maxlength="10" pattern="[0-9]{10}" oninput="validatePhone('preauth')">
                        <div id="preauth-phone-error" class="error-message" style="display: none;"></div>
                    </div>
                </div>
                
                <h3 style="color: var(--accent-primary); margin: 2rem 0 1rem 0;">Address Details <span class="optional">(Optional)</span></h3>
                
                <div class="form-group">
                    <label for="preauth_address1">Address Line 1 <span class="optional">(Optional)</span></label>
                    <input type="text" id="preauth_address1" name="address1" placeholder="Street address">
                </div>
                
                <div class="form-group">
                    <label for="preauth_address2">Address Line 2 <span class="optional">(Optional)</span></label>
                    <input type="text" id="preauth_address2" name="address2" placeholder="Apartment, suite, etc.">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="preauth_city">City <span class="optional">(Optional)</span></label>
                        <input type="text" id="preauth_city" name="city" placeholder="Mumbai">
                    </div>
                    <div class="form-group">
                        <label for="preauth_state">State <span class="optional">(Optional)</span></label>
                        <input type="text" id="preauth_state" name="state" placeholder="Maharashtra">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="preauth_country">Country <span class="optional">(Optional)</span></label>
                        <input type="text" id="preauth_country" name="country" placeholder="India">
                    </div>
                    <div class="form-group">
                        <label for="preauth_zipcode">ZIP Code <span class="optional">(Optional)</span></label>
                        <input type="text" id="preauth_zipcode" name="zipcode" placeholder="400001">
                    </div>
                </div>
            </div>
            
            <!-- UDF Parameters -->
            <div class="section">
                <h2 class="section-title">UDF Parameters</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="preauth_udf1">UDF1 <span class="optional">(Optional)</span></label>
                        <input type="text" id="preauth_udf1" name="udf1" placeholder="">
                    </div>
                    <div class="form-group">
                        <label for="preauth_udf2">UDF2 <span class="optional">(Optional)</span></label>
                        <input type="text" id="preauth_udf2" name="udf2" placeholder="">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="preauth_udf3">UDF3 <span class="optional">(Optional)</span></label>
                        <input type="text" id="preauth_udf3" name="udf3" placeholder="">
                    </div>
                    <div class="form-group">
                        <label for="preauth_udf4">UDF4 <span class="optional">(Optional)</span></label>
                        <input type="text" id="preauth_udf4" name="udf4" placeholder="">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="preauth_udf5">UDF5 <span class="optional">(Optional)</span></label>
                    <input type="text" id="preauth_udf5" name="udf5" placeholder="">
                </div>
            </div>
            
            <!-- Redirect URLs -->
            <div class="section">
                <h2 class="section-title">Redirect URLs</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="preauth_surl">Success URL <span class="required">*</span></label>
                        <input type="url" id="preauth_surl" name="surl" value="https://test.payu.in/admin/test_response" required>
                    </div>
                    <div class="form-group">
                        <label for="preauth_furl">Failure URL <span class="required">*</span></label>
                        <input type="url" id="preauth_furl" name="furl" value="https://test.payu.in/admin/test_response" required>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="pay-button-wrapper">
                <button type="button" class="button debug-button" onclick="showDebugInfo('preauth')">Show Debug Info</button>
                <button type="button" class="button debug-button" onclick="showCurlCommand('preauth')">Generate CURL</button>
                <button type="button" class="button" onclick="submitPayment('preauth')">Pay Now</button>
            </div>
        </div>
        
        <!-- Debug Section -->
        <div class="debug-section" id="preauth-debugSection">
            <h3 class="debug-title">Debug Information</h3>
            <div id="preauth-debugContent"></div>
        </div>
        
        <!-- CURL Section -->
        <div class="curl-section" id="preauth-curlSection">
            <h3>CURL Command</h3>
            <button class="copy-button" onclick="copyCurlToClipboard('preauth')">Copy to Clipboard</button>
            <div class="curl-content" id="preauth-curlContent"></div>
        </div>
    </div>
    
    <!-- PreAuth Hidden Form -->
    <form id="preauth_payu_form" method="post" action="https://test.payu.in/_payment" style="display: none;">
        <input type="hidden" id="preauth_key" name="key">
        <input type="hidden" id="preauth_txnid" name="txnid">
        <input type="hidden" id="preauth_amount_hidden" name="amount">
        <input type="hidden" id="preauth_productinfo_hidden" name="productinfo">
        <input type="hidden" id="preauth_firstname_hidden" name="firstname">
        <input type="hidden" id="preauth_lastname_hidden" name="lastname">
        <input type="hidden" id="preauth_email_hidden" name="email">
        <input type="hidden" id="preauth_phone_hidden" name="phone">
        <input type="hidden" id="preauth_address1_hidden" name="address1">
        <input type="hidden" id="preauth_address2_hidden" name="address2">
        <input type="hidden" id="preauth_city_hidden" name="city">
        <input type="hidden" id="preauth_state_hidden" name="state">
        <input type="hidden" id="preauth_country_hidden" name="country">
        <input type="hidden" id="preauth_zipcode_hidden" name="zipcode">
        <input type="hidden" id="preauth_udf1_hidden" name="udf1">
        <input type="hidden" id="preauth_udf2_hidden" name="udf2">
        <input type="hidden" id="preauth_udf3_hidden" name="udf3">
        <input type="hidden" id="preauth_udf4_hidden" name="udf4">
        <input type="hidden" id="preauth_udf5_hidden" name="udf5">
        <input type="hidden" id="preauth_surl_hidden" name="surl">
        <input type="hidden" id="preauth_furl_hidden" name="furl">
        <input type="hidden" id="preauth_hash" name="hash">
        <input type="hidden" id="preauth_pre_authorize" name="pre_authorize" value="1">
    </form>
    
    <!-- Checkout Plus Flow -->
    <div class="flow-content" id="checkoutplusFlow">
        <button class="back-button" onclick="backToLanding()">Back to Flow Selection</button>
        
        <div class="main-content">
            <!-- Configuration Settings -->
            <div class="section">
                <h2 class="section-title">Configuration Settings</h2>
                
                <div class="alert alert-info">
                    <strong>Checkout Plus:</strong> JavaScript SDK-based payment with modal checkout experience.
                </div>
                
                <!-- Custom Key/Salt Toggle -->
                <div class="custom-key-toggle">
                    <label>
                        <input type="checkbox" id="cp_use_custom_keys" onchange="toggleCustomKeys('checkoutplus')">
                        Use Custom Merchant Key & Salt (for testing with your own credentials)
                    </label>
                    <div class="custom-key-fields" id="cp-custom-key-fields">
                        <div class="form-group">
                            <label for="cp_custom_key">Custom Merchant Key <span class="required">*</span></label>
                            <input type="text" id="cp_custom_key" name="custom_key" placeholder="Enter your PayU Merchant Key">
                        </div>
                        <div class="form-group">
                            <label for="cp_custom_salt">Custom Merchant Salt <span class="required">*</span></label>
                            <div style="position: relative;">
                                <input type="password" id="cp_custom_salt" name="custom_salt" placeholder="Enter your PayU Merchant Salt" style="padding-right: 40px;">
                                <button type="button" onclick="toggleSaltVisibility('checkoutplus')" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: 12px; color: #666;" title="Show/Hide Salt">Show</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Enforce Payment Methods <span class="optional">(Optional)</span></label>
                    <div class="payment-methods">
                        <div class="payment-method">
                            <input type="checkbox" id="cp_cc" name="cp_paymethod" value="CC">
                            <label for="cp_cc">Credit Cards</label>
                        </div>
                        <div class="payment-method">
                            <input type="checkbox" id="cp_dc" name="cp_paymethod" value="DC">
                            <label for="cp_dc">Debit Cards</label>
                        </div>
                        <div class="payment-method">
                            <input type="checkbox" id="cp_nb" name="cp_paymethod" value="NB">
                            <label for="cp_nb">Net Banking</label>
                        </div>
                        <div class="payment-method">
                            <input type="checkbox" id="cp_upi" name="cp_paymethod" value="UPI">
                            <label for="cp_upi">UPI</label>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Payment Details -->
            <div class="section">
                <h2 class="section-title">Payment Details</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="cp_amount">Amount <span class="required">*</span></label>
                        <input type="number" id="cp_amount" name="amount" step="0.01" placeholder="100.00" required>
                    </div>
                    <div class="form-group">
                        <label for="cp_productinfo">Product Info <span class="required">*</span></label>
                        <input type="text" id="cp_productinfo" name="productinfo" placeholder="Product or service description" required>
                    </div>
                </div>
                
                <h3 style="color: var(--accent-primary); margin: 2rem 0 1rem 0;">Customer Details</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="cp_firstname">First Name <span class="required">*</span></label>
                        <input type="text" id="cp_firstname" name="firstname" placeholder="John" required>
                    </div>
                    <div class="form-group">
                        <label for="cp_lastname">Last Name <span class="optional">(Optional)</span></label>
                        <input type="text" id="cp_lastname" name="lastname" placeholder="Doe">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="cp_email">Email <span class="required">*</span></label>
                        <input type="email" id="cp_email" name="email" placeholder="john.doe@example.com" required>
                        <div id="cp-email-error" class="error-message" style="display: none;"></div>
                    </div>
                    <div class="form-group">
                        <label for="cp_phone">Phone (10 digits) <span class="required">*</span></label>
                        <input type="text" id="cp_phone" name="phone" placeholder="9876543210" required maxlength="10" pattern="[0-9]{10}">
                        <div id="cp-phone-error" class="error-message" style="display: none;"></div>
                    </div>
                </div>
                
                <h3 style="color: var(--accent-primary); margin: 2rem 0 1rem 0;">Address Details <span class="optional">(Optional)</span></h3>
                
                <div class="form-group">
                    <label for="cp_address1">Address Line 1 <span class="optional">(Optional)</span></label>
                    <input type="text" id="cp_address1" name="address1" placeholder="Street address">
                </div>
                
                <div class="form-group">
                    <label for="cp_address2">Address Line 2 <span class="optional">(Optional)</span></label>
                    <input type="text" id="cp_address2" name="address2" placeholder="Apartment, suite, etc.">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="cp_city">City <span class="optional">(Optional)</span></label>
                        <input type="text" id="cp_city" name="city" placeholder="Mumbai">
                    </div>
                    <div class="form-group">
                        <label for="cp_state">State <span class="optional">(Optional)</span></label>
                        <input type="text" id="cp_state" name="state" placeholder="Maharashtra">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="cp_country">Country <span class="optional">(Optional)</span></label>
                        <input type="text" id="cp_country" name="country" placeholder="India">
                    </div>
                    <div class="form-group">
                        <label for="cp_zipcode">ZIP Code <span class="optional">(Optional)</span></label>
                        <input type="text" id="cp_zipcode" name="zipcode" placeholder="400001">
                    </div>
                </div>
            </div>
            
            <!-- UDF Parameters -->
            <div class="section">
                <h2 class="section-title">UDF Parameters (Optional)</h2>
                
                <div class="alert alert-info">
                    <strong>UDF Information:</strong> User Defined Fields for custom data - all optional.
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="cp_udf1">UDF1 <span class="optional">(Optional)</span></label>
                        <input type="text" id="cp_udf1" name="udf1" placeholder="User defined field 1">
                    </div>
                    <div class="form-group">
                        <label for="cp_udf2">UDF2 <span class="optional">(Optional)</span></label>
                        <input type="text" id="cp_udf2" name="udf2" placeholder="User defined field 2">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="cp_udf3">UDF3 <span class="optional">(Optional)</span></label>
                        <input type="text" id="cp_udf3" name="udf3" placeholder="User defined field 3">
                    </div>
                    <div class="form-group">
                        <label for="cp_udf4">UDF4 <span class="optional">(Optional)</span></label>
                        <input type="text" id="cp_udf4" name="udf4" placeholder="User defined field 4">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="cp_udf5">UDF5 <span class="optional">(Optional)</span></label>
                    <input type="text" id="cp_udf5" name="udf5" placeholder="User defined field 5">
                </div>
            </div>
            
            <!-- Redirect URLs -->
            <div class="section">
                <h2 class="section-title">Callback URLs</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="cp_surl">Success URL <span class="required">*</span></label>
                        <input type="url" id="cp_surl" name="surl" value="https://test.payu.in/admin/test_response" required>
                    </div>
                    <div class="form-group">
                        <label for="cp_furl">Failure URL <span class="required">*</span></label>
                        <input type="url" id="cp_furl" name="furl" value="https://test.payu.in/admin/test_response" required>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="pay-button-wrapper">
                <button type="button" class="button debug-button" onclick="showDebugInfo('checkoutplus')">Show Debug Info</button>
                <button type="button" class="button debug-button" onclick="showCurlCommand('checkoutplus')">Generate CURL</button>
                <button type="button" class="button" onclick="launchCheckoutPlus()">Pay with Checkout Plus</button>
            </div>
        </div>
        
        <!-- Debug Section -->
        <div class="debug-section" id="cp-debugSection">
            <h3 class="debug-title">Debug Information</h3>
            <div id="cp-debugContent"></div>
        </div>
        
        <!-- CURL Section -->
        <div class="curl-section" id="cp-curlSection">
            <h3>CURL Command</h3>
            <button class="copy-button" onclick="copyCurlToClipboard('checkoutplus')">Copy to Clipboard</button>
            <div class="curl-content" id="cp-curlContent"></div>
        </div>
    </div>
    
    <!-- Checkout Plus Hidden Fields -->
    <input type="hidden" id="cp_txnid" name="txnid">
    
    <!-- Split Payment Flow -->
    <div class="flow-content" id="splitFlow">
        <button class="back-button" onclick="backToLanding()">Back to Flow Selection</button>
        
        <div class="main-content">
            <!-- Configuration Settings -->
            <div class="section">
                <h2 class="section-title">Configuration Settings</h2>
                
                <div class="alert alert-info">
                    <strong>About Split Payment:</strong> Distribute a single transaction amount across multiple merchant accounts. Supports both absolute amount and percentage-based splitting.
                    <br><strong>Use Cases:</strong> Marketplace platforms, commission-based transactions, aggregator models.
                </div>
                
                <!-- Custom Key/Salt Toggle -->
                <div class="custom-key-toggle">
                    <label class="checkbox-container">
                        <input type="checkbox" id="split_use_custom_keys" name="use_custom_keys" onchange="toggleCustomKeys('split')">
                        <span class="checkbox-label">Use Custom Merchant Key & Salt (for testing with your own credentials)</span>
                    </label>
                    
                    <div class="custom-key-fields" id="split-custom-key-fields">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="split_custom_key">Merchant Key <span class="required">*</span></label>
                                <input type="text" id="split_custom_key" name="custom_key" placeholder="Enter your merchant key">
                            </div>
                            <div class="form-group">
                                <label for="split_custom_salt">Merchant Salt <span class="required">*</span></label>
                                <input type="password" id="split_custom_salt" name="custom_salt" placeholder="Enter your merchant salt">
                                <button type="button" class="toggle-visibility" onclick="toggleSaltVisibility('split')">Show</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Payment Details -->
            <div class="section">
                <h2 class="section-title">Payment Details</h2>
                
                <!-- Transaction ID (hidden but auto-generated) -->
                <input type="hidden" id="split_txnid" name="txnid">
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="split_amount">Amount (INR) <span class="required">*</span></label>
                        <input type="number" id="split_amount" name="amount" placeholder="100.00" step="0.01" min="1" required>
                        <small style="color: var(--text-tertiary);">Total transaction amount</small>
                    </div>
                    <div class="form-group">
                        <label for="split_productinfo">Product Info <span class="required">*</span></label>
                        <input type="text" id="split_productinfo" name="productinfo" placeholder="Product description" required>
                    </div>
                </div>
                
            </div>
            
            <!-- Customer Information -->
            <div class="section">
                <h2 class="section-title">Customer Information</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="split_firstname">First Name <span class="required">*</span></label>
                        <input type="text" id="split_firstname" name="firstname" placeholder="John" required>
                    </div>
                    <div class="form-group">
                        <label for="split_lastname">Last Name <span class="optional">(Optional)</span></label>
                        <input type="text" id="split_lastname" name="lastname" placeholder="Doe">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="split_email">Email <span class="required">*</span></label>
                        <input type="email" id="split_email" name="email" placeholder="[email protected]" required>
                    </div>
                    <div class="form-group">
                        <label for="split_phone">Phone <span class="required">*</span></label>
                        <input type="tel" id="split_phone" name="phone" placeholder="9876543210" required>
                    </div>
                </div>
            </div>
            
            <!-- Address Information -->
            <div class="section">
                <h2 class="section-title">Address Information <span class="optional">(Optional)</span></h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="split_address1">Address Line 1</label>
                        <input type="text" id="split_address1" name="address1" placeholder="Street address">
                    </div>
                    <div class="form-group">
                        <label for="split_address2">Address Line 2</label>
                        <input type="text" id="split_address2" name="address2" placeholder="Apartment, suite, etc.">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="split_city">City</label>
                        <input type="text" id="split_city" name="city" placeholder="Mumbai">
                    </div>
                    <div class="form-group">
                        <label for="split_state">State</label>
                        <input type="text" id="split_state" name="state" placeholder="Maharashtra">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="split_country">Country</label>
                        <input type="text" id="split_country" name="country" placeholder="India">
                    </div>
                    <div class="form-group">
                        <label for="split_zipcode">Zip Code</label>
                        <input type="text" id="split_zipcode" name="zipcode" placeholder="400001">
                    </div>
                </div>
                
            </div>
            
            <!-- UDF Parameters -->
            <div class="section">
                <h2 class="section-title">UDF Parameters (Optional)</h2>
                
                <div class="alert alert-info">
                    <strong>UDF Information:</strong> User Defined Fields for custom data - all optional.
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="split_udf1">UDF1 <span class="optional">(Optional)</span></label>
                        <input type="text" id="split_udf1" name="udf1" placeholder="User defined field 1">
                    </div>
                    <div class="form-group">
                        <label for="split_udf2">UDF2 <span class="optional">(Optional)</span></label>
                        <input type="text" id="split_udf2" name="udf2" placeholder="User defined field 2">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="split_udf3">UDF3 <span class="optional">(Optional)</span></label>
                        <input type="text" id="split_udf3" name="udf3" placeholder="User defined field 3">
                    </div>
                    <div class="form-group">
                        <label for="split_udf4">UDF4 <span class="optional">(Optional)</span></label>
                        <input type="text" id="split_udf4" name="udf4" placeholder="User defined field 4">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="split_udf5">UDF5 <span class="optional">(Optional)</span></label>
                    <input type="text" id="split_udf5" name="udf5" placeholder="User defined field 5">
                </div>
            </div>
            
            <!-- Split Payment Configuration -->
            <div class="section">
                <h2 class="section-title">Split Payment Configuration <span class="required">*</span></h2>
                
                <div class="alert alert-warning">
                    <strong>Important:</strong> Split merchant keys must be pre-configured and linked to your parent merchant account. Contact PayU support for split setup.
                </div>
                
                <div class="form-group">
                    <label>Split Type <span class="required">*</span></label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="split_type" value="absolute" checked onchange="updateSplitPlaceholders()">
                            <span>Amount Based (Absolute)</span>
                            <small>Specify exact amounts in INR</small>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="split_type" value="percentage" onchange="updateSplitPlaceholders()">
                            <span>Percentage Based</span>
                            <small>Specify percentage of total amount</small>
                        </label>
                    </div>
                </div>
                
                <div id="splitDetailsContainer">
                    <h4>Split Details (Child Merchants)</h4>
                    <div id="splitRowsContainer">
                        <!-- Split rows will be added dynamically -->
                    </div>
                    <button type="button" class="button" onclick="addSplitRow()" style="background: var(--success-color); margin-top: 10px;">
                        + Add Another Split Merchant
                    </button>
                </div>
                
            </div>
            
            <!-- Payment Methods -->
            <div class="section">
                <h2 class="section-title">Payment Methods <span class="optional">(Optional - Enforce Specific Methods)</span></h2>
                
                <div class="payment-methods">
                    <label class="payment-method">
                        <input type="checkbox" id="split_cc" name="split_paymethod" value="CC">
                        <span>Credit Card</span>
                    </label>
                    <label class="payment-method">
                        <input type="checkbox" id="split_dc" name="split_paymethod" value="DC">
                        <span>Debit Card</span>
                    </label>
                    <label class="payment-method">
                        <input type="checkbox" id="split_nb" name="split_paymethod" value="NB">
                        <span>Net Banking</span>
                    </label>
                    <label class="payment-method">
                        <input type="checkbox" id="split_upi" name="split_paymethod" value="UPI">
                        <span>UPI</span>
                    </label>
                </div>
            </div>
            
            <!-- Redirect URLs -->
            <div class="section">
                <h2 class="section-title">Redirect URLs</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="split_surl">Success URL <span class="required">*</span></label>
                        <input type="url" id="split_surl" name="surl" value="https://test.payu.in/admin/test_response" required>
                    </div>
                    <div class="form-group">
                        <label for="split_furl">Failure URL <span class="required">*</span></label>
                        <input type="url" id="split_furl" name="furl" value="https://test.payu.in/admin/test_response" required>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="pay-button-wrapper">
                    <button type="button" class="button debug-button" onclick="showDebugInfo('split')">Show Debug Info</button>
                    <button type="button" class="button debug-button" onclick="showCurlCommand('split')">Generate CURL</button>
                    <button type="button" class="button" onclick="submitPayment('split')">Pay Now</button>
                </div>
            </div>
        </div>
        
        <!-- Debug Section -->
        <div class="debug-section" id="split-debugSection">
            <h3 class="debug-title">Debug Information</h3>
            <div id="split-debugContent"></div>
        </div>
        
        <!-- CURL Section -->
        <div class="curl-section" id="split-curlSection">
            <h3>CURL Command</h3>
            <button class="copy-button" onclick="copyCurlToClipboard('split')">Copy to Clipboard</button>
            <div class="curl-content" id="split-curlContent"></div>
        </div>
    </div>
    
    <!-- Split Payment Hidden Form -->
    <form id="split_payu_form" method="post" action="https://test.payu.in/_payment" style="display: none;">
        <input type="hidden" id="split_key" name="key">
        <input type="hidden" id="split_txnid_hidden" name="txnid">
        <input type="hidden" id="split_amount_hidden" name="amount">
        <input type="hidden" id="split_productinfo_hidden" name="productinfo">
        <input type="hidden" id="split_firstname_hidden" name="firstname">
        <input type="hidden" id="split_lastname_hidden" name="lastname">
        <input type="hidden" id="split_email_hidden" name="email">
        <input type="hidden" id="split_phone_hidden" name="phone">
        <input type="hidden" id="split_address1_hidden" name="address1">
        <input type="hidden" id="split_address2_hidden" name="address2">
        <input type="hidden" id="split_city_hidden" name="city">
        <input type="hidden" id="split_state_hidden" name="state">
        <input type="hidden" id="split_country_hidden" name="country">
        <input type="hidden" id="split_zipcode_hidden" name="zipcode">
        <input type="hidden" id="split_udf1_hidden" name="udf1">
        <input type="hidden" id="split_udf2_hidden" name="udf2">
        <input type="hidden" id="split_udf3_hidden" name="udf3">
        <input type="hidden" id="split_udf4_hidden" name="udf4">
        <input type="hidden" id="split_udf5_hidden" name="udf5">
        <input type="hidden" id="split_surl_hidden" name="surl">
        <input type="hidden" id="split_furl_hidden" name="furl">
        <input type="hidden" id="split_hash" name="hash">
        <input type="hidden" id="split_splitRequest_hidden" name="splitRequest">
    </form>
    
    <!-- Bank Offers Flow -->
    <div class="flow-content" id="bankofferFlow">
        <button class="back-button" onclick="backToLanding()">Back to Flow Selection</button>
        
        <div class="main-content">
            <!-- Configuration Settings -->
            <div class="section">
                <h2 class="section-title">Configuration Settings</h2>
                
                <div class="alert alert-info">
                    <strong>About Bank Offers:</strong> Test instant discount and cashback offers with SKU/item-based cart details. Supports both predefined test scenarios and custom cart configurations.
                    <br><strong>Note:</strong> Minimum transaction amount &#8377;20,000 required for bank offers (For Predefined Credentials).
                </div>
                
                <!-- Custom Key/Salt Toggle -->
                <div class="custom-key-toggle">
                    <label>
                        <input type="checkbox" id="bo_use_custom_keys" onchange="toggleCustomKeys('bankoffer')">
                        Use Custom Merchant Key & Salt (for testing with your own credentials)
                    </label>
                    <div class="custom-key-fields" id="bo-custom-key-fields">
                        <div class="form-group">
                            <label for="bo_custom_key">Custom Merchant Key <span class="required">*</span></label>
                            <input type="text" id="bo_custom_key" name="custom_key" placeholder="Enter your PayU Merchant Key">
                        </div>
                        <div class="form-group">
                            <label for="bo_custom_salt">Custom Merchant Salt <span class="required">*</span></label>
                            <div style="position: relative;">
                                <input type="password" id="bo_custom_salt" name="custom_salt" placeholder="Enter your PayU Merchant Salt" style="padding-right: 40px;">
                                <button type="button" onclick="toggleSaltVisibility('bankoffer')" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: 12px; color: #666;" title="Show/Hide Salt">Show</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Payment Details -->
            <div class="section">
                <h2 class="section-title">Payment Details</h2>
                
                <!-- Transaction ID (hidden but auto-generated) -->
                <input type="hidden" id="bo_txnid" name="txnid">
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="bo_amount">Amount (INR) <span class="required">*</span></label>
                        <input type="number" id="bo_amount" name="amount" placeholder="20000.00" step="0.01" min="20000" value="20000" required>
                        <small style="color: var(--warning-color); font-weight: 600;">&#9888;&#65039; Minimum amount &#8377;20,000 required for Bank Offers (For Predefined Credentials)</small>
                    </div>
                    <div class="form-group">
                        <label for="bo_productinfo">Product Info <span class="required">*</span></label>
                        <input type="text" id="bo_productinfo" name="productinfo" placeholder="Product description" required>
                    </div>
                </div>
                
                <!-- Non-SKU Offer Key (for custom credentials) -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="bo_offer_key">Offer Key <span class="optional">(Optional)</span></label>
                        <input type="text" id="bo_offer_key" name="offer_key" placeholder="e.g., TestInstantDiscount@BVfeXGNr2FKy">
                        <small style="color: var(--text-tertiary);">For non-SKU based offers. Leave blank if using SKU details or to let PayU automatically apply the best available offer.</small>
                    </div>
                </div>
            </div>
            
            <!-- SKU/Item Based Offers Configuration -->
            <div class="section">
                <h2 class="section-title">SKU/Item Based Offers</h2>
                
                <div class="alert alert-info">
                    <strong>Enable SKU Details:</strong> Add cart details with item-level information to test bank offers. Leave unchecked for standard payment without SKU offers.
                </div>
                
                <!-- Enable SKU Toggle -->
                <div class="custom-key-toggle" style="margin-bottom: 1.5rem;">
                    <label>
                        <input type="checkbox" id="bo_enable_sku" onchange="toggleSkuOffers('bankoffer')">
                        Enable SKU/Item Based Offers
                    </label>
                </div>
                
                <!-- SKU Configuration Section (Hidden by default) -->
                <div id="bo-sku-config" style="display: none;">
                    <div class="alert alert-warning" style="margin-bottom: 1.5rem;">
                        <strong>Note:</strong> For predefined credentials, SKU 1 and 2 will have prefilled IDs/names. You need to enter amount and quantity. Additional SKUs will be blank. Maximum 5 SKUs allowed.
                    </div>
                    
                    <h3 style="color: var(--accent-primary); margin-bottom: 1rem;">SKU Items</h3>
                    
                    <div id="boSkuRowsContainer">
                        <!-- Dynamic SKU rows will be added here -->
                    </div>
                    
                    <button type="button" class="button" onclick="addBankOfferSkuRow()" style="margin-top: 1rem; background: var(--success-color);">
                        <span style="font-size: 1.2rem; margin-right: 0.25rem;">+</span> Add SKU Item
                    </button>
                    <small id="bo-sku-limit-msg" style="display: block; margin-top: 0.5rem; color: var(--text-tertiary);"></small>
                    
                    <!-- Cart Summary -->
                    <div style="margin-top: 1.5rem; padding: 1rem; background: var(--info-bg); border-radius: 8px; border-left: 4px solid var(--accent-primary);">
                        <h4 style="margin: 0 0 0.75rem 0; color: var(--accent-primary);">Cart Summary</h4>
                        <div id="bo-cart-summary" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.5rem;">
                            <p style="margin: 0;"><strong>Total Items:</strong> <span id="bo-total-items" style="color: var(--accent-primary);">0</span></p>
                            <p style="margin: 0;"><strong>Calculated Amount:</strong> <span style="color: var(--accent-primary);">&#8377;<span id="bo-calculated-amount">0.00</span></span></p>
                        </div>
                    </div>
                    
                    <!-- JSON Preview -->
                    <div style="margin-top: 1.5rem;">
                        <h4 style="color: var(--accent-primary); margin-bottom: 0.5rem;">Cart Details JSON Preview</h4>
                        <div style="position: relative;">
                            <pre id="bo-json-preview" style="background: var(--debug-bg); padding: 1rem; border-radius: 8px; overflow-x: auto; max-height: 400px; font-size: 0.85rem; border: 1px solid var(--border-color); min-height: 100px;"></pre>
                            <button type="button" onclick="copyBankOfferJson()" style="position: absolute; top: 10px; right: 10px; padding: 0.5rem 1rem; background: var(--accent-primary); color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 0.85rem; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">Copy JSON</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Customer Information -->
            <div class="section">
                <h2 class="section-title">Customer Information</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="bo_firstname">First Name <span class="required">*</span></label>
                        <input type="text" id="bo_firstname" name="firstname" placeholder="John" required>
                    </div>
                    <div class="form-group">
                        <label for="bo_lastname">Last Name <span class="optional">(Optional)</span></label>
                        <input type="text" id="bo_lastname" name="lastname" placeholder="Doe">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="bo_email">Email <span class="required">*</span></label>
                        <input type="email" id="bo_email" name="email" placeholder="john.doe@example.com" required>
                        <div id="bo-email-error" class="error-message" style="display: none;"></div>
                    </div>
                    <div class="form-group">
                        <label for="bo_phone">Phone (10 digits) <span class="required">*</span></label>
                        <input type="text" id="bo_phone" name="phone" placeholder="9876543210" required maxlength="10" pattern="[0-9]{10}">
                        <div id="bo-phone-error" class="error-message" style="display: none;"></div>
                    </div>
                </div>
            </div>
            
            <!-- Address Information -->
            <div class="section">
                <h2 class="section-title">Address Information <span class="optional">(Optional)</span></h2>
                
                <div class="form-group">
                    <label for="bo_address1">Address Line 1 <span class="optional">(Optional)</span></label>
                    <input type="text" id="bo_address1" name="address1" placeholder="Street address">
                </div>
                
                <div class="form-group">
                    <label for="bo_address2">Address Line 2 <span class="optional">(Optional)</span></label>
                    <input type="text" id="bo_address2" name="address2" placeholder="Apartment, suite, etc.">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="bo_city">City <span class="optional">(Optional)</span></label>
                        <input type="text" id="bo_city" name="city" placeholder="Mumbai">
                    </div>
                    <div class="form-group">
                        <label for="bo_state">State <span class="optional">(Optional)</span></label>
                        <input type="text" id="bo_state" name="state" placeholder="Maharashtra">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="bo_country">Country <span class="optional">(Optional)</span></label>
                        <input type="text" id="bo_country" name="country" placeholder="India">
                    </div>
                    <div class="form-group">
                        <label for="bo_zipcode">ZIP Code <span class="optional">(Optional)</span></label>
                        <input type="text" id="bo_zipcode" name="zipcode" placeholder="400001">
                    </div>
                </div>
            </div>
            
            <!-- UDF Parameters -->
            <div class="section">
                <h2 class="section-title">UDF Parameters (Optional)</h2>
                
                <div class="alert alert-info">
                    <strong>UDF Information:</strong> User Defined Fields for custom data - all optional.
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="bo_udf1">UDF1 <span class="optional">(Optional)</span></label>
                        <input type="text" id="bo_udf1" name="udf1" placeholder="User defined field 1">
                    </div>
                    <div class="form-group">
                        <label for="bo_udf2">UDF2 <span class="optional">(Optional)</span></label>
                        <input type="text" id="bo_udf2" name="udf2" placeholder="User defined field 2">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="bo_udf3">UDF3 <span class="optional">(Optional)</span></label>
                        <input type="text" id="bo_udf3" name="udf3" placeholder="User defined field 3">
                    </div>
                    <div class="form-group">
                        <label for="bo_udf4">UDF4 <span class="optional">(Optional)</span></label>
                        <input type="text" id="bo_udf4" name="udf4" placeholder="User defined field 4">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="bo_udf5">UDF5 <span class="optional">(Optional)</span></label>
                    <input type="text" id="bo_udf5" name="udf5" placeholder="User defined field 5">
                </div>
            </div>
            
            <!-- Payment Methods -->
            <div class="section">
                <h2 class="section-title">Payment Methods <span class="optional">(Optional)</span></h2>
                
                <div class="alert alert-info">
                    <strong>Enforce Payment Methods:</strong> Select specific payment methods to show on the payment page. Leave all unchecked to show all available payment methods.
                </div>
                
                <div class="payment-methods">
                    <label class="payment-method">
                        <input type="checkbox" id="bo_cc" name="bo_paymethod" value="CC">
                        <span>Credit Card</span>
                    </label>
                    <label class="payment-method">
                        <input type="checkbox" id="bo_dc" name="bo_paymethod" value="DC">
                        <span>Debit Card</span>
                    </label>
                    <label class="payment-method">
                        <input type="checkbox" id="bo_nb" name="bo_paymethod" value="NB">
                        <span>Net Banking</span>
                    </label>
                    <label class="payment-method">
                        <input type="checkbox" id="bo_upi" name="bo_paymethod" value="UPI">
                        <span>UPI</span>
                    </label>
                    <label class="payment-method">
                        <input type="checkbox" id="bo_emi" name="bo_paymethod" value="EMI">
                        <span>EMI</span>
                    </label>
                </div>
            </div>
            
            <!-- Redirect URLs -->
            <div class="section">
                <h2 class="section-title">Redirect URLs</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="bo_surl">Success URL <span class="required">*</span></label>
                        <input type="url" id="bo_surl" name="surl" value="https://test.payu.in/admin/test_response" required>
                    </div>
                    <div class="form-group">
                        <label for="bo_furl">Failure URL <span class="required">*</span></label>
                        <input type="url" id="bo_furl" name="furl" value="https://test.payu.in/admin/test_response" required>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="pay-button-wrapper">
                <button type="button" class="button debug-button" onclick="showDebugInfo('bankoffer')">Show Debug Info</button>
                <button type="button" class="button debug-button" onclick="showCurlCommand('bankoffer')">Generate CURL</button>
                <button type="button" class="button" onclick="submitPayment('bankoffer')">Pay Now</button>
            </div>
        </div>
        
        <!-- Debug Section -->
        <div class="debug-section" id="bo-debugSection">
            <h3 class="debug-title">Debug Information</h3>
            <div id="bo-debugContent"></div>
        </div>
        
        <!-- CURL Section -->
        <div class="curl-section" id="bo-curlSection">
            <h3 class="curl-title">CURL Command</h3>
            <div class="curl-content" id="bo-curlContent"></div>
            <button class="copy-button" onclick="copyCurlToClipboard('bankoffer')">Copy to Clipboard</button>
        </div>
    </div>
    
    <!-- Bank Offers Hidden Form -->
    <form id="bo_payu_form" method="post" action="https://test.payu.in/_payment" style="display: none;">
        <input type="hidden" id="bo_key" name="key">
        <input type="hidden" id="bo_txnid_hidden" name="txnid">
        <input type="hidden" id="bo_amount_hidden" name="amount">
        <input type="hidden" id="bo_productinfo_hidden" name="productinfo">
        <input type="hidden" id="bo_firstname_hidden" name="firstname">
        <input type="hidden" id="bo_lastname_hidden" name="lastname">
        <input type="hidden" id="bo_email_hidden" name="email">
        <input type="hidden" id="bo_phone_hidden" name="phone">
        <input type="hidden" id="bo_address1_hidden" name="address1">
        <input type="hidden" id="bo_address2_hidden" name="address2">
        <input type="hidden" id="bo_city_hidden" name="city">
        <input type="hidden" id="bo_state_hidden" name="state">
        <input type="hidden" id="bo_country_hidden" name="country">
        <input type="hidden" id="bo_zipcode_hidden" name="zipcode">
        <input type="hidden" id="bo_udf1_hidden" name="udf1">
        <input type="hidden" id="bo_udf2_hidden" name="udf2">
        <input type="hidden" id="bo_udf3_hidden" name="udf3">
        <input type="hidden" id="bo_udf4_hidden" name="udf4">
        <input type="hidden" id="bo_udf5_hidden" name="udf5">
        <input type="hidden" id="bo_surl_hidden" name="surl">
        <input type="hidden" id="bo_furl_hidden" name="furl">
        <input type="hidden" id="bo_hash" name="hash">
        <input type="hidden" id="bo_enforce_paymethod" name="enforce_paymethod">
        <input type="hidden" id="bo_cart_details_hidden" name="cart_details">
        <input type="hidden" id="bo_api_version_hidden" name="api_version">
        <input type="hidden" id="bo_offer_key_hidden" name="offer_key">
    </form>
    
    <!-- UPI OTM Hidden Form -->
    <form id="upi_payu_form" method="post" action="https://test.payu.in/_payment" style="display: none;">
        <input type="hidden" id="upi_key" name="key">
        <input type="hidden" id="upi_txnid" name="txnid">
        <input type="hidden" id="upi_amount_hidden" name="amount">
        <input type="hidden" id="upi_productinfo_hidden" name="productinfo">
        <input type="hidden" id="upi_firstname_hidden" name="firstname">
        <input type="hidden" id="upi_lastname_hidden" name="lastname">
        <input type="hidden" id="upi_email_hidden" name="email">
        <input type="hidden" id="upi_phone_hidden" name="phone">
        <input type="hidden" id="upi_address1_hidden" name="address1">
        <input type="hidden" id="upi_address2_hidden" name="address2">
        <input type="hidden" id="upi_city_hidden" name="city">
        <input type="hidden" id="upi_state_hidden" name="state">
        <input type="hidden" id="upi_country_hidden" name="country">
        <input type="hidden" id="upi_zipcode_hidden" name="zipcode">
        <input type="hidden" id="upi_udf1_hidden" name="udf1">
        <input type="hidden" id="upi_udf2_hidden" name="udf2">
        <input type="hidden" id="upi_udf3_hidden" name="udf3">
        <input type="hidden" id="upi_udf4_hidden" name="udf4">
        <input type="hidden" id="upi_udf5_hidden" name="udf5">
        <input type="hidden" id="upi_surl_hidden" name="surl">
        <input type="hidden" id="upi_furl_hidden" name="furl">
        <input type="hidden" id="upi_hash" name="hash">
        <input type="hidden" id="upi_api_version" name="api_version" value="7">
        <input type="hidden" id="upi_si_details" name="si_details">
        <input type="hidden" id="upi_pre_authorize" name="pre_authorize" value="1">
    </form>
    
    <!-- TPV Hidden Form -->
    <form id="tpv_payu_form" method="post" action="https://test.payu.in/_payment" style="display: none;">
        <input type="hidden" id="tpv_key" name="key">
        <input type="hidden" id="tpv_txnid" name="txnid">
        <input type="hidden" id="tpv_amount_hidden" name="amount">
        <input type="hidden" id="tpv_productinfo_hidden" name="productinfo">
        <input type="hidden" id="tpv_firstname_hidden" name="firstname">
        <input type="hidden" id="tpv_email_hidden" name="email">
        <input type="hidden" id="tpv_phone_hidden" name="phone">
        <input type="hidden" id="tpv_udf1_hidden" name="udf1">
        <input type="hidden" id="tpv_udf2_hidden" name="udf2">
        <input type="hidden" id="tpv_udf3_hidden" name="udf3">
        <input type="hidden" id="tpv_udf4_hidden" name="udf4">
        <input type="hidden" id="tpv_udf5_hidden" name="udf5">
        <input type="hidden" id="tpv_beneficiarydetail" name="beneficiarydetail">
        <input type="hidden" id="tpv_si_details" name="si_details">
        <input type="hidden" id="tpv_si" name="si">
        <input type="hidden" id="tpv_surl_hidden" name="surl">
        <input type="hidden" id="tpv_furl_hidden" name="furl">
        <input type="hidden" id="tpv_hash" name="hash">
        <input type="hidden" id="tpv_enforce_paymethod" name="enforce_paymethod">
        <input type="hidden" id="tpv_api_version" name="api_version" value="6">
    </form>
    
    <script>
        // Global Variables
        let currentFlow = '';
        let currentPaymentType = 'onetime';
        const DEFAULT_KEY = 'a4vGC2';
        const DEFAULT_SALT = 'hKvGJP28d2ZUuCRz5BnDag58QBdCxBli';
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize transaction IDs for all flows
            generateTransactionId('crossborder');
            generateTransactionId('nonseamless');
            generateTransactionId('subscription');
            generateTransactionId('tpv');
            generateTransactionId('upiotm');
            generateTransactionId('preauth');
            generateTransactionId('checkoutplus');
            generateTransactionId('split');
            generateTransactionId('bankoffer');
            
            // Set default values for subscription flows (both Cross Border and Non-Seamless)
            const today = new Date().toISOString().split('T')[0];
            
            console.log('=== Initializing Subscription Fields on Page Load ===');
            console.log('Current date:', today);
            
            // Cross Border subscription defaults
            const cbPaymentStartDate = document.getElementById('cb_payment_start_date');
            const cbBillingInterval = document.getElementById('cb_billing_interval');
            
            if (cbPaymentStartDate) {
                cbPaymentStartDate.value = today;
                cbPaymentStartDate.min = today; // Prevent past date selection
                console.log(' Cross Border payment_start_date set to:', cbPaymentStartDate.value);
            } else {
                console.error(' Cross Border payment_start_date field NOT FOUND');
            }
            
            if (cbBillingInterval) {
                cbBillingInterval.value = '1';
                console.log(' Cross Border billing_interval set to:', cbBillingInterval.value);
            } else {
                console.error(' Cross Border billing_interval field NOT FOUND');
            }
            
            // Non-Seamless subscription defaults
            const subPaymentStartDate = document.getElementById('sub_payment_start_date');
            const subBillingInterval = document.getElementById('sub_billing_interval');
            
            if (subPaymentStartDate) {
                subPaymentStartDate.value = today;
                subPaymentStartDate.min = today; // Prevent past date selection
                console.log(' Non-Seamless payment_start_date set to:', subPaymentStartDate.value);
            } else {
                console.error(' Non-Seamless payment_start_date field NOT FOUND');
            }
            
            if (subBillingInterval) {
                subBillingInterval.value = '1';
                console.log(' Non-Seamless billing_interval set to:', subBillingInterval.value);
            } else {
                console.error(' Non-Seamless billing_interval field NOT FOUND');
            }
            
            // UPI OTM defaults (start date = today, end date = today + 7 days)
            const upiPaymentStartDate = document.getElementById('upi_payment_start_date');
            const upiPaymentEndDate = document.getElementById('upi_payment_end_date');
            
            if (upiPaymentStartDate) {
                upiPaymentStartDate.value = today;
                console.log(' UPI OTM payment_start_date set to:', upiPaymentStartDate.value);
            } else {
                console.error(' UPI OTM payment_start_date field NOT FOUND');
            }
            
            if (upiPaymentEndDate) {
                const endDate = new Date();
                endDate.setDate(endDate.getDate() + 7); // Default to 7 days from today
                upiPaymentEndDate.value = endDate.toISOString().split('T')[0];
                console.log(' UPI OTM payment_end_date set to:', upiPaymentEndDate.value);
            } else {
                console.error(' UPI OTM payment_end_date field NOT FOUND');
            }
            
            console.log('=== Subscription Fields Initialization Complete ===');
            
            // Add validation listeners
            addValidationListeners();
            
            // Restore flow from localStorage if page was refreshed
            const savedFlow = localStorage.getItem('currentPaymentFlow');
            const savedPaymentType = localStorage.getItem('currentPaymentType');
            
            if (savedFlow && savedFlow !== '') {
                console.log('=== Restoring Flow from localStorage ===');
                console.log('Saved Flow:', savedFlow);
                console.log('Saved Payment Type:', savedPaymentType);
                
                // Set the dropdown value
                document.getElementById('flowSelect').value = savedFlow;
                
                // Hide landing and show the saved flow
                document.getElementById('landingSection').style.display = 'none';
                document.getElementById(savedFlow + 'Flow').classList.add('active');
                currentFlow = savedFlow;
                
                // For cross border, restore payment type
                if (savedFlow === 'crossborder' && savedPaymentType) {
                    currentPaymentType = savedPaymentType;
                    // Update UI to show correct payment type
                    if (savedPaymentType === 'subscription') {
                        document.getElementById('cb-onetime-section').classList.remove('active');
                        document.getElementById('cb-subscription-section').classList.add('active');
                        document.getElementById('cb-onetime-udf-section').classList.remove('active');
                        document.getElementById('cb-subscription-udf-section').classList.add('active');
                    }
                }
                
                console.log(' Flow restored successfully');
            } else {
                console.log('No saved flow found - showing landing page');
            }
        });
        
        // UPI OTM Date Validation Function
        function validateUpiOtmDates() {
            const startDate = document.getElementById('upi_payment_start_date');
            const endDate = document.getElementById('upi_payment_end_date');
            
            if (!startDate || !endDate || !startDate.value || !endDate.value) {
                return true; // Let required validation handle empty fields
            }
            
            const start = new Date(startDate.value);
            const end = new Date(endDate.value);
            
            // Check if end date is more than 14 days from start date
            const diffTime = Math.abs(end - start);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays > 14) {
                alert('Error: Payment End Date cannot be more than 14 days from the Start Date.\n\nCurrent difference: ' + diffDays + ' days\nMaximum allowed: 14 days');
                // Reset end date to start date + 7 days
                const newEndDate = new Date(start);
                newEndDate.setDate(start.getDate() + 7);
                endDate.value = newEndDate.toISOString().split('T')[0];
                return false;
            }
            
            // Check if end date is before start date
            if (end < start) {
                alert('Error: Payment End Date cannot be before the Start Date.');
                endDate.value = startDate.value;
                return false;
            }
            
            return true;
        }
        
        // Add Validation Listeners
        function addValidationListeners() {
            // Cross border validation
            if (document.getElementById('cb_phone')) {
                document.getElementById('cb_phone').addEventListener('input', function() {
                    validatePhone('crossborder');
                });
                document.getElementById('cb_email').addEventListener('blur', function() {
                    validateEmail('crossborder');
                });
            }
            
            // Non-seamless validation
            if (document.getElementById('ns_phone')) {
                document.getElementById('ns_phone').addEventListener('input', function() {
                    validatePhone('nonseamless');
                });
                document.getElementById('ns_email').addEventListener('blur', function() {
                    validateEmail('nonseamless');
                });
            }
            
            // Subscription validation
            if (document.getElementById('sub_phone')) {
                document.getElementById('sub_phone').addEventListener('input', function() {
                    validatePhone('subscription');
                });
                document.getElementById('sub_email').addEventListener('blur', function() {
                    validateEmail('subscription');
                });
            }
            
            // UPI OTM validation
            if (document.getElementById('upi_phone')) {
                document.getElementById('upi_phone').addEventListener('input', function() {
                    validatePhone('upiotm');
                });
                document.getElementById('upi_email').addEventListener('blur', function() {
                    validateEmail('upiotm');
                });
            }
            
            // PreAuth validation
            if (document.getElementById('preauth_phone')) {
                document.getElementById('preauth_phone').addEventListener('input', function() {
                    validatePhone('preauth');
                });
                document.getElementById('preauth_email').addEventListener('blur', function() {
                    validateEmail('preauth');
                });
            }
            
            // Checkout Plus validation
            if (document.getElementById('cp_phone')) {
                document.getElementById('cp_phone').addEventListener('input', function() {
                    validatePhone('checkoutplus');
                });
                document.getElementById('cp_email').addEventListener('blur', function() {
                    validateEmail('checkoutplus');
                });
            }
            
            // Split Payment validation
            if (document.getElementById('split_phone')) {
                document.getElementById('split_phone').addEventListener('input', function() {
                    validatePhone('split');
                });
                document.getElementById('split_email').addEventListener('blur', function() {
                    validateEmail('split');
                });
            }
            
            // Bank Offers validation
            if (document.getElementById('bo_phone')) {
                document.getElementById('bo_phone').addEventListener('input', function() {
                    validatePhone('bankoffer');
                });
                document.getElementById('bo_email').addEventListener('blur', function() {
                    validateEmail('bankoffer');
                });
            }
            
            // TPV validation
            if (document.getElementById('tpv_phone')) {
                document.getElementById('tpv_phone').addEventListener('input', function() {
                    validatePhone('tpv');
                });
                document.getElementById('tpv_email').addEventListener('blur', function() {
                    validateEmail('tpv');
                });
            }
        }
        
        // ============================================
        // SPLIT PAYMENT SPECIFIC FUNCTIONS
        // ============================================
        
        let splitRowCounter = 0;
        
        // ============================================
        // BANK OFFERS SPECIFIC FUNCTIONS
        // ============================================
        
        let boSkuRowCounter = 0;
        
        // Add a new split row
        function addSplitRow() {
            splitRowCounter++;
            const container = document.getElementById('splitRowsContainer');
            
            if (!container) {
                console.error(' Split rows container not found!');
                return;
            }
            
            const splitType = document.querySelector('input[name="split_type"]:checked').value;
            
            // Check if using custom keys - if not, prefill child merchant key with test key based on position
            const useCustomKeysCheckbox = document.getElementById('split_use_custom_keys');
            const useCustomKeys = useCustomKeysCheckbox ? useCustomKeysCheckbox.checked : false;
            
            // Get existing rows count to determine which predefined key to use
            const existingRows = document.querySelectorAll('.split-row').length;
            let defaultMerchantKey = '';
            
            if (!useCustomKeys) {
                // For predefined credentials: first child = 'gYoEaY', second child = '5rgA73', third+ = blank
                if (existingRows === 0) {
                    defaultMerchantKey = 'gYoEaY';
                } else if (existingRows === 1) {
                    defaultMerchantKey = '5rgA73';
                } else {
                    defaultMerchantKey = '';
                }
            }
            
            const placeholderText = splitType === 'absolute' ? '500.00' : '50';
            const amountLabel = splitType === 'absolute' ? 'Amount (INR)' : 'Percentage';
            
            // ALWAYS generate child transaction ID (even for custom keys scenario)
            const timestamp = Date.now();
            const randomSuffix = Math.floor(Math.random() * 10000);
            const childTxnId = 'child_' + timestamp + '_' + randomSuffix;
            
            const rowId = splitRowCounter;
            
            console.log('=== Adding Split Row #' + rowId + ' ===');
            console.log('  Custom Keys Checkbox Checked: ' + useCustomKeys);
            console.log('  Existing Rows Count: ' + existingRows);
            console.log('  Default Merchant Key: "' + defaultMerchantKey + '" (Position-based for predefined creds)');
            console.log('  Child Transaction ID: ' + childTxnId);
            
            // Create row container
            const row = document.createElement('div');
            row.className = 'split-row';
            row.id = 'split_row_' + rowId;
            
            // Create form groups
            const formGroupMerchantKey = document.createElement('div');
            formGroupMerchantKey.className = 'form-group';
            formGroupMerchantKey.innerHTML = `
                <label>Child Merchant Key <span class="required">*</span></label>
                <input type="text" class="split-merchant-key" placeholder="e.g., gYoEaY" required>
                <small style="color: var(--text-tertiary);">Must be pre-configured with PayU</small>
            `;
            // Set value programmatically for reliability
            const merchantKeyInput = formGroupMerchantKey.querySelector('.split-merchant-key');
            if (merchantKeyInput) {
                merchantKeyInput.value = defaultMerchantKey;
                console.log('  Set Merchant Key Input Value: "' + merchantKeyInput.value + '"');
            }
            
            const formGroupTxnId = document.createElement('div');
            formGroupTxnId.className = 'form-group';
            formGroupTxnId.innerHTML = `
                <label>Child Transaction ID <span class="required">*</span></label>
                <input type="text" class="split-txn-id" placeholder="Auto-generated" required readonly>
                <small style="color: var(--text-tertiary);">Auto-generated unique ID</small>
            `;
            // Set value programmatically for reliability
            const txnIdInput = formGroupTxnId.querySelector('.split-txn-id');
            if (txnIdInput) {
                txnIdInput.value = childTxnId;
                console.log('  Set Transaction ID Input Value: "' + txnIdInput.value + '"');
            }
            
            const formGroupAmount = document.createElement('div');
            formGroupAmount.className = 'form-group';
            formGroupAmount.innerHTML = `
                <label>${amountLabel} <span class="required">*</span></label>
                <input type="number" class="split-amount" placeholder="${placeholderText}" step="0.01" min="0" required>
            `;
            
            const formGroupCharges = document.createElement('div');
            formGroupCharges.className = 'form-group';
            formGroupCharges.innerHTML = `
                <label>Charges <span class="optional">(Optional)</span></label>
                <input type="number" class="split-charges" placeholder="0.00" value="0.00" step="0.01" min="0">
            `;
            
            // Create remove button
            const removeBtn = document.createElement('button');
            removeBtn.type = 'button';
            removeBtn.className = 'remove-split-btn';
            removeBtn.title = 'Remove this child';
            removeBtn.innerHTML = '&times;';
            removeBtn.onclick = function() {
                removeSplitRow(rowId);
            };
            
            // Append all elements to row
            row.appendChild(formGroupMerchantKey);
            row.appendChild(formGroupTxnId);
            row.appendChild(formGroupAmount);
            row.appendChild(formGroupCharges);
            row.appendChild(removeBtn);
            
            // Append row to container
            container.appendChild(row);
            
            // Verify the inputs have the correct values after appending
            setTimeout(function() {
                const merchantKeyInput = row.querySelector('.split-merchant-key');
                const txnIdInput = row.querySelector('.split-txn-id');
                const actualMerchantKey = merchantKeyInput ? merchantKeyInput.value : 'NOT FOUND';
                const actualTxnId = txnIdInput ? txnIdInput.value : 'NOT FOUND';
                
                console.log(' Split row #' + rowId + ' added and verified');
                console.log('  Expected Merchant Key: "' + defaultMerchantKey + '" | Actual: "' + actualMerchantKey + '"');
                console.log('  Expected Transaction ID: "' + childTxnId + '" | Actual: "' + actualTxnId + '"');
                
                if (actualMerchantKey !== defaultMerchantKey) {
                    console.error(' Merchant Key mismatch!');
                }
                if (actualTxnId !== childTxnId) {
                    console.error(' Transaction ID mismatch!');
                }
            }, 10);
        }
        
        // Remove a split row
        function removeSplitRow(rowId) {
            const row = document.getElementById('split_row_' + rowId);
            if (row) {
                row.remove();
                console.log(' Removed split row #' + rowId);
            } else {
                console.error(' Could not find row with ID: split_row_' + rowId);
            }
        }
        
        // Regenerate all child transaction IDs
        function regenerateSplitChildTransactionIds() {
            const splitRows = document.querySelectorAll('.split-row');
            let regeneratedCount = 0;
            
            splitRows.forEach((row, index) => {
                const txnIdInput = row.querySelector('.split-txn-id');
                if (txnIdInput) {
                    const timestamp = Date.now();
                    const randomSuffix = Math.floor(Math.random() * 10000);
                    const newChildTxnId = 'child_' + timestamp + '_' + randomSuffix;
                    txnIdInput.value = newChildTxnId;
                    regeneratedCount++;
                    console.log('  Child ' + (index + 1) + ' new txnId: ' + newChildTxnId);
                }
            });
            
            console.log(' Regenerated ' + regeneratedCount + ' child transaction IDs');
        }
        
        // Update split placeholders when type changes
        function updateSplitPlaceholders() {
            const splitType = document.querySelector('input[name="split_type"]:checked').value;
            const amountInputs = document.querySelectorAll('.split-amount');
            const placeholderText = splitType === 'absolute' ? '500.00' : '50';
            const amountLabel = splitType === 'absolute' ? 'Amount (INR)' : 'Percentage';
            
            amountInputs.forEach(input => {
                input.placeholder = placeholderText;
                const label = input.closest('.form-group').querySelector('label');
                if (label) {
                    label.innerHTML = amountLabel + ' <span class="required">*</span>';
                }
            });
            
            console.log(' Updated split placeholders for type:', splitType);
        }
        
        // Build splitRequest JSON from form inputs
        function buildSplitRequestJson() {
            const splitType = document.querySelector('input[name="split_type"]:checked').value;
            const splitRows = document.querySelectorAll('.split-row');
            
            console.log('=== Building splitRequest JSON ===');
            console.log('Split Type: ' + splitType);
            console.log('Total child rows: ' + splitRows.length);
            
            if (splitRows.length === 0) {
                alert('Please add at least one split merchant configuration');
                return null;
            }
            
            const splitInfo = {};
            let validRowCount = 0;
            const merchantKeys = [];
            
            splitRows.forEach((row, index) => {
                const merchantKey = row.querySelector('.split-merchant-key').value.trim();
                const txnId = row.querySelector('.split-txn-id').value.trim();
                const amount = row.querySelector('.split-amount').value.trim();
                const charges = row.querySelector('.split-charges').value.trim() || '0.00';
                
                console.log('Row ' + (index + 1) + ':', {
                    merchantKey: merchantKey,
                    txnId: txnId,
                    amount: amount,
                    charges: charges
                });
                
                if (!merchantKey || !txnId || !amount) {
                    console.warn(' Skipping row ' + (index + 1) + ' - missing required fields');
                    return;
                }
                
                // Check for duplicate merchant keys
                if (splitInfo[merchantKey]) {
                    console.warn(' Duplicate merchant key "' + merchantKey + '" found. Each child should have a unique merchant key.');
                }
                
                // Add child merchant details
                splitInfo[merchantKey] = {
                    "aggregatorSubTxnId": txnId,
                    "aggregatorSubAmt": amount,
                    "aggregatorCharges": charges
                };
                
                merchantKeys.push(merchantKey);
                validRowCount++;
            });
            
            console.log('Valid rows processed: ' + validRowCount);
            console.log('Merchant keys: ' + merchantKeys.join(', '));
            
            if (Object.keys(splitInfo).length === 0) {
                alert('Please fill in all required fields for split merchants');
                return null;
            }
            
            const splitRequest = {
                "type": splitType,
                "splitInfo": splitInfo
            };
            
            const splitRequestJson = JSON.stringify(splitRequest);
            console.log(' Built splitRequest JSON:');
            console.log(JSON.stringify(splitRequest, null, 2));
            
            return splitRequestJson;
        }
        
        // Validate split amounts
        function validateSplitAmounts() {
            const splitType = document.querySelector('input[name="split_type"]:checked').value;
            const totalAmount = parseFloat(document.getElementById('split_amount').value) || 0;
            const splitRows = document.querySelectorAll('.split-row');
            
            if (splitRows.length === 0) {
                alert('Please add at least one split merchant configuration');
                return false;
            }
            
            let splitTotal = 0;
            const amounts = [];
            
            splitRows.forEach(row => {
                const amount = parseFloat(row.querySelector('.split-amount').value) || 0;
                amounts.push(amount);
                splitTotal += amount;
            });
            
            if (splitType === 'percentage') {
                if (splitTotal > 100) {
                    alert('Split percentages cannot exceed 100%. Current total: ' + splitTotal + '%');
                    return false;
                }
            } else {
                // For absolute amounts, sum can be less than or equal to total
                // Remaining amount goes to parent merchant
            }
            
            return true;
        }
        
        // ============================================
        // BANK OFFERS - SKU MANAGEMENT FUNCTIONS
        // ============================================
        
        // Toggle SKU offers section
        function toggleSkuOffers(flow) {
            if (flow !== 'bankoffer') return;
            
            const skuCheckbox = document.getElementById('bo_enable_sku');
            const skuConfig = document.getElementById('bo-sku-config');
            const isEnabled = skuCheckbox.checked;
            
            if (isEnabled) {
                skuConfig.style.display = 'block';
                
                // Clear existing SKU rows
                document.getElementById('boSkuRowsContainer').innerHTML = '';
                boSkuRowCounter = 0;
                
                // Check if using custom credentials
                const useCustomKeys = document.getElementById('bo_use_custom_keys').checked;
                
                if (!useCustomKeys) {
                    // Predefined credentials - add 2 SKUs with prefilled IDs/names
                    addBankOfferSkuRow('testProduct11', 'SkuTest11');
                    addBankOfferSkuRow('testProduct12', 'SkuTest12');
                    console.log(' SKU offers enabled with 2 predefined SKUs');
                } else {
                    // Custom credentials - start with empty form
                    console.log(' SKU offers enabled for custom credentials (no prefilled SKUs)');
                }
                
                updateSkuLimitMessage();
            } else {
                skuConfig.style.display = 'none';
                // Clear SKU rows
                document.getElementById('boSkuRowsContainer').innerHTML = '';
                boSkuRowCounter = 0;
                // Clear JSON preview
                document.getElementById('bo-json-preview').textContent = '';
                document.getElementById('bo-total-items').textContent = '0';
                document.getElementById('bo-calculated-amount').textContent = '0.00';
                console.log(' SKU offers disabled for bank offers');
            }
        }
        
        // Update SKU limit message
        function updateSkuLimitMessage() {
            const currentCount = document.querySelectorAll('#boSkuRowsContainer > div').length;
            const limitMsg = document.getElementById('bo-sku-limit-msg');
            const addButton = document.querySelector('button[onclick="addBankOfferSkuRow()"]');
            
            if (currentCount >= 5) {
                limitMsg.textContent = 'Maximum 5 SKUs reached';
                limitMsg.style.color = 'var(--warning-color)';
                if (addButton) addButton.disabled = true;
            } else {
                limitMsg.textContent = `${currentCount} of 5 SKUs added`;
                limitMsg.style.color = 'var(--text-tertiary)';
                if (addButton) addButton.disabled = false;
            }
        }
        
        // Add SKU row to custom builder
        function addBankOfferSkuRow(prefilledSkuId, prefilledSkuName) {
            const container = document.getElementById('boSkuRowsContainer');
            
            if (!container) {
                console.error(' SKU rows container not found!');
                return;
            }
            
            // Check max limit
            const currentCount = document.querySelectorAll('#boSkuRowsContainer > div').length;
            if (currentCount >= 5) {
                alert('Maximum 5 SKUs allowed. Please remove an existing SKU to add a new one.');
                console.warn(' Maximum SKU limit (5) reached');
                return;
            }
            
            // If no prefilled values provided, check if we should auto-prefill based on predefined keys
            if (!prefilledSkuId && !prefilledSkuName) {
                const useCustomKeys = document.getElementById('bo_use_custom_keys').checked;
                
                if (!useCustomKeys) {
                    // Using predefined keys - auto-prefill based on position
                    if (currentCount === 0) {
                        // First SKU
                        prefilledSkuId = 'testProduct11';
                        prefilledSkuName = 'SkuTest11';
                    } else if (currentCount === 1) {
                        // Second SKU
                        prefilledSkuId = 'testProduct12';
                        prefilledSkuName = 'SkuTest12';
                    }
                    // For 3rd, 4th, 5th SKUs: leave blank (prefilledSkuId and prefilledSkuName remain undefined)
                }
            }
            
            boSkuRowCounter++;
            const rowId = boSkuRowCounter;
            
            console.log('=== Adding SKU Row #' + rowId + ' ===');
            console.log('  Current SKU count before adding: ' + currentCount);
            if (prefilledSkuId) console.log('  Prefilled SKU ID: ' + prefilledSkuId);
            if (prefilledSkuName) console.log('  Prefilled SKU Name: ' + prefilledSkuName);
            
            // Create row container with full-width styling
            const row = document.createElement('div');
            row.id = 'bo_sku_row_' + rowId;
            row.style.cssText = `
                margin-bottom: 1.75rem;
                margin-left: -2rem;
                margin-right: -2rem;
                padding: 2.5rem 2rem;
                background: linear-gradient(to bottom, #ffffff, #fafbfc);
                border-radius: 0;
                position: relative;
                border-top: 2px solid #e2e8f0;
                border-bottom: 2px solid #e2e8f0;
                box-shadow: 0 2px 8px rgba(0,0,0,0.06);
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            `;
            
            // Add hover effect for better UX - full width highlight
            row.onmouseenter = function() {
                this.style.borderTopColor = 'var(--accent-primary)';
                this.style.borderBottomColor = 'var(--accent-primary)';
                this.style.boxShadow = '0 4px 16px rgba(102, 126, 234, 0.12)';
                this.style.background = 'linear-gradient(to bottom, #f8faff, #f0f4ff)';
            };
            row.onmouseleave = function() {
                this.style.borderTopColor = '#e2e8f0';
                this.style.borderBottomColor = '#e2e8f0';
                this.style.boxShadow = '0 2px 8px rgba(0,0,0,0.06)';
                this.style.background = 'linear-gradient(to bottom, #ffffff, #fafbfc)';
            };
            
            // Create header with row number - improved styling
            const header = document.createElement('div');
            header.style.cssText = `
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 1.75rem;
                padding-bottom: 1.25rem;
                border-bottom: 2px solid #e2e8f0;
            `;
            header.innerHTML = `
                <h4 style="margin: 0; color: var(--accent-primary); font-size: 1.25rem; font-weight: 700; display: flex; align-items: center; gap: 0.5rem;">
                    <span style="display: inline-block; width: 32px; height: 32px; border-radius: 50%; background: var(--accent-primary); color: white; text-align: center; line-height: 32px; font-size: 0.9rem;">${rowId}</span>
                    SKU Item #${rowId}
                </h4>
            `;
            
            // Create remove button - improved styling
            const removeBtn = document.createElement('button');
            removeBtn.type = 'button';
            removeBtn.className = 'remove-split-btn';
            removeBtn.title = 'Remove this SKU';
            removeBtn.innerHTML = '&times;';
            removeBtn.style.cssText = `
                position: relative;
                top: 0;
                right: 0;
                background: var(--error-color);
                color: white;
                border: none;
                border-radius: 50%;
                width: 36px;
                height: 36px;
                cursor: pointer;
                font-size: 24px;
                font-weight: 700;
                line-height: 1;
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                box-shadow: 0 2px 8px rgba(245, 101, 101, 0.3);
            `;
            removeBtn.onmouseover = function() {
                this.style.background = '#c62828';
                this.style.transform = 'scale(1.15) rotate(90deg)';
                this.style.boxShadow = '0 4px 16px rgba(198, 40, 40, 0.4)';
            };
            removeBtn.onmouseout = function() {
                this.style.background = 'var(--error-color)';
                this.style.transform = 'scale(1) rotate(0deg)';
                this.style.boxShadow = '0 2px 8px rgba(245, 101, 101, 0.3)';
            };
            removeBtn.onclick = function() {
                removeBankOfferSkuRow(rowId);
            };
            
            header.appendChild(removeBtn);
            row.appendChild(header);
            
            // Create SKU fields using full page width with form-row layout
            // Set proper default values
            const skuIdValue = prefilledSkuId ? prefilledSkuId : '';
            const skuNameValue = prefilledSkuName ? prefilledSkuName : '';
            const skuIdBg = prefilledSkuId ? '#f0f9ff' : '#ffffff';
            const skuNameBg = prefilledSkuName ? '#f0f9ff' : '#ffffff';
            
            // Create container for all fields
            const fieldsContainer = document.createElement('div');
            fieldsContainer.style.cssText = 'padding: 0 1.5rem 1rem 1.5rem;';
            
            // First row: SKU ID and SKU Name
            const firstRow = document.createElement('div');
            firstRow.className = 'form-row';
            
            // SKU ID field
            const formGroupSkuId = document.createElement('div');
            formGroupSkuId.className = 'form-group';
            
            const labelSkuId = document.createElement('label');
            labelSkuId.innerHTML = 'SKU ID <span class="required">*</span>';
            
            const inputSkuId = document.createElement('input');
            inputSkuId.type = 'text';
            inputSkuId.className = 'bo-sku-id';
            inputSkuId.placeholder = 'e.g., testProduct11';
            inputSkuId.required = true;
            inputSkuId.value = skuIdValue; // Set value property directly
            inputSkuId.style.background = skuIdBg;
            
            formGroupSkuId.appendChild(labelSkuId);
            formGroupSkuId.appendChild(inputSkuId);
            
            // SKU Name field
            const formGroupSkuName = document.createElement('div');
            formGroupSkuName.className = 'form-group';
            
            const labelSkuName = document.createElement('label');
            labelSkuName.innerHTML = 'SKU Name <span class="required">*</span>';
            
            const inputSkuName = document.createElement('input');
            inputSkuName.type = 'text';
            inputSkuName.className = 'bo-sku-name';
            inputSkuName.placeholder = 'e.g., SkuTest11';
            inputSkuName.required = true;
            inputSkuName.value = skuNameValue; // Set value property directly
            inputSkuName.style.background = skuNameBg;
            
            formGroupSkuName.appendChild(labelSkuName);
            formGroupSkuName.appendChild(inputSkuName);
            
            firstRow.appendChild(formGroupSkuId);
            firstRow.appendChild(formGroupSkuName);
            
            // Second row: Amount and Quantity
            const secondRow = document.createElement('div');
            secondRow.className = 'form-row';
            
            // Amount field
            const formGroupAmount = document.createElement('div');
            formGroupAmount.className = 'form-group';
            
            const labelAmount = document.createElement('label');
            labelAmount.innerHTML = 'Amount per SKU (INR) <span class="required">*</span>';
            
            const inputAmount = document.createElement('input');
            inputAmount.type = 'number';
            inputAmount.className = 'bo-sku-amount';
            inputAmount.placeholder = '20000';
            inputAmount.step = '0.01';
            inputAmount.min = '0';
            inputAmount.required = true;
            
            formGroupAmount.appendChild(labelAmount);
            formGroupAmount.appendChild(inputAmount);
            
            // Quantity field
            const formGroupQuantity = document.createElement('div');
            formGroupQuantity.className = 'form-group';
            
            const labelQuantity = document.createElement('label');
            labelQuantity.innerHTML = 'Quantity <span class="required">*</span>';
            
            const inputQuantity = document.createElement('input');
            inputQuantity.type = 'number';
            inputQuantity.className = 'bo-sku-quantity';
            inputQuantity.placeholder = '1';
            inputQuantity.min = '1';
            inputQuantity.required = true;
            
            formGroupQuantity.appendChild(labelQuantity);
            formGroupQuantity.appendChild(inputQuantity);
            
            secondRow.appendChild(formGroupAmount);
            secondRow.appendChild(formGroupQuantity);
            
            // Third row: Offer Key (full width)
            const thirdRow = document.createElement('div');
            thirdRow.className = 'form-group';
            thirdRow.style.marginBottom = '0';
            
            const labelOfferKey = document.createElement('label');
            labelOfferKey.innerHTML = 'Offer Key <span class="optional">(Optional)</span>';
            
            const inputOfferKey = document.createElement('input');
            inputOfferKey.type = 'text';
            inputOfferKey.className = 'bo-sku-offer-key';
            inputOfferKey.placeholder = 'e.g., flat500@2022 (or comma-separated for multiple)';
            
            const smallNote = document.createElement('small');
            smallNote.style.cssText = 'color: #64748b; display: block; margin-top: 0.5rem; font-size: 0.875rem; line-height: 1.5;';
            smallNote.innerHTML = '<strong>Important:</strong> If you add an offer_key in ANY SKU, all SKUs must have the offer_key field.';
            
            thirdRow.appendChild(labelOfferKey);
            thirdRow.appendChild(inputOfferKey);
            thirdRow.appendChild(smallNote);
            
            // Append all rows to fields container
            fieldsContainer.appendChild(firstRow);
            fieldsContainer.appendChild(secondRow);
            fieldsContainer.appendChild(thirdRow);
            
            // Append fields container to main row
            row.appendChild(fieldsContainer);
            
            // Append row to container
            container.appendChild(row);
            
            // Add event listeners to update preview on change
            const inputs = row.querySelectorAll('input');
            inputs.forEach(input => {
                input.addEventListener('input', function() {
                    updateBankOfferSkuPreview();
                });
            });
            
            console.log(' SKU row #' + rowId + ' added successfully');
            
            // Verify prefilled values were set correctly
            setTimeout(function() {
                const skuIdInput = row.querySelector('.bo-sku-id');
                const skuNameInput = row.querySelector('.bo-sku-name');
                
                if (skuIdInput && skuNameInput) {
                    const actualSkuId = skuIdInput.value;
                    const actualSkuName = skuNameInput.value;
                    
                    console.log('  SKU ID in DOM: "' + actualSkuId + '" (Expected: "' + skuIdValue + '")');
                    console.log('  SKU Name in DOM: "' + actualSkuName + '" (Expected: "' + skuNameValue + '")');
                    
                    if (prefilledSkuId && actualSkuId !== prefilledSkuId) {
                        console.error(' SKU ID prefill FAILED! Expected: "' + prefilledSkuId + '", Got: "' + actualSkuId + '"');
                    } else if (prefilledSkuId) {
                        console.log(' SKU ID prefilled correctly');
                    }
                    
                    if (prefilledSkuName && actualSkuName !== prefilledSkuName) {
                        console.error(' SKU Name prefill FAILED! Expected: "' + prefilledSkuName + '", Got: "' + actualSkuName + '"');
                    } else if (prefilledSkuName) {
                        console.log(' SKU Name prefilled correctly');
                    }
                }
            }, 10);
            
            // Update preview and limit message
            updateBankOfferSkuPreview();
            updateSkuLimitMessage();
        }
        
        // Remove SKU row from custom builder
        function removeBankOfferSkuRow(rowId) {
            const row = document.getElementById('bo_sku_row_' + rowId);
            if (row) {
                row.remove();
                console.log(' Removed SKU row #' + rowId);
                updateBankOfferSkuPreview();
                updateSkuLimitMessage();
            } else {
                console.error(' Could not find row with ID: bo_sku_row_' + rowId);
            }
        }
        
        // Update SKU preview and cart summary
        function updateBankOfferSkuPreview() {
            const skuRows = document.querySelectorAll('#boSkuRowsContainer > div');
            
            if (skuRows.length === 0) {
                document.getElementById('bo-json-preview').textContent = '';
                document.getElementById('bo-total-items').textContent = '0';
                document.getElementById('bo-calculated-amount').textContent = '0';
                return;
            }
            
            const skuDetails = [];
            let totalItems = 0;
            let calculatedAmount = 0;
            
            // First pass: check if ANY SKU has an offer_key
            let hasAnyOfferKey = false;
            skuRows.forEach(row => {
                const offerKeyInput = row.querySelector('.bo-sku-offer-key').value.trim();
                if (offerKeyInput) {
                    hasAnyOfferKey = true;
                }
            });
            
            // Second pass: build SKU details with consistent offer_key handling
            skuRows.forEach(row => {
                const skuId = row.querySelector('.bo-sku-id').value.trim();
                const skuName = row.querySelector('.bo-sku-name').value.trim();
                const amountPerSku = parseFloat(row.querySelector('.bo-sku-amount').value) || 0;
                const quantity = parseInt(row.querySelector('.bo-sku-quantity').value) || 1;
                const offerKeyInput = row.querySelector('.bo-sku-offer-key').value.trim();
                
                // Parse offer_key and set offer_auto_apply based on it
                let offerKey = null;
                let offerAutoApply = true;
                
                if (offerKeyInput) {
                    // If offer_key has value, parse it as array and set auto_apply to false
                    if (offerKeyInput.includes(',')) {
                        offerKey = offerKeyInput.split(',').map(k => k.trim()).filter(k => k);
                    } else {
                        offerKey = [offerKeyInput];
                    }
                    offerAutoApply = false;
                } else if (hasAnyOfferKey) {
                    // If ANY SKU has offer_key, ALL must have it (set to null for empty ones)
                    offerKey = null;
                    offerAutoApply = true;
                } else {
                    // No SKUs have offer_key, so we can omit it entirely (handled below)
                    offerKey = null;
                    offerAutoApply = true;
                }
                
                if (skuId && skuName) {
                    const skuItem = {
                        "sku_id": skuId,
                        "sku_name": skuName,
                        "amount_per_sku": amountPerSku,
                        "quantity": quantity
                    };
                    
                    // Only add offer_key fields if at least one SKU has an offer_key
                    if (hasAnyOfferKey) {
                        skuItem.offer_key = offerKey;
                        skuItem.offer_auto_apply = offerAutoApply;
                    }
                    
                    skuDetails.push(skuItem);
                    
                    totalItems += quantity;
                    calculatedAmount += (amountPerSku * quantity);
                }
            });
            
            // Build cart details
            const cartDetails = {
                "amount": calculatedAmount,
                "items": totalItems,
                "surcharges": "",
                "pre_discount": 0,
                "sku_details": skuDetails
            };
            
            // Update JSON preview
            document.getElementById('bo-json-preview').textContent = JSON.stringify(cartDetails, null, 2);
            
            // Update cart summary
            document.getElementById('bo-total-items').textContent = totalItems;
            document.getElementById('bo-calculated-amount').textContent = calculatedAmount.toFixed(2);
            
            console.log(' SKU preview updated - Items: ' + totalItems + ', Amount: ' + calculatedAmount);
        }
        
        // Build cart details JSON from form data
        function buildBankOfferCartDetails() {
            const skuEnabled = document.getElementById('bo_enable_sku').checked;
            
            if (!skuEnabled) {
                console.log('SKU not enabled - no cart_details will be sent');
                return null;
            }
            
            // Get JSON from preview
            const jsonPreview = document.getElementById('bo-json-preview').textContent;
            
            if (!jsonPreview || jsonPreview.trim() === '') {
                console.warn(' SKU enabled but no SKU items added');
                return null;
            }
            
            try {
                const cartDetails = JSON.parse(jsonPreview);
                console.log(' Using cart details:', cartDetails);
                return JSON.stringify(cartDetails);
            } catch (e) {
                console.error(' Failed to parse cart details:', e);
                return null;
            }
        }
        
        // Copy JSON to clipboard
        function copyBankOfferJson() {
            const jsonText = document.getElementById('bo-json-preview').textContent;
            if (!jsonText) {
                alert('No JSON to copy. Please select a scenario or build custom SKU items.');
                return;
            }
            
            navigator.clipboard.writeText(jsonText).then(function() {
                alert('JSON copied to clipboard!');
                console.log(' Cart details JSON copied to clipboard');
            }).catch(function(err) {
                console.error(' Failed to copy JSON:', err);
                alert('Failed to copy JSON. Please copy manually.');
            });
        }
        
        // Navigation Functions
        function loadSelectedFlow() {
            const flowSelect = document.getElementById('flowSelect');
            const selectedFlow = flowSelect.value;
            
            if (!selectedFlow) {
                alert('Please select a payment flow');
                return;
            }
            
            // If switching from a different flow, reset the new flow's fields
            if (currentFlow && currentFlow !== selectedFlow) {
                resetFormFields(selectedFlow);
                
                // Reset UDF fields for the new flow
                if (selectedFlow === 'nonseamless') {
                    document.getElementById('ns_udf1').value = '';
                    document.getElementById('ns_udf2').value = '';
                    document.getElementById('ns_udf3').value = '';
                    document.getElementById('ns_udf4').value = '';
                    document.getElementById('ns_udf5').value = '';
                } else if (selectedFlow === 'crossborder') {
                    // Reset to one-time by default
                    currentPaymentType = 'onetime';
                    document.getElementById('cb-onetime-btn').classList.add('active');
                    document.getElementById('cb-subscription-btn').classList.remove('active');
                    document.getElementById('cb-subscription-config').classList.remove('active');
                    document.getElementById('cb-onetime-udf-section').classList.remove('hidden');
                    document.getElementById('cb-subscription-udf-section').classList.add('hidden');
                    
                    // Reset one-time UDF fields
                    document.getElementById('cb_udf1_input').value = '';
                    document.getElementById('cb_udf2_input').value = '';
                    document.getElementById('cb_udf3_input').value = '';
                    document.getElementById('cb_udf4_input').value = '';
                    document.getElementById('cb_udf5_input').value = '';
                    
                    // Initialize subscription fields with default values (current date and interval=1)
                    const today = new Date().toISOString().split('T')[0];
                    document.getElementById('cb_billing_cycle').value = 'MONTHLY';
                    document.getElementById('cb_billing_interval').value = '1';
                    document.getElementById('cb_payment_start_date').value = today;
                    document.getElementById('cb_payment_end_date').value = '';
                    
                    console.log('Cross Border flow loaded - subscription fields initialized with defaults');
                    
                    // Reset subscription UDF fields
                    document.getElementById('cb_sub_udf1_input').value = '';
                    document.getElementById('cb_sub_udf2_input').value = '';
                    document.getElementById('cb_sub_udf3_input').value = '';
                    document.getElementById('cb_sub_udf4_input').value = '';
                    document.getElementById('cb_sub_udf5_input').value = '';
                } else if (selectedFlow === 'subscription') {
                    // Reset subscription fields
                    document.getElementById('sub_billing_cycle').value = 'MONTHLY';
                    document.getElementById('sub_billing_interval').value = '1';
                    document.getElementById('sub_payment_start_date').value = new Date().toISOString().split('T')[0];
                    document.getElementById('sub_payment_end_date').value = '';
                    
                    document.getElementById('sub_udf1').value = '';
                    document.getElementById('sub_udf2').value = '';
                    document.getElementById('sub_udf3').value = '';
                    document.getElementById('sub_udf4').value = '';
                    document.getElementById('sub_udf5').value = '';
                } else if (selectedFlow === 'tpv') {
                    // Reset TPV UDF fields
                    document.getElementById('tpv_udf1').value = '';
                    document.getElementById('tpv_udf2').value = '';
                    document.getElementById('tpv_udf3').value = '';
                    document.getElementById('tpv_udf4').value = '';
                    document.getElementById('tpv_udf5').value = '';
                } else if (selectedFlow === 'upiotm') {
                    // Reset UPI OTM date fields and UDFs
                    const today = new Date().toISOString().split('T')[0];
                    const endDate = new Date();
                    endDate.setDate(endDate.getDate() + 7);
                    document.getElementById('upi_payment_start_date').value = today;
                    document.getElementById('upi_payment_end_date').value = endDate.toISOString().split('T')[0];
                    
                    document.getElementById('upi_udf1').value = '';
                    document.getElementById('upi_udf2').value = '';
                    document.getElementById('upi_udf3').value = '';
                    document.getElementById('upi_udf4').value = '';
                    document.getElementById('upi_udf5').value = '';
                } else if (selectedFlow === 'preauth') {
                    // Reset PreAuth UDF fields
                    document.getElementById('preauth_udf1').value = '';
                    document.getElementById('preauth_udf2').value = '';
                    document.getElementById('preauth_udf3').value = '';
                    document.getElementById('preauth_udf4').value = '';
                    document.getElementById('preauth_udf5').value = '';
                } else if (selectedFlow === 'checkoutplus') {
                    // Reset Checkout Plus UDF fields
                    document.getElementById('cp_udf1').value = '';
                    document.getElementById('cp_udf2').value = '';
                    document.getElementById('cp_udf3').value = '';
                    document.getElementById('cp_udf4').value = '';
                    document.getElementById('cp_udf5').value = '';
                } else if (selectedFlow === 'bankoffer') {
                    // Reset Bank Offer UDF fields
                    document.getElementById('bo_udf1').value = '';
                    document.getElementById('bo_udf2').value = '';
                    document.getElementById('bo_udf3').value = '';
                    document.getElementById('bo_udf4').value = '';
                    document.getElementById('bo_udf5').value = '';
                    // Reset offer_key
                    document.getElementById('bo_offer_key').value = '';
                    // Reset SKU configuration
                    document.getElementById('bo_enable_sku').checked = false;
                    document.getElementById('bo-sku-config').style.display = 'none';
                    document.getElementById('bo-custom-sku-builder').style.display = 'none';
                    document.getElementById('boSkuRowsContainer').innerHTML = '';
                    boSkuRowCounter = 0;
                    // Uncheck all scenario radios
                    const scenarioRadios = document.querySelectorAll('input[name="bo_sku_scenario"]');
                    scenarioRadios.forEach(radio => radio.checked = false);
                    // Clear JSON preview
                    document.getElementById('bo-json-preview').textContent = '';
                }
            }
            
            currentFlow = selectedFlow;
            
            // Hide landing section
            document.getElementById('landingSection').style.display = 'none';
            
            // Show selected flow
            document.getElementById(selectedFlow + 'Flow').classList.add('active');
            
            // Generate fresh transaction ID for the selected flow
            generateTransactionId(selectedFlow);
            
            // Initialize split flow with a default row
            if (selectedFlow === 'split') {
                // Clear any existing rows
                document.getElementById('splitRowsContainer').innerHTML = '';
                splitRowCounter = 0;
                // Add one default split row
                addSplitRow();
                console.log(' Split flow initialized with default row');
            }
            
            // Save current flow to localStorage for persistence on refresh
            localStorage.setItem('currentPaymentFlow', selectedFlow);
            if (selectedFlow === 'crossborder') {
                localStorage.setItem('currentPaymentType', currentPaymentType);
            }
            console.log(' Flow saved to localStorage:', selectedFlow);
        }
        
        function backToLanding() {
            // Hide all flow sections
            document.querySelectorAll('.flow-content').forEach(function(section) {
                section.classList.remove('active');
            });
            
            // Show landing section
            document.getElementById('landingSection').style.display = 'block';
            
            // Reset flow selector
            document.getElementById('flowSelect').value = '';
            currentFlow = '';
            
            // Hide debug sections
            hideDebugAndCurl('crossborder');
            hideDebugAndCurl('nonseamless');
            hideDebugAndCurl('subscription');
            hideDebugAndCurl('tpv');
            hideDebugAndCurl('upiotm');
            hideDebugAndCurl('preauth');
            hideDebugAndCurl('checkoutplus');
            hideDebugAndCurl('split');
            hideDebugAndCurl('bankoffer');
            
            // Clear localStorage when going back to flow selection
            localStorage.removeItem('currentPaymentFlow');
            localStorage.removeItem('currentPaymentType');
            console.log(' localStorage cleared - returned to landing page');
        }
        
        // Transaction ID Generation
        function generateTransactionId(flow) {
            const timestamp = Date.now();
            const txnId = 'txn_' + flow + '_' + timestamp;
            const prefix = flow === 'crossborder' ? 'cb' : (flow === 'subscription' ? 'sub' : (flow === 'tpv' ? 'tpv' : (flow === 'upiotm' ? 'upi' : (flow === 'preauth' ? 'preauth' : (flow === 'checkoutplus' ? 'cp' : (flow === 'split' ? 'split' : (flow === 'bankoffer' ? 'bo' : 'ns')))))));
            
            const txnidField = document.getElementById(prefix + '_txnid');
            if (txnidField) {
                txnidField.value = txnId;
                console.log(' Generated Transaction ID for ' + flow + ':', txnId);
                console.log('  Field ID:', prefix + '_txnid');
            } else {
                console.error(' Transaction ID field NOT FOUND:', prefix + '_txnid');
            }
            
            return txnId;
        }
        
        // Validation Functions
        function validatePhone(flow) {
            const prefix = flow === 'crossborder' ? 'cb' : (flow === 'subscription' ? 'sub' : (flow === 'tpv' ? 'tpv' : (flow === 'upiotm' ? 'upi' : (flow === 'preauth' ? 'preauth' : (flow === 'checkoutplus' ? 'cp' : (flow === 'split' ? 'split' : (flow === 'bankoffer' ? 'bo' : 'ns')))))));
            const phoneInput = document.getElementById(prefix + '_phone');
            const phoneError = document.getElementById(prefix + '-phone-error');
            
            if (!phoneInput) return true;
            
            // Remove non-numeric characters
            const phone = phoneInput.value.replace(/[^0-9]/g, '');
            
            // Limit to maximum 10 digits
            const limitedPhone = phone.substring(0, 10);
            phoneInput.value = limitedPhone;
            
            if (limitedPhone.length === 0) {
                phoneInput.classList.remove('error');
                if (phoneError) phoneError.style.display = 'none';
                return true;
            }
            
            // All flows require exactly 10 digits
            if (limitedPhone.length !== 10) {
                phoneInput.classList.add('error');
                if (phoneError) {
                    if (limitedPhone.length < 10) {
                        phoneError.textContent = 'Phone number must be exactly 10 digits (currently ' + limitedPhone.length + ' digits)';
                    } else {
                        phoneError.textContent = 'Phone number cannot exceed 10 digits';
                    }
                    phoneError.style.display = 'block';
                }
                return false;
            }
            
            phoneInput.classList.remove('error');
            if (phoneError) phoneError.style.display = 'none';
            return true;
        }
        
        function validateEmail(flow) {
            const prefix = flow === 'crossborder' ? 'cb' : (flow === 'subscription' ? 'sub' : (flow === 'tpv' ? 'tpv' : (flow === 'upiotm' ? 'upi' : (flow === 'preauth' ? 'preauth' : (flow === 'checkoutplus' ? 'cp' : (flow === 'split' ? 'split' : (flow === 'bankoffer' ? 'bo' : 'ns')))))));
            const emailInput = document.getElementById(prefix + '_email');
            const emailError = document.getElementById(prefix + '-email-error');
            
            if (!emailInput) return true;
            
            const email = emailInput.value;
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            
            if (email.length === 0) {
                emailInput.classList.remove('error');
                if (emailError) emailError.style.display = 'none';
                return true;
            }
            
            if (!emailRegex.test(email)) {
                emailInput.classList.add('error');
                if (emailError) {
                    emailError.textContent = 'Please enter a valid email address';
                    emailError.style.display = 'block';
                }
                return false;
            }
            
            emailInput.classList.remove('error');
            if (emailError) emailError.style.display = 'none';
            return true;
        }
        
        // Validate Subscription Start Date (prevent past dates)
        function validateSubscriptionStartDate(flow) {
            const prefix = flow === 'crossborder' ? 'cb' : 'sub';
            const startDateInput = document.getElementById(prefix + '_payment_start_date');
            
            if (!startDateInput || !startDateInput.value) return true;
            
            const selectedDate = new Date(startDateInput.value);
            const today = new Date();
            today.setHours(0, 0, 0, 0); // Reset time to compare only dates
            
            if (selectedDate < today) {
                alert('Payment Start Date cannot be in the past. Please select current date or a future date.');
                // Reset to today's date
                const todayStr = new Date().toISOString().split('T')[0];
                startDateInput.value = todayStr;
                startDateInput.min = todayStr;
                return false;
            }
            
            return true;
        }
        
        // Custom Keys Functions
        function toggleCustomKeys(flow) {
            const prefix = flow === 'crossborder' ? 'cb' : (flow === 'subscription' ? 'sub' : (flow === 'tpv' ? 'tpv' : (flow === 'upiotm' ? 'upi' : (flow === 'preauth' ? 'preauth' : (flow === 'checkoutplus' ? 'cp' : (flow === 'split' ? 'split' : (flow === 'bankoffer' ? 'bo' : 'ns')))))));
            const isCustom = document.getElementById(prefix + '_use_custom_keys').checked;
            const customFields = document.getElementById(prefix + '-custom-key-fields');
            
            if (isCustom) {
                customFields.classList.add('active');
                document.getElementById(prefix + '_custom_key').value = '';
                document.getElementById(prefix + '_custom_salt').value = '';
                document.getElementById(prefix + '_custom_salt').type = 'password';
            } else {
                customFields.classList.remove('active');
                document.getElementById(prefix + '_custom_key').value = '';
                document.getElementById(prefix + '_custom_salt').value = '';
            }
            
            // Clear cached hash
            const hashField = document.getElementById(prefix + '_hash');
            if (hashField) hashField.value = '';
            
            // For split payment, update existing child merchant keys when toggle changes
            if (flow === 'split') {
                const splitRows = document.querySelectorAll('.split-row');
                const rowCount = splitRows.length;
                
                splitRows.forEach((row, index) => {
                    const merchantKeyInput = row.querySelector('.split-merchant-key');
                    if (merchantKeyInput) {
                        if (isCustom) {
                            // Clear child merchant key when using custom keys
                            merchantKeyInput.value = '';
                        } else {
                            // Prefill with test child merchant key when not using custom keys
                            // First child = 'gYoEaY', second child = '5rgA73', third+ = blank
                            if (index === 0) {
                                merchantKeyInput.value = 'gYoEaY';
                            } else if (index === 1) {
                                merchantKeyInput.value = '5rgA73';
                            } else {
                                merchantKeyInput.value = '';
                            }
                        }
                    }
                });
                
                console.log(' Updated ' + rowCount + ' child merchant key(s) - Custom keys: ' + isCustom);
                
                // If no child rows exist and not using custom keys, add one default row
                if (rowCount === 0 && !isCustom) {
                    addSplitRow();
                    console.log(' Added default child row after unchecking custom keys');
                }
            }
            
            // For bank offers, update SKU items when toggle changes
            if (flow === 'bankoffer') {
                const skuEnabled = document.getElementById('bo_enable_sku').checked;
                
                if (skuEnabled) {
                    // Clear existing SKU rows
                    document.getElementById('boSkuRowsContainer').innerHTML = '';
                    boSkuRowCounter = 0;
                    
                    if (!isCustom) {
                        // Predefined credentials - add 2 SKUs with prefilled IDs/names
                        addBankOfferSkuRow('testProduct11', 'SkuTest11');
                        addBankOfferSkuRow('testProduct12', 'SkuTest12');
                        console.log(' Switched to predefined credentials - 2 prefilled SKUs added');
                    } else {
                        // Custom credentials - clear all SKUs
                        console.log(' Switched to custom credentials - SKUs cleared');
                    }
                    
                    updateSkuLimitMessage();
                }
            }
        }
        
        function toggleSaltVisibility(flow) {
            const prefix = flow === 'crossborder' ? 'cb' : (flow === 'subscription' ? 'sub' : (flow === 'tpv' ? 'tpv' : (flow === 'upiotm' ? 'upi' : (flow === 'preauth' ? 'preauth' : (flow === 'checkoutplus' ? 'cp' : (flow === 'split' ? 'split' : (flow === 'bankoffer' ? 'bo' : 'ns')))))));
            const saltInput = document.getElementById(prefix + '_custom_salt');
            const toggleButton = event.target;
            
            if (saltInput.type === 'password') {
                saltInput.type = 'text';
                toggleButton.textContent = 'Hide';
            } else {
                saltInput.type = 'password';
                toggleButton.textContent = 'Show';
            }
        }
        
        function getCredentials(flow) {
            const prefix = flow === 'crossborder' ? 'cb' : (flow === 'subscription' ? 'sub' : (flow === 'tpv' ? 'tpv' : (flow === 'upiotm' ? 'upi' : (flow === 'preauth' ? 'preauth' : (flow === 'checkoutplus' ? 'cp' : (flow === 'split' ? 'split' : (flow === 'bankoffer' ? 'bo' : 'ns')))))));
            const useCustom = document.getElementById(prefix + '_use_custom_keys').checked;
            
            if (useCustom) {
                const customKey = document.getElementById(prefix + '_custom_key').value;
                const customSalt = document.getElementById(prefix + '_custom_salt').value;
                
                if (!customKey || !customSalt) {
                    console.warn('Custom credentials not fully provided, using defaults');
                    return { key: DEFAULT_KEY, salt: DEFAULT_SALT };
                }
                
                return { key: customKey, salt: customSalt };
            }
            
            return { key: DEFAULT_KEY, salt: DEFAULT_SALT };
        }
        
        // Cross Border Payment Type Selection
        function selectPaymentType(type, flow) {
            if (flow !== 'crossborder') return;
            
            // Don't reset if already on the same type
            if (currentPaymentType === type) {
                console.log('Already on ' + type + ' payment type, no reset needed');
                return;
            }
            
            console.log('Switching from ' + currentPaymentType + ' to ' + type);
            currentPaymentType = type;
            
            // Update button states
            document.querySelectorAll('#crossborderFlow .payment-type-btn').forEach(function(btn) {
                btn.classList.remove('active');
            });
            document.getElementById('cb-' + type + '-btn').classList.add('active');
            
            // Show/hide sections
            const subscriptionConfig = document.getElementById('cb-subscription-config');
            const onetimeUdfSection = document.getElementById('cb-onetime-udf-section');
            const subscriptionUdfSection = document.getElementById('cb-subscription-udf-section');
            
            if (type === 'subscription') {
                subscriptionConfig.classList.add('active');
                onetimeUdfSection.classList.add('hidden');
                subscriptionUdfSection.classList.remove('hidden');
                
                document.getElementById('cb_si').value = '1';
                document.getElementById('cb_api_version').value = '7';
                
                // Set default values for subscription fields (editable) - ALWAYS set these values
                const today = new Date().toISOString().split('T')[0];
                
                // Force set the values - these must be current date and 1
                document.getElementById('cb_billing_cycle').value = 'MONTHLY';
                document.getElementById('cb_billing_interval').value = '1';
                document.getElementById('cb_payment_start_date').value = today;
                document.getElementById('cb_payment_end_date').value = '';
                
                console.log(' Cross Border Subscription fields set:');
                console.log('  - Payment Start Date:', today);
                console.log('  - Billing Interval: 1');
                console.log('  - Billing Cycle: MONTHLY');
                
                // Reset subscription UDF fields
                document.getElementById('cb_sub_udf1_input').value = '';
                document.getElementById('cb_sub_udf2_input').value = '';
                document.getElementById('cb_sub_udf3_input').value = '';
                document.getElementById('cb_sub_udf4_input').value = '';
                document.getElementById('cb_sub_udf5_input').value = '';
            } else {
                subscriptionConfig.classList.remove('active');
                onetimeUdfSection.classList.remove('hidden');
                subscriptionUdfSection.classList.add('hidden');
                
                document.getElementById('cb_si').value = '';
                document.getElementById('cb_api_version').value = '';
                document.getElementById('cb_si_details').value = '';
                
                // Reset one-time UDF fields
                document.getElementById('cb_udf1_input').value = '';
                document.getElementById('cb_udf2_input').value = '';
                document.getElementById('cb_udf3_input').value = '';
                document.getElementById('cb_udf4_input').value = '';
                document.getElementById('cb_udf5_input').value = '';
            }
            
            // Reset common fields
            resetFormFields('crossborder');
            
            hideDebugAndCurl('crossborder');
            
            // Save payment type to localStorage for persistence
            localStorage.setItem('currentPaymentType', type);
            console.log(' Payment type saved to localStorage:', type);
        }
        
        // TPV Payment Type Selection
        // Reset Form Fields
        function resetFormFields(flow) {
            console.log('Resetting form fields for flow:', flow);
            const prefix = flow === 'crossborder' ? 'cb' : (flow === 'subscription' ? 'sub' : (flow === 'tpv' ? 'tpv' : (flow === 'upiotm' ? 'upi' : (flow === 'preauth' ? 'preauth' : 'ns'))));
            
            // Reset payment details
            const amountField = document.getElementById(prefix + '_amount');
            if (amountField) {
                // Special handling for UPI OTM - don't clear, set to default 17000
                if (flow === 'upiotm') {
                    amountField.value = '17000';
                    console.log('Set UPI OTM amount to default: 17000');
                } else {
                    amountField.value = '';
                    console.log('Reset amount field');
                }
            }
            const productinfoField = document.getElementById(prefix + '_productinfo');
            if (productinfoField) {
                productinfoField.value = '';
                console.log('Reset productinfo field');
            }
            
            // Reset customer details
            const firstnameField = document.getElementById(prefix + '_firstname');
            if (firstnameField) firstnameField.value = '';
            
            const lastname = document.getElementById(prefix + '_lastname');
            if (lastname) lastname.value = '';
            
            const emailField = document.getElementById(prefix + '_email');
            if (emailField) emailField.value = '';
            
            const phoneField = document.getElementById(prefix + '_phone');
            if (phoneField) phoneField.value = '';
            
            // Reset address fields
            const address1 = document.getElementById(prefix + '_address1');
            if (address1) address1.value = '';
            const address2 = document.getElementById(prefix + '_address2');
            if (address2) address2.value = '';
            const city = document.getElementById(prefix + '_city');
            if (city) city.value = '';
            const state = document.getElementById(prefix + '_state');
            if (state) state.value = '';
            const country = document.getElementById(prefix + '_country');
            if (country) country.value = '';
            const zipcode = document.getElementById(prefix + '_zipcode');
            if (zipcode) zipcode.value = '';
            
            // Reset buyer type for cross border to default (Individual = 0)
            if (flow === 'crossborder') {
                document.getElementById('cb_buyer_type').value = '0';
            }
            
            // Reset custom keys
            const useCustomKeysCheckbox = document.getElementById(prefix + '_use_custom_keys');
            if (useCustomKeysCheckbox) {
                useCustomKeysCheckbox.checked = false;
            }
            const customKeyFields = document.getElementById(prefix + '-custom-key-fields');
            if (customKeyFields) {
                customKeyFields.classList.remove('active');
            }
            const customKey = document.getElementById(prefix + '_custom_key');
            if (customKey) customKey.value = '';
            const customSalt = document.getElementById(prefix + '_custom_salt');
            if (customSalt) {
                customSalt.value = '';
                customSalt.type = 'password';
            }
            
            // Reset payment method checkboxes
            document.querySelectorAll('input[name="' + prefix + '_paymethod"]').forEach(function(checkbox) {
                checkbox.checked = false;
            });
            
            // Reset redirect URLs to default
            const surl = document.getElementById(prefix + '_surl');
            if (surl) surl.value = 'https://test.payu.in/admin/test_response';
            const furl = document.getElementById(prefix + '_furl');
            if (furl) furl.value = 'https://test.payu.in/admin/test_response';
            
            // Clear validation errors
            const emailError = document.getElementById(prefix + '-email-error');
            if (emailError) emailError.style.display = 'none';
            const phoneError = document.getElementById(prefix + '-phone-error');
            if (phoneError) phoneError.style.display = 'none';
            
            document.querySelectorAll('.error').forEach(function(element) {
                element.classList.remove('error');
            });
            
            // Clear hidden form fields
            const hashField = document.getElementById(prefix + '_hash');
            if (hashField) hashField.value = '';
            
            // Force clear all input fields in the flow section
            const flowSection = document.getElementById(flow + 'Flow');
            if (flowSection) {
                const today = new Date().toISOString().split('T')[0];
                const allInputs = flowSection.querySelectorAll('input[type="text"], input[type="number"], input[type="email"], input[type="url"], input[type="date"], select');
                allInputs.forEach(function(input) {
                    // Don't clear hidden form fields or txnid, surl, furl
                    if (input.type !== 'hidden' && !input.id.includes('txnid') && !input.id.includes('surl') && !input.id.includes('furl')) {
                        // Reset to default values for selects
                        if (input.tagName === 'SELECT') {
                            // Reset specific selects to their defaults
                            if (input.id === 'cb_billing_cycle' || input.id === 'sub_billing_cycle') {
                                input.value = 'MONTHLY';
                            } else if (input.id === 'cb_billing_interval' || input.id === 'sub_billing_interval') {
                                input.value = '1';
                            } else if (input.id === 'cb_buyer_type') {
                                input.value = '0'; // Default to Individual
                            } else {
                                input.selectedIndex = 0;
                            }
                        } else if (input.type === 'date' && (input.id === 'cb_payment_start_date' || input.id === 'sub_payment_start_date' || input.id === 'upi_payment_start_date')) {
                            // Set subscription start dates to today (not empty)
                            input.value = today;
                            console.log('Set ' + input.id + ' to today:', today);
                        } else if (input.type === 'date' && input.id === 'upi_payment_end_date') {
                            // Set UPI OTM end date to 7 days from today
                            const endDate = new Date();
                            endDate.setDate(endDate.getDate() + 7);
                            input.value = endDate.toISOString().split('T')[0];
                            console.log('Set UPI OTM end date to 7 days from today:', input.value);
                        } else if (input.type === 'number' && (input.id === 'cb_billing_interval' || input.id === 'sub_billing_interval')) {
                            // Set billing interval to 1
                            input.value = '1';
                        } else if (input.id === 'upi_amount') {
                            // Already handled above - keep default 17000
                            // Don't clear this field
                        } else {
                            input.value = '';
                        }
                    }
                });
                console.log('Force cleared all visible input fields in ' + flow + ' flow');
            }
            
            // Generate new transaction ID
            generateTransactionId(flow);
            
            console.log('Form fields reset completed for ' + flow);
        }
        
        // Hide Debug and CURL
        function hideDebugAndCurl(flow) {
            const prefix = flow === 'crossborder' ? 'cb' : (flow === 'subscription' ? 'sub' : (flow === 'tpv' ? 'tpv' : (flow === 'upiotm' ? 'upi' : (flow === 'preauth' ? 'preauth' : (flow === 'checkoutplus' ? 'cp' : (flow === 'split' ? 'split' : (flow === 'bankoffer' ? 'bo' : 'ns')))))));
            document.getElementById(prefix + '-debugSection').style.display = 'none';
            document.getElementById(prefix + '-curlSection').style.display = 'none';
        }
        
        // Validate Form
        function validateForm(flow) {
            const prefix = flow === 'crossborder' ? 'cb' : (flow === 'subscription' ? 'sub' : (flow === 'tpv' ? 'tpv' : (flow === 'upiotm' ? 'upi' : (flow === 'preauth' ? 'preauth' : (flow === 'checkoutplus' ? 'cp' : (flow === 'split' ? 'split' : (flow === 'bankoffer' ? 'bo' : 'ns')))))));
            
            // Common required fields
            let requiredFields = ['amount', 'productinfo', 'firstname', 'email', 'phone'];
            
            // Flow-specific required fields
            if (flow === 'split') {
                // Split payment specific validation
                if (!validateSplitAmounts()) {
                    return false;
                }
                console.log('Split Payment - Split amounts validated');
            } else if (flow === 'crossborder') {
                requiredFields.push('address1', 'city', 'state', 'country', 'zipcode', 'lastname');
                
                if (currentPaymentType === 'onetime') {
                    requiredFields.push('udf5_input');
                } else {
                    // Cross border subscription
                    requiredFields.push('payment_start_date', 'payment_end_date', 'billing_cycle', 'billing_interval');
                    
                    console.log('=== Cross Border Subscription Validation ===');
                    
                    // Validate payment start date (no past dates)
                    if (!validateSubscriptionStartDate('crossborder')) {
                        return false;
                    }
                    
                    // Check enforced payment methods for cross border subscription
                    const paymethodCheckboxes = document.querySelectorAll('input[name="cb_paymethod"]:checked');
                    const selectedPaymethods = [];
                    paymethodCheckboxes.forEach(checkbox => {
                        selectedPaymethods.push(checkbox.id);
                    });
                    
                    console.log('Selected payment methods:', selectedPaymethods);
                    
                    // Dynamic UDF validation based on payment method for Cross Border Subscription
                    if (selectedPaymethods.length > 0) {
                        // Payment methods are enforced
                        if (selectedPaymethods.includes('cb_upi')) {
                            // UPI is selected - UDF3 is mandatory (field ID: cb_sub_udf3_input)
                            const udf3Field = document.getElementById('cb_sub_udf3_input');
                            if (!udf3Field || !udf3Field.value.trim()) {
                                alert('UDF3 is required when UPI payment method is enforced for Cross Border Subscription');
                                if (udf3Field) udf3Field.focus();
                                return false;
                            }
                            console.log(' UPI enforced - UDF3 validated');
                        } else {
                            // Other payment methods (not UPI) - UDF5 is mandatory (field ID: cb_sub_udf5_input)
                            const udf5Field = document.getElementById('cb_sub_udf5_input');
                            if (!udf5Field || !udf5Field.value.trim()) {
                                alert('UDF5 is required when Cards/NetBanking payment method is enforced for Cross Border Subscription');
                                if (udf5Field) udf5Field.focus();
                                return false;
                            }
                            console.log(' Non-UPI payment method enforced - UDF5 validated');
                        }
                    } else {
                        // No payment method enforced - All UDF fields are optional
                        console.log(' No payment method enforced - All UDF fields are OPTIONAL');
                    }
                }
            } else if (flow === 'subscription') {
                // Non-Seamless Subscription - only subscription fields are mandatory
                requiredFields.push('payment_start_date', 'payment_end_date', 'billing_cycle', 'billing_interval');
                
                // Validate payment start date (no past dates)
                if (!validateSubscriptionStartDate('subscription')) {
                    return false;
                }
                
                // Note: For Non-Seamless Subscription, UDF fields are all optional
                // No dynamic UDF validation for this flow
                console.log('Non-Seamless Subscription - All UDF fields are optional');
            } else if (flow === 'tpv') {
                // TPV One Time specific validation
                requiredFields.push('beneficiary_account', 'ifsc_code');
                console.log('TPV One Time - Beneficiary account and IFSC code are mandatory');
            } else if (flow === 'upiotm') {
                // UPI OTM specific validation
                requiredFields.push('payment_start_date', 'payment_end_date');
                
                // Validate date range (14-day limit)
                if (!validateUpiOtmDates()) {
                    return false;
                }
                
                console.log('UPI OTM - Payment dates validated');
            } else if (flow === 'preauth') {
                // PreAuth specific validation - enforce payment method is required
                const paymethodCheckboxes = document.querySelectorAll('input[name="preauth_paymethod"]:checked');
                if (paymethodCheckboxes.length === 0) {
                    alert('Please select at least one payment method (Credit Card is required for PreAuth flow)');
                    return false;
                }
                console.log('PreAuth - Payment method validated');
            }
            
            // Check custom keys if enabled
            if (document.getElementById(prefix + '_use_custom_keys').checked) {
                const customKey = document.getElementById(prefix + '_custom_key').value;
                const customSalt = document.getElementById(prefix + '_custom_salt').value;
                if (!customKey || !customSalt) {
                    alert('Please provide both custom merchant key and salt');
                    return false;
                }
            }
            
            // Validate required fields
            for (let i = 0; i < requiredFields.length; i++) {
                const fieldName = requiredFields[i];
                const fieldId = prefix + '_' + fieldName;
                const field = document.getElementById(fieldId);
                
                if (!field || !field.value.trim()) {
                    let fieldLabel = fieldName.replace(/_/g, ' ').toUpperCase();
                    if (fieldName === 'udf3') {
                        fieldLabel = 'UDF3 (Required when UPI payment method is enforced)';
                    } else if (fieldName === 'udf5') {
                        fieldLabel = 'UDF5 (Required when payment method is enforced)';
                    } else if (fieldName === 'sub_udf3_input') {
                        if (flow === 'crossborder') {
                            fieldLabel = 'UDF3 (Required when UPI payment method is enforced for Cross Border Subscription)';
                        } else {
                            fieldLabel = 'UDF3 (Invoice ID & Merchant Name - Required for Subscription)';
                        }
                    } else if (fieldName === 'sub_udf5_input') {
                        fieldLabel = 'UDF5 (Required when non-UPI payment method is enforced for Cross Border Subscription)';
                    }
                    alert('Please fill the required field: ' + fieldLabel);
                    if (field) field.focus();
                    return false;
                }
            }
            
            // Validate email and phone
            if (!validateEmail(flow) || !validatePhone(flow)) {
                return false;
            }
            
            return true;
        }
        
        // Generate Hash
        function generateHash(flow) {
            // Set correct prefix based on flow
            const prefix = flow === 'crossborder' ? 'cb' : (flow === 'subscription' ? 'sub' : (flow === 'tpv' ? 'tpv' : (flow === 'upiotm' ? 'upi' : (flow === 'preauth' ? 'preauth' : (flow === 'checkoutplus' ? 'cp' : (flow === 'split' ? 'split' : (flow === 'bankoffer' ? 'bo' : 'ns')))))));
            const credentials = getCredentials(flow);
            
            const txnid = document.getElementById(prefix + '_txnid').value;
            const amount = document.getElementById(prefix + '_amount').value;
            const productinfo = document.getElementById(prefix + '_productinfo').value;
            const firstname = document.getElementById(prefix + '_firstname').value;
            const email = document.getElementById(prefix + '_email').value;
            
            let udf1 = '', udf2 = '', udf3 = '', udf4 = '', udf5 = '';
            let hashString = '';
            let hashFormula = '';
            let siDetailsJson = '';
            
            if (flow === 'crossborder' && currentPaymentType === 'subscription') {
                // Cross Border Subscription hash
                udf1 = document.getElementById('cb_sub_udf1_input').value || '';
                udf2 = document.getElementById('cb_sub_udf2_input').value || '';
                udf3 = document.getElementById('cb_sub_udf3_input').value || '';
                udf4 = document.getElementById('cb_sub_udf4_input').value || '';
                udf5 = document.getElementById('cb_sub_udf5_input').value || '';
                
                const billingCycle = document.getElementById('cb_billing_cycle').value;
                const billingInterval = document.getElementById('cb_billing_interval').value;
                const paymentStartDate = document.getElementById('cb_payment_start_date').value;
                const paymentEndDate = document.getElementById('cb_payment_end_date').value;
                
                const siDetails = {
                    "billingAmount": amount,
                    "billingCurrency": "INR",
                    "billingCycle": billingCycle,
                    "billingInterval": parseInt(billingInterval),
                    "paymentStartDate": paymentStartDate
                };
                
                if (paymentEndDate) {
                    siDetails.paymentEndDate = paymentEndDate;
                }
                
                siDetailsJson = JSON.stringify(siDetails);
                document.getElementById('cb_si_details').value = siDetailsJson;
                
                // Check if buyer_type_business has a value (0 or 1)
                const buyerTypeBusiness = document.getElementById('cb_buyer_type').value;
                if (buyerTypeBusiness !== '') {
                    // Include buyer_type_business in hash
                    hashString = credentials.key + '|' + txnid + '|' + amount + '|' + productinfo + '|' + firstname + '|' + email + '|' + udf1 + '|' + udf2 + '|' + udf3 + '|' + udf4 + '|' + udf5 + '||||||' + siDetailsJson + '|' + credentials.salt + '|' + buyerTypeBusiness;
                    hashFormula = 'SHA512(key|txnid|amount|productinfo|firstname|email|udf1|udf2|udf3|udf4|udf5||||||si_details|SALT|buyer_type_business)';
                } else {
                    // Hash without buyer_type_business
                    hashString = credentials.key + '|' + txnid + '|' + amount + '|' + productinfo + '|' + firstname + '|' + email + '|' + udf1 + '|' + udf2 + '|' + udf3 + '|' + udf4 + '|' + udf5 + '||||||' + siDetailsJson + '|' + credentials.salt;
                    hashFormula = 'SHA512(key|txnid|amount|productinfo|firstname|email|udf1|udf2|udf3|udf4|udf5||||||si_details|SALT)';
                }
            } else if (flow === 'subscription') {
                // Non-Seamless Subscription hash
                udf1 = document.getElementById('sub_udf1').value || '';
                udf2 = document.getElementById('sub_udf2').value || '';
                udf3 = document.getElementById('sub_udf3').value || '';
                udf4 = document.getElementById('sub_udf4').value || '';
                udf5 = document.getElementById('sub_udf5').value || '';
                
                const billingCycle = document.getElementById('sub_billing_cycle').value;
                const billingInterval = document.getElementById('sub_billing_interval').value;
                const paymentStartDate = document.getElementById('sub_payment_start_date').value;
                const paymentEndDate = document.getElementById('sub_payment_end_date').value;
                
                const siDetails = {
                    "billingAmount": amount,
                    "billingCurrency": "INR",
                    "billingCycle": billingCycle,
                    "billingInterval": parseInt(billingInterval),
                    "paymentStartDate": paymentStartDate
                };
                
                if (paymentEndDate) {
                    siDetails.paymentEndDate = paymentEndDate;
                }
                
                siDetailsJson = JSON.stringify(siDetails);
                document.getElementById('sub_si_details').value = siDetailsJson;
                hashString = credentials.key + '|' + txnid + '|' + amount + '|' + productinfo + '|' + firstname + '|' + email + '|' + udf1 + '|' + udf2 + '|' + udf3 + '|' + udf4 + '|' + udf5 + '||||||' + siDetailsJson + '|' + credentials.salt;
                hashFormula = 'SHA512(key|txnid|amount|productinfo|firstname|email|udf1|udf2|udf3|udf4|udf5||||||si_details|SALT)';
            } else if (flow === 'crossborder') {
                // Cross border one-time
                udf1 = document.getElementById('cb_udf1_input').value || '';
                udf2 = document.getElementById('cb_udf2_input').value || '';
                udf3 = document.getElementById('cb_udf3_input').value || '';
                udf4 = document.getElementById('cb_udf4_input').value || '';
                udf5 = document.getElementById('cb_udf5_input').value || '';
                
                // Check if buyer_type_business has a value (0 or 1)
                const buyerTypeBusiness = document.getElementById('cb_buyer_type').value;
                if (buyerTypeBusiness !== '') {
                    // Include buyer_type_business in hash
                    hashString = credentials.key + '|' + txnid + '|' + amount + '|' + productinfo + '|' + firstname + '|' + email + '|' + udf1 + '|' + udf2 + '|' + udf3 + '|' + udf4 + '|' + udf5 + '||||||' + credentials.salt + '|' + buyerTypeBusiness;
                    hashFormula = 'SHA512(key|txnid|amount|productinfo|firstname|email|udf1|udf2|udf3|udf4|udf5||||||SALT|buyer_type_business)';
                } else {
                    // Hash without buyer_type_business
                    hashString = credentials.key + '|' + txnid + '|' + amount + '|' + productinfo + '|' + firstname + '|' + email + '|' + udf1 + '|' + udf2 + '|' + udf3 + '|' + udf4 + '|' + udf5 + '||||||' + credentials.salt;
                    hashFormula = 'SHA512(key|txnid|amount|productinfo|firstname|email|udf1|udf2|udf3|udf4|udf5||||||SALT)';
                }
            } else if (flow === 'tpv') {
                // TPV One Time
                udf1 = document.getElementById('tpv_udf1').value || '';
                udf2 = document.getElementById('tpv_udf2').value || '';
                udf3 = document.getElementById('tpv_udf3').value || '';
                udf4 = document.getElementById('tpv_udf4').value || '';
                udf5 = document.getElementById('tpv_udf5').value || '';
                
                // Construct beneficiarydetail JSON
                const beneficiaryAccount = document.getElementById('tpv_beneficiary_account').value || '';
                const ifscCode = document.getElementById('tpv_ifsc_code').value || '';
                
                const beneficiaryDetail = {
                    "beneficiaryAccountNumber": beneficiaryAccount,
                    "ifscCode": ifscCode
                };
                
                const beneficiaryDetailJson = JSON.stringify(beneficiaryDetail);
                document.getElementById('tpv_beneficiarydetail').value = beneficiaryDetailJson;
                
                hashString = credentials.key + '|' + txnid + '|' + amount + '|' + productinfo + '|' + firstname + '|' + email + '|' + udf1 + '|' + udf2 + '|' + udf3 + '|' + udf4 + '|' + udf5 + '||||||' + beneficiaryDetailJson + '|' + credentials.salt;
                hashFormula = 'SHA512(key|txnid|amount|productinfo|firstname|email|udf1|udf2|udf3|udf4|udf5||||||beneficiarydetail|SALT)';
            } else if (flow === 'upiotm') {
                // UPI OTM (One Time Mandate)
                udf1 = document.getElementById('upi_udf1').value || '';
                udf2 = document.getElementById('upi_udf2').value || '';
                udf3 = document.getElementById('upi_udf3').value || '';
                udf4 = document.getElementById('upi_udf4').value || '';
                udf5 = document.getElementById('upi_udf5').value || '';
                
                // Construct siDetails JSON (only dates, no billing cycle/interval for UPI OTM)
                const paymentStartDate = document.getElementById('upi_payment_start_date').value || '';
                const paymentEndDate = document.getElementById('upi_payment_end_date').value || '';
                
                const siDetails = {
                    "paymentStartDate": paymentStartDate,
                    "paymentEndDate": paymentEndDate
                };
                
                siDetailsJson = JSON.stringify(siDetails);
                document.getElementById('upi_si_details').value = siDetailsJson;
                hashString = credentials.key + '|' + txnid + '|' + amount + '|' + productinfo + '|' + firstname + '|' + email + '|' + udf1 + '|' + udf2 + '|' + udf3 + '|' + udf4 + '|' + udf5 + '||||||' + siDetailsJson + '|' + credentials.salt;
                hashFormula = 'SHA512(key|txnid|amount|productinfo|firstname|email|udf1|udf2|udf3|udf4|udf5||||||si_details|SALT)';
            } else if (flow === 'preauth') {
                // PreAuth Card - Standard hash (no si_details, no special parameters)
                udf1 = document.getElementById('preauth_udf1').value || '';
                udf2 = document.getElementById('preauth_udf2').value || '';
                udf3 = document.getElementById('preauth_udf3').value || '';
                udf4 = document.getElementById('preauth_udf4').value || '';
                udf5 = document.getElementById('preauth_udf5').value || '';
                
                hashString = credentials.key + '|' + txnid + '|' + amount + '|' + productinfo + '|' + firstname + '|' + email + '|' + udf1 + '|' + udf2 + '|' + udf3 + '|' + udf4 + '|' + udf5 + '||||||' + credentials.salt;
                hashFormula = 'SHA512(key|txnid|amount|productinfo|firstname|email|udf1|udf2|udf3|udf4|udf5||||||SALT)';
            } else if (flow === 'checkoutplus') {
                // Checkout Plus - Standard hash
                udf1 = document.getElementById('cp_udf1').value || '';
                udf2 = document.getElementById('cp_udf2').value || '';
                udf3 = document.getElementById('cp_udf3').value || '';
                udf4 = document.getElementById('cp_udf4').value || '';
                udf5 = document.getElementById('cp_udf5').value || '';
                
                hashString = credentials.key + '|' + txnid + '|' + amount + '|' + productinfo + '|' + firstname + '|' + email + '|' + udf1 + '|' + udf2 + '|' + udf3 + '|' + udf4 + '|' + udf5 + '||||||' + credentials.salt;
                hashFormula = 'SHA512(key|txnid|amount|productinfo|firstname|email|udf1|udf2|udf3|udf4|udf5||||||SALT)';
            } else if (flow === 'split') {
                // Split Payment - Modified hash with splitRequest
                udf1 = document.getElementById('split_udf1').value || '';
                udf2 = document.getElementById('split_udf2').value || '';
                udf3 = document.getElementById('split_udf3').value || '';
                udf4 = document.getElementById('split_udf4').value || '';
                udf5 = document.getElementById('split_udf5').value || '';
                
                // Build splitRequest JSON
                const splitRequestJson = buildSplitRequestJson();
                if (!splitRequestJson) {
                    throw new Error('Failed to build splitRequest JSON');
                }
                
                siDetailsJson = splitRequestJson; // Store in siDetailsJson for return
                
                // Modified hash formula: key|txnid|amount|productinfo|firstname|email|udf1|udf2|udf3|udf4|udf5||||||SALT|splitRequest
                hashString = credentials.key + '|' + txnid + '|' + amount + '|' + productinfo + '|' + firstname + '|' + email + '|' + udf1 + '|' + udf2 + '|' + udf3 + '|' + udf4 + '|' + udf5 + '||||||' + credentials.salt + '|' + splitRequestJson;
                hashFormula = 'SHA512(key|txnid|amount|productinfo|firstname|email|udf1|udf2|udf3|udf4|udf5||||||SALT|splitRequest)';
            } else if (flow === 'bankoffer') {
                // Bank Offers - check if cart_details is present for extended hash
                udf1 = document.getElementById('bo_udf1').value || '';
                udf2 = document.getElementById('bo_udf2').value || '';
                udf3 = document.getElementById('bo_udf3').value || '';
                udf4 = document.getElementById('bo_udf4').value || '';
                udf5 = document.getElementById('bo_udf5').value || '';
                
                const cartDetails = buildBankOfferCartDetails();
                const phone = document.getElementById('bo_phone').value || '';
                const offerKey = document.getElementById('bo_offer_key').value.trim() || '';
                
                if (cartDetails) {
                    // Extended hash formula when cart_details is present
                    // sha512(key|txnid|amount|productinfo|firstname|email|udf1|udf2|udf3|udf4|udf5||||||user_token|offer_key|offer_auto_apply|cart_details|extra_charges|phone|SALT)
                    const userToken = '';  // Empty by default
                    const offerAutoApply = '';  // Empty by default
                    const extraCharges = '';  // Empty by default
                    
                    hashString = credentials.key + '|' + txnid + '|' + amount + '|' + productinfo + '|' + firstname + '|' + email + '|' + udf1 + '|' + udf2 + '|' + udf3 + '|' + udf4 + '|' + udf5 + '||||||' + userToken + '|' + offerKey + '|' + offerAutoApply + '|' + cartDetails + '|' + extraCharges + '|' + phone + '|' + credentials.salt;
                    hashFormula = 'SHA512(key|txnid|amount|productinfo|firstname|email|udf1|udf2|udf3|udf4|udf5||||||user_token|offer_key|offer_auto_apply|cart_details|extra_charges|phone|SALT)';
                } else {
                    // Standard hash formula when cart_details is not present
                    hashString = credentials.key + '|' + txnid + '|' + amount + '|' + productinfo + '|' + firstname + '|' + email + '|' + udf1 + '|' + udf2 + '|' + udf3 + '|' + udf4 + '|' + udf5 + '||||||' + credentials.salt;
                    hashFormula = 'SHA512(key|txnid|amount|productinfo|firstname|email|udf1|udf2|udf3|udf4|udf5||||||SALT)';
                }
            } else {
                // Non-seamless one-time
                udf1 = document.getElementById('ns_udf1').value || '';
                udf2 = document.getElementById('ns_udf2').value || '';
                udf3 = document.getElementById('ns_udf3').value || '';
                udf4 = document.getElementById('ns_udf4').value || '';
                udf5 = document.getElementById('ns_udf5').value || '';
                
                hashString = credentials.key + '|' + txnid + '|' + amount + '|' + productinfo + '|' + firstname + '|' + email + '|' + udf1 + '|' + udf2 + '|' + udf3 + '|' + udf4 + '|' + udf5 + '||||||' + credentials.salt;
                hashFormula = 'SHA512(key|txnid|amount|productinfo|firstname|email|udf1|udf2|udf3|udf4|udf5||||||SALT)';
            }
            
            const hash = CryptoJS.SHA512(hashString).toString();
            
            console.log('=== Hash Generation ===');
            console.log('Flow:', flow);
            console.log('Prefix:', prefix);
            console.log('Payment Type:', currentPaymentType);
            console.log('Hash Formula:', hashFormula);
            console.log('Hash String:', hashString);
            console.log('Generated Hash:', hash);
            
            return { 
                hash: hash, 
                hashString: hashString, 
                hashFormula: hashFormula,
                siDetails: siDetailsJson,
                splitRequest: flow === 'split' ? siDetailsJson : '',
                udf1: udf1, 
                udf2: udf2, 
                udf3: udf3, 
                udf4: udf4, 
                udf5: udf5, 
                credentials: credentials 
            };
        }
        
        // Submit Payment
        function submitPayment(flow) {
            // Regenerate transaction IDs before payment
            console.log('=== Regenerating Transaction IDs ===');
            generateTransactionId(flow);
            
            // For split payment, regenerate all child transaction IDs
            if (flow === 'split') {
                regenerateSplitChildTransactionIds();
            }
            
            if (!validateForm(flow)) return;
            
            // Set correct prefix based on flow
            const prefix = flow === 'crossborder' ? 'cb' : (flow === 'subscription' ? 'sub' : (flow === 'tpv' ? 'tpv' : (flow === 'upiotm' ? 'upi' : (flow === 'preauth' ? 'preauth' : (flow === 'checkoutplus' ? 'cp' : (flow === 'split' ? 'split' : (flow === 'bankoffer' ? 'bo' : 'ns')))))));
            const hashData = generateHash(flow);
            
            console.log('=== Submitting Payment ===');
            console.log('Flow:', flow);
            console.log('Prefix:', prefix);
            
            // Create dynamic form
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = 'https://test.payu.in/_payment';
            form.style.display = 'none';
            
            const fields = [
                { name: 'key', value: hashData.credentials.key },
                { name: 'txnid', value: document.getElementById(prefix + '_txnid').value },
                { name: 'amount', value: document.getElementById(prefix + '_amount').value },
                { name: 'productinfo', value: document.getElementById(prefix + '_productinfo').value },
                { name: 'firstname', value: document.getElementById(prefix + '_firstname').value },
                { name: 'email', value: document.getElementById(prefix + '_email').value },
                { name: 'phone', value: document.getElementById(prefix + '_phone').value },
                { name: 'surl', value: document.getElementById(prefix + '_surl').value },
                { name: 'furl', value: document.getElementById(prefix + '_furl').value },
                { name: 'hash', value: hashData.hash }
            ];
            
            console.log('Mandatory fields added:', fields.length);
            
            // Add optional fields
            const lastname = document.getElementById(prefix + '_lastname');
            if (lastname && lastname.value) {
                fields.push({ name: 'lastname', value: lastname.value });
            }
            
            // Add address fields if they have values
            const addressFields = ['address1', 'address2', 'city', 'state', 'country', 'zipcode'];
            addressFields.forEach(fieldName => {
                const field = document.getElementById(prefix + '_' + fieldName);
                if (field && field.value) {
                    fields.push({ name: fieldName, value: field.value });
                }
            });
            
            // Add UDF fields if they have values
            if (hashData.udf1) fields.push({ name: 'udf1', value: hashData.udf1 });
            if (hashData.udf2) fields.push({ name: 'udf2', value: hashData.udf2 });
            if (hashData.udf3) fields.push({ name: 'udf3', value: hashData.udf3 });
            if (hashData.udf4) fields.push({ name: 'udf4', value: hashData.udf4 });
            if (hashData.udf5) fields.push({ name: 'udf5', value: hashData.udf5 });
            
            // Add subscription fields for cross border subscription
            if (flow === 'crossborder' && currentPaymentType === 'subscription') {
                fields.push({ name: 'si', value: '1' });
                fields.push({ name: 'api_version', value: '7' });
                fields.push({ name: 'si_details', value: document.getElementById('cb_si_details').value });
                
                // Add buyer_type_business if selected
                const buyerTypeBusiness = document.getElementById('cb_buyer_type').value;
                if (buyerTypeBusiness) {
                    fields.push({ name: 'buyer_type_business', value: buyerTypeBusiness });
                    console.log('Cross Border subscription fields added with buyer_type_business:', buyerTypeBusiness);
                } else {
                    console.log('Cross Border subscription fields added');
                }
            }
            
            // Add buyer_type_business for cross border one-time
            if (flow === 'crossborder' && currentPaymentType === 'onetime') {
                const buyerTypeBusiness = document.getElementById('cb_buyer_type').value;
                if (buyerTypeBusiness) {
                    fields.push({ name: 'buyer_type_business', value: buyerTypeBusiness });
                    console.log('Cross Border one-time: buyer_type_business added:', buyerTypeBusiness);
                }
            }
            
            // Add subscription fields for non-seamless subscription
            if (flow === 'subscription') {
                fields.push({ name: 'si', value: '1' });
                fields.push({ name: 'api_version', value: '7' });
                fields.push({ name: 'si_details', value: document.getElementById('sub_si_details').value });
                console.log('Non-Seamless subscription fields added');
            }
            
            // Add TPV fields
            if (flow === 'tpv') {
                fields.push({ name: 'api_version', value: '6' });
                fields.push({ name: 'beneficiarydetail', value: document.getElementById('tpv_beneficiarydetail').value });
                console.log('TPV One Time fields added');
            }
            
            // Add UPI OTM fields
            if (flow === 'upiotm') {
                fields.push({ name: 'api_version', value: '7' });
                fields.push({ name: 'si_details', value: document.getElementById('upi_si_details').value });
                fields.push({ name: 'pre_authorize', value: '1' });
                console.log('UPI OTM fields added');
            }
            
            // Add PreAuth fields
            if (flow === 'preauth') {
                fields.push({ name: 'pre_authorize', value: '1' });
                console.log('PreAuth Card fields added');
            }
            
            // Add Split Payment fields
            if (flow === 'split') {
                fields.push({ name: 'splitRequest', value: hashData.splitRequest });
                console.log('Split Payment fields added');
                console.log('splitRequest:', hashData.splitRequest);
            }
            
            // Add Bank Offers fields (cart_details and offer_key)
            if (flow === 'bankoffer') {
                const cartDetails = buildBankOfferCartDetails();
                if (cartDetails) {
                    fields.push({ name: 'cart_details', value: cartDetails });
                    fields.push({ name: 'api_version', value: '19' });
                    console.log('Bank Offers fields added');
                    console.log('cart_details:', cartDetails);
                    console.log('api_version: 19');
                } else {
                    console.log('No cart_details - proceeding as standard payment');
                }
                
                // Add offer_key for non-SKU offers (independent of cart_details)
                const offerKey = document.getElementById('bo_offer_key').value.trim();
                if (offerKey) {
                    fields.push({ name: 'offer_key', value: offerKey });
                    console.log('Non-SKU offer_key added:', offerKey);
                }
            }
            
            // Add enforce paymethod if selected
            const paymethodCheckboxes = document.querySelectorAll('input[name="' + prefix + '_paymethod"]:checked');
            if (paymethodCheckboxes.length > 0) {
                const selectedPaymethods = [];
                paymethodCheckboxes.forEach(checkbox => {
                    let paymethodValue;
                    const id = checkbox.id.replace(prefix + '_', '');
                    
                    // Check if this is a subscription flow (Cross Border subscription or Non-Seamless subscription)
                    if ((flow === 'crossborder' && currentPaymentType === 'subscription') || flow === 'subscription') {
                        // Subscription payment methods
                        switch (id) {
                            case 'nb': paymethodValue = 'enach'; break;
                            case 'cc': paymethodValue = 'creditcard'; break;
                            case 'dc': paymethodValue = 'debitcard'; break;
                            case 'upi': paymethodValue = 'upi'; break;
                            default: paymethodValue = checkbox.value.toLowerCase();
                        }
                    } else {
                        // One-time payment methods
                        switch (id) {
                            case 'nb': paymethodValue = 'netbanking'; break;
                            case 'cc': paymethodValue = 'creditcard'; break;
                            case 'dc': paymethodValue = 'debitcard'; break;
                            case 'upi': paymethodValue = 'upi'; break;
                            default: paymethodValue = checkbox.value.toLowerCase();
                        }
                    }
                    selectedPaymethods.push(paymethodValue);
                });
                fields.push({ name: 'enforce_paymethod', value: selectedPaymethods.join('|') });
            }
            
            // Create hidden inputs
            fields.forEach(field => {
                const input = document.createElement('input');
                input.type = 'hidden';
                input.name = field.name;
                input.value = field.value;
                form.appendChild(input);
            });
            
            // Submit form
            document.body.appendChild(form);
            form.submit();
        }
        
        // Helper function to determine if a field is mandatory or optional
        function getFieldType(fieldName, flow) {
            // Define mandatory fields (common across all flows)
            const mandatoryFields = ['key', 'txnid', 'amount', 'productinfo', 'firstname', 'email', 'phone', 'surl', 'furl', 'hash'];
            
            // Define optional fields (common)
            const optionalFields = ['lastname', 'address1', 'address2', 'city', 'state', 'country', 'zipcode', 
                                   'udf1', 'udf2', 'udf3', 'udf4', 'udf5', 'buyer_type_business', 'offer_key'];
            
            // Flow-specific mandatory fields
            
            // Cross Border flow - additional mandatory fields for PACB compliance
            if (flow === 'crossborder') {
                // Mandatory fields for all cross-border payments
                if (['lastname', 'address1', 'city', 'state', 'country', 'zipcode'].includes(fieldName)) {
                    return 'mandatory';
                }
                // UDF5 is mandatory for cross-border one-time payments
                if (fieldName === 'udf5' && currentPaymentType === 'onetime') {
                    return 'mandatory';
                }
                // Subscription-specific mandatory fields
                if (currentPaymentType === 'subscription') {
                    if (['si', 'api_version', 'si_details'].includes(fieldName)) return 'mandatory';
                }
            }
            
            if (flow === 'subscription') {
                if (['si', 'api_version', 'si_details'].includes(fieldName)) return 'mandatory';
            }
            
            if (flow === 'tpv') {
                if (['api_version', 'beneficiarydetail'].includes(fieldName)) return 'mandatory';
            }
            
            if (flow === 'upiotm') {
                if (['api_version', 'si_details', 'pre_authorize'].includes(fieldName)) return 'mandatory';
            }
            
            if (flow === 'preauth') {
                if (['pre_authorize'].includes(fieldName)) return 'mandatory';
            }
            
            if (flow === 'split') {
                if (['splitRequest'].includes(fieldName)) return 'mandatory';
            }
            
            if (flow === 'bankoffer') {
                if (['api_version', 'cart_details'].includes(fieldName)) return 'mandatory';
            }
            
            // Check if in mandatory list
            if (mandatoryFields.includes(fieldName)) return 'mandatory';
            
            // Check if in optional list
            if (optionalFields.includes(fieldName)) return 'optional';
            
            // Special cases
            if (fieldName === 'enforce_paymethod') return 'optional';
            if (fieldName === 'Payment Type' || fieldName === 'Flow' || fieldName === 'Endpoint') return '';
            
            // Default to optional for any other field
            return 'optional';
        }
        
        // Show Debug Info
        function showDebugInfo(flow) {
            // Regenerate transaction IDs before showing debug info
            generateTransactionId(flow);
            
            // For split payment, regenerate all child transaction IDs
            if (flow === 'split') {
                regenerateSplitChildTransactionIds();
            }
            
            if (!validateForm(flow)) return;
            
            const prefix = flow === 'crossborder' ? 'cb' : (flow === 'subscription' ? 'sub' : (flow === 'tpv' ? 'tpv' : (flow === 'upiotm' ? 'upi' : (flow === 'preauth' ? 'preauth' : (flow === 'checkoutplus' ? 'cp' : (flow === 'split' ? 'split' : (flow === 'bankoffer' ? 'bo' : 'ns')))))));
            const hashData = generateHash(flow);
            
            let debugHtml = '<table class="debug-table">';
            debugHtml += '<tr><th>Parameter</th><th>Value</th></tr>';
            debugHtml += '<tr><td>Flow</td><td>' + flow.toUpperCase() + '</td></tr>';
            if (flow === 'crossborder') {
                debugHtml += '<tr><td>Payment Type</td><td>' + currentPaymentType + '</td></tr>';
            }
            debugHtml += '<tr><td>Endpoint</td><td>https://test.payu.in/_payment</td></tr>';
            
            // Show all request body parameters
            debugHtml += '<tr style="background: #e6f7ff;"><td colspan="2"><strong>REQUEST BODY PARAMETERS</strong></td></tr>';
            
            // Helper function to add field label
            const addFieldLabel = (fieldName) => {
                const fieldType = getFieldType(fieldName, flow);
                return fieldType ? ' <span style="color: ' + (fieldType === 'mandatory' ? '#d32f2f' : '#1976d2') + '; font-size: 0.85em;">(' + fieldType + ')</span>' : '';
            };
            
            debugHtml += '<tr><td>key' + addFieldLabel('key') + '</td><td>' + hashData.credentials.key + '</td></tr>';
            debugHtml += '<tr><td>txnid' + addFieldLabel('txnid') + '</td><td>' + document.getElementById(prefix + '_txnid').value + '</td></tr>';
            debugHtml += '<tr><td>amount' + addFieldLabel('amount') + '</td><td>' + document.getElementById(prefix + '_amount').value + '</td></tr>';
            debugHtml += '<tr><td>productinfo' + addFieldLabel('productinfo') + '</td><td>' + document.getElementById(prefix + '_productinfo').value + '</td></tr>';
            debugHtml += '<tr><td>firstname' + addFieldLabel('firstname') + '</td><td>' + document.getElementById(prefix + '_firstname').value + '</td></tr>';
            
            // Add lastname if present
            const lastname = document.getElementById(prefix + '_lastname');
            if (lastname && lastname.value) {
                debugHtml += '<tr><td>lastname' + addFieldLabel('lastname') + '</td><td>' + lastname.value + '</td></tr>';
            }
            
            debugHtml += '<tr><td>email' + addFieldLabel('email') + '</td><td>' + document.getElementById(prefix + '_email').value + '</td></tr>';
            debugHtml += '<tr><td>phone' + addFieldLabel('phone') + '</td><td>' + document.getElementById(prefix + '_phone').value + '</td></tr>';
            
            // Add address fields if present
            const addressFields = ['address1', 'address2', 'city', 'state', 'country', 'zipcode'];
            addressFields.forEach(fieldName => {
                const field = document.getElementById(prefix + '_' + fieldName);
                if (field && field.value) {
                    debugHtml += '<tr><td>' + fieldName + addFieldLabel(fieldName) + '</td><td>' + field.value + '</td></tr>';
                }
            });
            
            // Add UDF fields
            if (hashData.udf1) debugHtml += '<tr><td>udf1' + addFieldLabel('udf1') + '</td><td>' + hashData.udf1 + '</td></tr>';
            if (hashData.udf2) debugHtml += '<tr><td>udf2' + addFieldLabel('udf2') + '</td><td>' + hashData.udf2 + '</td></tr>';
            if (hashData.udf3) debugHtml += '<tr><td>udf3' + addFieldLabel('udf3') + '</td><td>' + hashData.udf3 + '</td></tr>';
            if (hashData.udf4) debugHtml += '<tr><td>udf4' + addFieldLabel('udf4') + '</td><td>' + hashData.udf4 + '</td></tr>';
            if (hashData.udf5) debugHtml += '<tr><td>udf5' + addFieldLabel('udf5') + '</td><td>' + hashData.udf5 + '</td></tr>';
            
            // Add subscription fields for cross border
            // Add subscription specific fields
            if (flow === 'crossborder' && currentPaymentType === 'subscription') {
                debugHtml += '<tr><td>si' + addFieldLabel('si') + '</td><td>1</td></tr>';
                debugHtml += '<tr><td>api_version' + addFieldLabel('api_version') + '</td><td>7</td></tr>';
                debugHtml += '<tr><td>si_details' + addFieldLabel('si_details') + '</td><td>' + document.getElementById('cb_si_details').value + '</td></tr>';
                
                // Add buyer_type_business if selected
                const buyerTypeBusiness = document.getElementById('cb_buyer_type').value;
                if (buyerTypeBusiness) {
                    debugHtml += '<tr><td>buyer_type_business' + addFieldLabel('buyer_type_business') + '</td><td>' + buyerTypeBusiness + '</td></tr>';
                }
            } else if (flow === 'crossborder' && currentPaymentType === 'onetime') {
                // Add buyer_type_business for cross border one-time
                const buyerTypeBusiness = document.getElementById('cb_buyer_type').value;
                if (buyerTypeBusiness) {
                    debugHtml += '<tr><td>buyer_type_business' + addFieldLabel('buyer_type_business') + '</td><td>' + buyerTypeBusiness + '</td></tr>';
                }
            } else if (flow === 'subscription') {
                debugHtml += '<tr><td>si' + addFieldLabel('si') + '</td><td>1</td></tr>';
                debugHtml += '<tr><td>api_version' + addFieldLabel('api_version') + '</td><td>7</td></tr>';
                debugHtml += '<tr><td>si_details' + addFieldLabel('si_details') + '</td><td>' + hashData.siDetails + '</td></tr>';
            } else if (flow === 'tpv') {
                debugHtml += '<tr><td>api_version' + addFieldLabel('api_version') + '</td><td>6</td></tr>';
                debugHtml += '<tr><td>beneficiarydetail' + addFieldLabel('beneficiarydetail') + '</td><td>' + document.getElementById('tpv_beneficiarydetail').value + '</td></tr>';
            } else if (flow === 'upiotm') {
                debugHtml += '<tr><td>api_version' + addFieldLabel('api_version') + '</td><td>7</td></tr>';
                debugHtml += '<tr><td>si_details' + addFieldLabel('si_details') + '</td><td>' + hashData.siDetails + '</td></tr>';
                debugHtml += '<tr><td>pre_authorize' + addFieldLabel('pre_authorize') + '</td><td>1</td></tr>';
            } else if (flow === 'preauth') {
                debugHtml += '<tr><td>pre_authorize' + addFieldLabel('pre_authorize') + '</td><td>1</td></tr>';
            } else if (flow === 'split') {
                debugHtml += '<tr><td>splitRequest' + addFieldLabel('splitRequest') + '</td><td><pre style="background: #f5f5f5; padding: 10px; border-radius: 5px; overflow-x: auto;">' + JSON.stringify(JSON.parse(hashData.splitRequest), null, 2) + '</pre></td></tr>';
            } else if (flow === 'bankoffer') {
                const cartDetails = buildBankOfferCartDetails();
                if (cartDetails) {
                    debugHtml += '<tr><td>api_version' + addFieldLabel('api_version') + '</td><td>19</td></tr>';
                    debugHtml += '<tr><td>cart_details' + addFieldLabel('cart_details') + '</td><td><pre style="background: #f5f5f5; padding: 10px; border-radius: 5px; overflow-x: auto;">' + JSON.stringify(JSON.parse(cartDetails), null, 2) + '</pre></td></tr>';
                }
                
                // Add offer_key for non-SKU offers
                const offerKey = document.getElementById('bo_offer_key').value.trim();
                if (offerKey) {
                    debugHtml += '<tr><td>offer_key' + addFieldLabel('offer_key') + '</td><td>' + offerKey + '</td></tr>';
                }
            }
            
            debugHtml += '<tr><td>surl' + addFieldLabel('surl') + '</td><td>' + document.getElementById(prefix + '_surl').value + '</td></tr>';
            debugHtml += '<tr><td>furl' + addFieldLabel('furl') + '</td><td>' + document.getElementById(prefix + '_furl').value + '</td></tr>';
            
            // Add enforce_paymethod if payment methods are selected
            const paymethodCheckboxes = document.querySelectorAll('input[name="' + prefix + '_paymethod"]:checked');
            if (paymethodCheckboxes.length > 0) {
                const selectedPaymethods = [];
                paymethodCheckboxes.forEach(checkbox => {
                    let paymethodValue;
                    const id = checkbox.id.replace(prefix + '_', '');
                    
                    // Check if this is a subscription flow (Cross Border subscription or Non-Seamless subscription)
                    if ((flow === 'crossborder' && currentPaymentType === 'subscription') || flow === 'subscription') {
                        // Subscription payment methods
                        switch (id) {
                            case 'nb': paymethodValue = 'enach'; break;
                            case 'cc': paymethodValue = 'creditcard'; break;
                            case 'dc': paymethodValue = 'debitcard'; break;
                            case 'upi': paymethodValue = 'upi'; break;
                            default: paymethodValue = checkbox.value.toLowerCase();
                        }
                    } else {
                        // One-time payment methods
                        switch (id) {
                            case 'nb': paymethodValue = 'netbanking'; break;
                            case 'cc': paymethodValue = 'creditcard'; break;
                            case 'dc': paymethodValue = 'debitcard'; break;
                            case 'upi': paymethodValue = 'upi'; break;
                            default: paymethodValue = checkbox.value.toLowerCase();
                        }
                    }
                    selectedPaymethods.push(paymethodValue);
                });
                debugHtml += '<tr><td>enforce_paymethod' + addFieldLabel('enforce_paymethod') + '</td><td>' + selectedPaymethods.join('|') + '</td></tr>';
            }
            
            debugHtml += '<tr><td>hash' + addFieldLabel('hash') + '</td><td>' + hashData.hash.substring(0, 20) + '... (truncated)</td></tr>';
            
            const saltDisplay = '***' + hashData.credentials.salt.slice(-4);
            debugHtml += '<tr style="background: #f0f0f0;"><td colspan="2"><strong>HASH CALCULATION INFO</strong></td></tr>';
            debugHtml += '<tr><td>Salt (masked)</td><td>' + saltDisplay + '</td></tr>';
            debugHtml += '</table>';
            
            // Show hash formula (from hashData)
            debugHtml += '<h4>Hash Formula:</h4>';
            debugHtml += '<div class="hash-string-display" style="background: #fff3cd; border-color: #ffc107; color: #856404; font-weight: 600;">' + hashData.hashFormula + '</div>';
            
            debugHtml += '<h4>Hash String:</h4>';
            debugHtml += '<div class="hash-string-display">' + hashData.hashString.replace(hashData.credentials.salt, saltDisplay) + '</div>';
            debugHtml += '<h4>Generated Hash:</h4>';
            debugHtml += '<div class="hash-output">' + hashData.hash + '</div>';
            debugHtml += '<div class="hash-output">Hash Length: ' + hashData.hash.length + ' characters</div>';
            
            document.getElementById(prefix + '-debugContent').innerHTML = debugHtml;
            document.getElementById(prefix + '-debugSection').style.display = 'block';
            document.getElementById(prefix + '-debugSection').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Show CURL Command
        function showCurlCommand(flow) {
            // Regenerate transaction IDs before generating CURL
            generateTransactionId(flow);
            
            // For split payment, regenerate all child transaction IDs
            if (flow === 'split') {
                regenerateSplitChildTransactionIds();
            }
            
            if (!validateForm(flow)) return;
            
            const prefix = flow === 'crossborder' ? 'cb' : (flow === 'subscription' ? 'sub' : (flow === 'tpv' ? 'tpv' : (flow === 'upiotm' ? 'upi' : (flow === 'preauth' ? 'preauth' : (flow === 'checkoutplus' ? 'cp' : (flow === 'split' ? 'split' : (flow === 'bankoffer' ? 'bo' : 'ns')))))));
            const hashData = generateHash(flow);
            
            let curlCommand = 'curl -X POST "https://test.payu.in/_payment" \\\n';
            curlCommand += '  -H "Content-Type: application/x-www-form-urlencoded" \\\n';
            
            // Add parameters (curl -d handles encoding automatically, no need for encodeURIComponent)
            curlCommand += '  -d "key=' + hashData.credentials.key + '" \\\n';
            curlCommand += '  -d "txnid=' + document.getElementById(prefix + '_txnid').value + '" \\\n';
            curlCommand += '  -d "amount=' + document.getElementById(prefix + '_amount').value + '" \\\n';
            curlCommand += '  -d "productinfo=' + document.getElementById(prefix + '_productinfo').value + '" \\\n';
            curlCommand += '  -d "firstname=' + document.getElementById(prefix + '_firstname').value + '" \\\n';
            
            const lastname = document.getElementById(prefix + '_lastname');
            if (lastname && lastname.value) {
                curlCommand += '  -d "lastname=' + lastname.value + '" \\\n';
            }
            
            curlCommand += '  -d "email=' + document.getElementById(prefix + '_email').value + '" \\\n';
            curlCommand += '  -d "phone=' + document.getElementById(prefix + '_phone').value + '" \\\n';
            
            // Add address fields if present
            const addressFields = ['address1', 'address2', 'city', 'state', 'country', 'zipcode'];
            addressFields.forEach(fieldName => {
                const field = document.getElementById(prefix + '_' + fieldName);
                if (field && field.value) {
                    curlCommand += '  -d "' + fieldName + '=' + field.value + '" \\\n';
                }
            });
            
            // Add UDF fields (now properly reading from hashData which includes values from all flows)
            if (hashData.udf1) curlCommand += '  -d "udf1=' + hashData.udf1 + '" \\\n';
            if (hashData.udf2) curlCommand += '  -d "udf2=' + hashData.udf2 + '" \\\n';
            if (hashData.udf3) curlCommand += '  -d "udf3=' + hashData.udf3 + '" \\\n';
            if (hashData.udf4) curlCommand += '  -d "udf4=' + hashData.udf4 + '" \\\n';
            if (hashData.udf5) curlCommand += '  -d "udf5=' + hashData.udf5 + '" \\\n';
            
            // Add subscription fields
            // Add subscription fields (si_details displayed in readable format for easy copy-paste)
            if (flow === 'crossborder' && currentPaymentType === 'subscription') {
                curlCommand += '  -d "si=1" \\\n';
                curlCommand += '  -d "api_version=7" \\\n';
                curlCommand += '  -d \'si_details=' + document.getElementById('cb_si_details').value + '\' \\\n';
                
                // Add buyer_type_business if selected
                const buyerTypeBusiness = document.getElementById('cb_buyer_type').value;
                if (buyerTypeBusiness) {
                    curlCommand += '  -d "buyer_type_business=' + buyerTypeBusiness + '" \\\n';
                }
            } else if (flow === 'crossborder' && currentPaymentType === 'onetime') {
                // Add buyer_type_business for cross border one-time
                const buyerTypeBusiness = document.getElementById('cb_buyer_type').value;
                if (buyerTypeBusiness) {
                    curlCommand += '  -d "buyer_type_business=' + buyerTypeBusiness + '" \\\n';
                }
            } else if (flow === 'subscription') {
                curlCommand += '  -d "si=1" \\\n';
                curlCommand += '  -d "api_version=7" \\\n';
                curlCommand += '  -d \'si_details=' + hashData.siDetails + '\' \\\n';
            } else if (flow === 'tpv') {
                curlCommand += '  -d "api_version=6" \\\n';
                curlCommand += '  -d \'beneficiarydetail=' + document.getElementById('tpv_beneficiarydetail').value + '\' \\\n';
            } else if (flow === 'upiotm') {
                curlCommand += '  -d "api_version=7" \\\n';
                curlCommand += '  -d \'si_details=' + hashData.siDetails + '\' \\\n';
                curlCommand += '  -d "pre_authorize=1" \\\n';
            } else if (flow === 'preauth') {
                curlCommand += '  -d "pre_authorize=1" \\\n';
            } else if (flow === 'split') {
                curlCommand += '  --data-urlencode \'splitRequest=' + hashData.splitRequest + '\' \\\n';
            } else if (flow === 'bankoffer') {
                const cartDetails = buildBankOfferCartDetails();
                if (cartDetails) {
                    curlCommand += '  -d "api_version=19" \\\n';
                    curlCommand += '  --data-urlencode \'cart_details=' + cartDetails + '\' \\\n';
                }
                
                // Add offer_key for non-SKU offers
                const offerKey = document.getElementById('bo_offer_key').value.trim();
                if (offerKey) {
                    curlCommand += '  -d "offer_key=' + offerKey + '" \\\n';
                }
            }
            
            curlCommand += '  -d "surl=' + document.getElementById(prefix + '_surl').value + '" \\\n';
            curlCommand += '  -d "furl=' + document.getElementById(prefix + '_furl').value + '" \\\n';
            
            // Add enforce paymethod
            const paymethodCheckboxes = document.querySelectorAll('input[name="' + prefix + '_paymethod"]:checked');
            if (paymethodCheckboxes.length > 0) {
                const selectedPaymethods = [];
                paymethodCheckboxes.forEach(checkbox => {
                    let paymethodValue;
                    const id = checkbox.id.replace(prefix + '_', '');
                    
                    // Check if this is a subscription flow (Cross Border subscription or Non-Seamless subscription)
                    if ((flow === 'crossborder' && currentPaymentType === 'subscription') || flow === 'subscription') {
                        // Subscription payment methods
                        switch (id) {
                            case 'nb': paymethodValue = 'enach'; break;
                            case 'cc': paymethodValue = 'creditcard'; break;
                            case 'dc': paymethodValue = 'debitcard'; break;
                            case 'upi': paymethodValue = 'upi'; break;
                            default: paymethodValue = checkbox.value.toLowerCase();
                        }
                    } else {
                        // One-time payment methods
                        switch (id) {
                            case 'nb': paymethodValue = 'netbanking'; break;
                            case 'cc': paymethodValue = 'creditcard'; break;
                            case 'dc': paymethodValue = 'debitcard'; break;
                            case 'upi': paymethodValue = 'upi'; break;
                            default: paymethodValue = checkbox.value.toLowerCase();
                        }
                    }
                    selectedPaymethods.push(paymethodValue);
                });
                curlCommand += '  -d "enforce_paymethod=' + selectedPaymethods.join('|') + '" \\\n';
            }
            
            curlCommand += '  -d "hash=' + hashData.hash + '"';
            
            document.getElementById(prefix + '-curlContent').textContent = curlCommand;
            document.getElementById(prefix + '-curlSection').style.display = 'block';
            document.getElementById(prefix + '-curlSection').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Copy CURL to Clipboard
        function copyCurlToClipboard(flow) {
            const prefix = flow === 'crossborder' ? 'cb' : (flow === 'subscription' ? 'sub' : (flow === 'tpv' ? 'tpv' : (flow === 'upiotm' ? 'upi' : (flow === 'preauth' ? 'preauth' : (flow === 'checkoutplus' ? 'cp' : (flow === 'split' ? 'split' : (flow === 'bankoffer' ? 'bo' : 'ns')))))));
            const curlContent = document.getElementById(prefix + '-curlContent').textContent;
            navigator.clipboard.writeText(curlContent).then(function() {
                alert('CURL command copied to clipboard!');
            }).catch(function(err) {
                console.error('Failed to copy CURL to clipboard:', err);
                alert('Failed to copy CURL command. Please copy manually from the text above.');
            });
        }
        
        // ============================================
        // CHECKOUT PLUS SPECIFIC FUNCTIONS
        // ============================================
        
        // Launch Checkout Plus Payment
        function launchCheckoutPlus() {
            if (!validateForm('checkoutplus')) return;
            
            // Check if SDK is loaded
            if (typeof bolt === 'undefined') {
                alert('Checkout Plus SDK is not loaded. Please refresh the page and try again.');
                return;
            }
            
            // Generate fresh transaction ID for each payment attempt
            generateTransactionId('checkoutplus');
            
            const prefix = 'cp';
            const credentials = getCredentials('checkoutplus');
            const hashData = generateHash('checkoutplus');
            
            // Prepare payment data
            const paymentData = {
                key: credentials.key,
                txnid: document.getElementById(prefix + '_txnid').value,
                amount: document.getElementById(prefix + '_amount').value,
                productinfo: document.getElementById(prefix + '_productinfo').value,
                firstname: document.getElementById(prefix + '_firstname').value,
                email: document.getElementById(prefix + '_email').value,
                phone: document.getElementById(prefix + '_phone').value,
                surl: document.getElementById(prefix + '_surl').value,
                furl: document.getElementById(prefix + '_furl').value,
                hash: hashData.hash
            };
            
            // Add optional lastname
            const lastname = document.getElementById(prefix + '_lastname').value;
            if (lastname) paymentData.lastname = lastname;
            
            // Add address fields if present
            const addressFields = ['address1', 'address2', 'city', 'state', 'country', 'zipcode'];
            addressFields.forEach(field => {
                const value = document.getElementById(prefix + '_' + field).value;
                if (value) paymentData[field] = value;
            });
            
            // Add UDF fields
            if (hashData.udf1) paymentData.udf1 = hashData.udf1;
            if (hashData.udf2) paymentData.udf2 = hashData.udf2;
            if (hashData.udf3) paymentData.udf3 = hashData.udf3;
            if (hashData.udf4) paymentData.udf4 = hashData.udf4;
            if (hashData.udf5) paymentData.udf5 = hashData.udf5;
            
            // Add enforce_paymethod if selected
            const paymethodCheckboxes = document.querySelectorAll('input[name="cp_paymethod"]:checked');
            if (paymethodCheckboxes.length > 0) {
                const selectedPaymethods = [];
                paymethodCheckboxes.forEach(checkbox => {
                    const id = checkbox.id.replace('cp_', '');
                    const paymethodValue = id === 'nb' ? 'netbanking' : 
                                          id === 'cc' ? 'creditcard' : 
                                          id === 'dc' ? 'debitcard' : 
                                          id === 'upi' ? 'upi' : checkbox.value.toLowerCase();
                    selectedPaymethods.push(paymethodValue);
                });
                paymentData.enforce_paymethod = selectedPaymethods.join('|');
            }
            
            console.log('=== Launching Checkout Plus ===');
            console.log('Payment Data:', paymentData);
            
            // Setup response handlers
            const handlers = {
                responseHandler: function(BOLT) {
                    checkoutPlusResponseHandler(BOLT);
                },
                catchException: function(BOLT) {
                    checkoutPlusCatchException(BOLT);
                }
            };
            
            // Launch payment
            try {
                bolt.launch(paymentData, handlers);
            } catch (error) {
                console.error('Error launching Checkout Plus:', error);
                alert('Failed to launch Checkout Plus: ' + error.message);
            }
        }
        
        // Checkout Plus Response Handler
        function checkoutPlusResponseHandler(BOLT) {
            console.log('=== Checkout Plus Response ===');
            console.log('Transaction Response:', BOLT.response);
            
            const res = BOLT.response;
            let message = '=== CHECKOUT PLUS RESPONSE ===\n\n';
            
            // Handle different response formats (success vs cancel)
            const txnId = res.txnId || res.txnid || 'N/A';
            const txnStatus = res.txnStatus || 'UNKNOWN';
            
            message += 'Status: ' + txnStatus + '\n';
            message += 'Transaction ID: ' + txnId + '\n';
            
            // For CANCEL status, show the cancel message
            if (txnStatus === 'CANCEL') {
                message += 'Message: ' + (res.txnMessage || res.field9 || 'Transaction cancelled') + '\n';
                message += '\n** Transaction Cancelled **';
            } 
            // For SUCCESS status, show full details
            else if (txnStatus === 'SUCCESS') {
                if (res.mihpayid) message += 'PayU ID: ' + res.mihpayid + '\n';
                if (res.amount) message += 'Amount: Rs. ' + res.amount + '\n';
                if (res.mode) message += 'Mode: ' + res.mode + '\n';
                message += '\n** Payment Successful! **';
                if (res.bank_ref_num) message += '\nBank Ref: ' + res.bank_ref_num;
            } 
            // For other statuses (FAILED, PENDING, etc.)
            else {
                if (res.mihpayid) message += 'PayU ID: ' + res.mihpayid + '\n';
                if (res.amount) message += 'Amount: Rs. ' + res.amount + '\n';
                if (res.mode) message += 'Mode: ' + res.mode + '\n';
                message += '\n** Payment ' + txnStatus + ' **';
                if (res.txnMessage) message += '\nMessage: ' + res.txnMessage;
                else if (res.field9) message += '\nMessage: ' + res.field9;
            }
            
            message += '\n\nCheck console for full response details.';
            alert(message);
        }
        
        // Checkout Plus Exception Handler
        function checkoutPlusCatchException(BOLT) {
            console.log('=== Checkout Plus Exception ===');
            console.log('Exception Message:', BOLT.message);
            alert('Payment Error: ' + BOLT.message);
        }
    </script>
</body>
</html>

